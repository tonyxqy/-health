# 膳食花园
本项目旨在设计一款基于知识图谱和多模型融合推荐算法的膳食调理系统。利用数据挖掘技术，围绕知识图谱和nlp等技术原理建立起智能医疗膳食回答系统，同时实现中医“云”问诊功能,将用户的各项身体指标，体力劳动力程度（职业）和用户偏好等多个体征进行量化和综合分析，建立了基于协同过滤算法和TD-IDF算法的一日三餐智能推荐系统。该系统以微信小程序的形式展现给用户。
- 介绍视频：https://www.bilibili.com/video/av431666504/?vd_source=641fd5304571c3b866cf652b42add4fc
- 公众号：膳食花园 小程序：膳食花园（已关闭服务器）
- 将不公开后端代码
## 产品介绍
针对大众普遍存在营养知识缺乏、膳食结构不合理的情况，我们团队研发了此款膳食花园小程序，致力于为大众解决健康管理、膳食调理的需求。小程序的开发结合了多种信息技术，通过营养学理论与计算机应用技术的融合，为用户提供智能的个性化的食谱推荐，便捷的线上舌诊中医诊疗，智慧的在线医疗知识问答助手，以及趣味性的营养花园互动游戏。充分做到针对不同的用户群体在饮食搭配的痛点和需求提供功能板块的同时，融入更多的现代化元素以及交互性活动，通过优化用户的整体使用体验，吸引更多的用户。
本产品目前已具备以下几个方面功能：
- （1）针对相关人群映射食谱
小程序根据功效，人群，菜系等特征，将食谱划分成疾病养护、适宜人群、特殊工作、身体调养、特殊功效、常见菜式这六大类。每一类中又对人群定位进行了细致划分，如针对糖尿病患者，高血脂患者等，用户可以根据自己的实际需要去选择相关类别，其中菜品的详情页面也会细致描述此菜品的功效、适应人群以及食材做法等。
- （2）智能问答助手
小程序具备基于中文医疗知识图谱的智能回答系统，推出了“小螺号”问答助手，可以针对用户关于疾病总述、治疗方案、推荐食物等咨询给出专业解答，帮助用户对自己身体素质进行一个简单的自我测试与评估。同时系统会根据用户的测试诊疗结果，获取用户的机体营养数值报告，更好地为用户个性化定制膳食调理的方案。
- （3）线上智能诊疗
小程序提供在线舌诊、体质检测功能，通过识别用户舌象，舌苔颜色等，判断用户现有的体质状态，为用户生成诊断报告以及膳食推荐。
- （4）菜谱推荐系统
小程序会根据用户的体质，所需营养元素，所需要控制的卡路里，为用户个性化定制餐食。并结合用户的爱好，感兴趣内容，口味，菜系综合评判推荐菜谱。
- （5）营养花园
小程序仿照支付宝蚂蚁森林推出养树功能。用户通过健康食谱记录、营养达标打卡等任务获取能量，种植小树，当用户出现长期不记录时，树苗会呈现亚健康状态，以此来提醒用户提高对自身健康的关注。
## 技术介绍
- （一）SpringBoot及Mybatis技术
小程序后端使用SpringBoot框架，结合Mybatis技术对后端数据库进行数据交换访问，基本不使用xml配置文件，使用全注解开发，主要分为持久层（dao），业务层（service），控制层（controller），在这三层中进行操作。
- （二）应用容器Docker
小程序使用了阿里云的轻量级服务器来进行部署，通过docker在服务器上创建所需要的环境把项目部署到服务器上，支持并行部署，实现部署环境标准化和部署项目独立性，具备启动时间快，部署快，容器更易管理与扩展，计算资源更好利用的特点。增加了系统的安全性和可用性。
- （三）数据库连接池Druid
小程序采用数据库连接池Druid技术解决用户需要频繁的请求数据库内容的问题，在一定成都上避免每请求一次就需要创建一个对象，提高了资源的利用率和请求效率。
- （四）对象存储OSS
小程序采用阿里云的对象存储OSS来完成存储用户照片或者视频的功能，最大程度上减少开销。
- （五）uniapp
小程序选择在uniapp上进行开发，便于后续的多平台的开发扩充。为了优化性能，前端在代码中遵循了一下几点原则：对一些反复用到的参数如用户id做了静态资源缓存，不重复加载相同的资源；对小程序进行分包，按需加载；为了节流没有采用动态搜索；运用函数防抖限制了连续的触发；由于项目中供展示的图片较多，前端全部使用了懒加载的方式展示，让图片在不可见时延迟加载，并将图片打包至网站，尽可能用iconfont 代替了图片，节省空间；尽可能的对css样式做了统一和压缩，增加继承和重复利用；使用响应式布局，兼容不同设备大小。 
- （六）基于知识图谱的智能问答系统
知识图谱的智能问答系统搭建主要包含以下两个模块：
	基于垂直网站数据的医药膳食规划图谱构建
	基于医药膳食规划图谱的自动问答
其中项目的数据来自垂直类医疗网站寻医问药，我们使用爬虫脚本获取相关医药膳食记录，从网页文本中找出实体(NER)，并提取出实体间的关系，从非结构化数据中提取出结构化的信息来构建了以疾病为中心的医疗知识图谱，实体规模一共4.4万，实体关系规模总计30万。其中数据存储采用Neo4j图数据库，而问答系统采用了规则匹配方式完成，通过关键词匹配，对问句进行进行分类,然后采用neo4j声明的cypher对数据进行操作，根据返回数据组装问句回答，最后返回结果。
 
- （七）基于多模型融合推荐算法
	基于内容推荐算法：
基于内容的推荐系统本质是对内容进行分析，建立特征；基于用户对何种特征的内容感兴趣以及分析一个内容具备什么特征来进行推荐。
-（1）特征（内容）提取：
提取用户的个人身体素质信息，例如身高体重BMI，以及相关血糖血压血脂等数据
提取用户的劳动力水平程度，通过用户的相关职业分析用户每日消耗的劳动量，氛围低劳动力，中劳动力，高劳动力，最终定向去找到对应的标准合理分配的需要能量数值
提取用户的体质信息，用户通过体质问卷，中医智能问答机器人，舌诊等各个功能，综合评判自己的相关身体素质指标，相关身体情况反馈到后台记录日志，最终反应到用户的推荐食谱当中
提取用户的生活环境，我们通过调查用户的相关职业信息，获取用户平日的工作环境，得到相应用户容易换上的疾病信息，例如老师就需要注意肺部以及喉咙的局部调理，根据此信息的手机，更加完全贴合用户真实膳食需求存在
- （2）用户偏好计算：
利用用户过去的显示评分或者隐式操作记录，使用统计特征计算用户不同特征（内容属性）上的偏好分数。并加入时间因子，diff为历史食谱的时间间隔，时间间隔越长，评分的贡献越低，如果突然出现一个从未有过的类别，将会进行一个区别，是否出现用户口味改变的拐点
- （3）内容召回：
将待推荐物品的特征与用户偏好得分匹配，取出用户最优可能喜欢的物品池，例如用户A，若待推荐食谱有一些辣炒菜和一些养身汤，用户A的物品池里面应该养身汤的物品池。
- （4）物品排序：
按用户偏好召回的物品池，可能一次性挑选出很多内容，这时候可以进一步进行排序。优先推荐得分排名高的进行输出
基于内容推荐方法的优点：
- 基于mahout的协同过滤推荐算法：
第一步：找到和目标用户兴趣相似的用户集合，利用皮尔逊相似度算法计算兴趣的相似度。
第二步：找到最近邻域得到用户之间的兴趣相似度后， 算法会找到和他兴趣最相似的K个用户形成新的集合
第三步：找到这个集合中的用户喜欢的，且目标用户没有听说过的物品推荐给目标用户。
通过用户对物品的偏好程度来计算出用户的在喜好上的近邻，从而根据近邻的喜好推测出用户的喜好并推荐，选出TOPN食谱列表推荐，再去判断是否是用户已经食用过的食谱，尽量推荐新类型相似的食谱给用户。总的过
- 基于SparkMLib的模型ALS推荐算法
基于hadoop的计算框架，采用大数据的计算引擎Spark，整个应用在内存中的运行速度提升100倍,甚至能够将在磁盘上的运行速度提升10倍,有效的缓解了菜谱推荐系统所面对的需要海量计算问题
计算隐性评分。抽取用户行为日志信息中高价值数据，如用户浏览、历史食谱，体质等信息，根据不同行为权重，计算用户对商品的评分情况，并将分析结果写入结果分析文本中。
离线推荐模型训练。当完成隐性行为评分后，系统输出用户、菜谱、评分三元组数据并存储，以此作为离线推荐模型训练数据源。针对偏好分析时，采用ALS算法计算用户隐性因子，并根据隐性因子分析预测用户偏好菜谱进行排序，生成离线推荐模型数据。
生成离线推荐商品列表。根据离线推荐模型训练结果，将用户多维度数据输入到模型中，获得各用户离线推荐列表，其中离线推荐列表长度设定为早中晚各3个。生成离线推荐列表后，将推荐列表寄存于数据库专属推荐模块中。
- TF-IDF算法
基本原理：根据用户的选择菜谱行为，获得用户的兴趣偏好度，为用户推荐跟他的兴趣偏好相似的内容，采用词频-逆文档词频来提取文章关键字，根据关键词词频向量计算相似度（余弦相似度）来进行内容推荐
在推荐食谱领域，推荐系统将用户的特征作为依据，利用用户历史行为数据进而挖掘用户可能感兴趣的相关食谱类型并推送给用户，计算每个菜谱关键词的TF-IDF值获取菜谱相关属于重点分类以及采用余弦相似度计算除自己以外的其他菜谱关键词的相似度，根据从大到小排序，在其中引入时间戳作为因子，随着时间的增长，权重将会降低，最后对菜谱喜爱权重进行更新。
