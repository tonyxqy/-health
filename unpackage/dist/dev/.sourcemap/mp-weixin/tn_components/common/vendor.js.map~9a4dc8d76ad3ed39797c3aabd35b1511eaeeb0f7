{"version":3,"sources":["uni-app:///components/QS-SharePoster/app.js","uni-app:///components/QS-SharePoster/QS-SharePoster.js","uni-app:///components/QS-SharePoster/QRCodeAlg.js","uni-app:///components/QS-SharePoster/image-tools.js"],"names":["log","console","_app","t","showLoading","msg","ifmask","uni","title","mask","hideLoading","showToast","icon","getPosterUrl","objs","backgroundImage","type","formData","Promise","rs","rj","image","shareTypeListSheetArray","array","isArray","arg","Object","prototype","toString","call","isObject","isPromise","obj","then","isNull","isUndefined","undefined","isUndef","isNotNull_string","isFn","fn","getStorage","key","scb","fcb","success","res","data","fail","setStorage","JSON","stringify","setStorageSync","getStorageSync","clearStorageSync","removeStorageSync","getImageInfo","url","cb","checkMPUrl","src","err","downloadFile","downloadFile_PromiseFc","substring","tempFilePath","saveFile","downLoadAndSaveFile_PromiseFc","d_res","s_res","savedFilePath","checkFile_PromiseFc","getSavedFileList","d","fileList","index","findIndex","item","filePath","removeSavedFile","path","fileNameInPath","s","split","length","getImageInfo_PromiseFc","imgPath","previewImage","urls","actionSheet","sheetArray","i","this","showActionSheet","itemList","e","tapIndex","getProvider","sheet","_this","service","provider","providers","payTypeArray","name","value","img","module","exports","ShreUserPosterBackgroundKey","idKey","nbgScale","getSharePoster","resolve","reject","returnPromise","result1","bgScale","Number","result2","background","posterCanvasId","reserve","textArray","drawArray","qrCodeArray","imagesArray","setCanvasWH","setCanvasToTempFilePath","setDraw","Context","delayTimeScale","drawDelayTime","createCanvasContext","width","height","bgObj","getShreUserPosterBackground","params","getBgObj","setBgObj","newBgObj","n","setImage","setText","hasAllInfoCallback","drawArrayItem","allInfoCallback","newData","drawArray_copy","sort","a","b","a_serialNum","serialNum","NEGATIVE_INFINITY","b_serialNum","item_idKey","setTimeout","drawShareImage","poster","drawImage","backgroundColor","setFillStyle","fillRect","drawText","drawQrCode","drawFillRect","drawStrokeRect","drawRoundStrokeRect","drawRoundFillRect","canvasToTempFilePathFn","setObj","x","y","destWidth","destHeight","quality","fileType","toTempFilePathObj","canvasId","canvasToTempFilePath","delayTime","forEach","text","draw","setGlobalAlpha","alpha","dx","dy","setStrokeStyle","color","setLineWidth","lineWidth","strokeRect","r","beginPath","moveTo","arcTo","closePath","stroke","fill","texts","setTextFn","textItem","String","size","textAlign","textBaseline","Math","ceil","textLength","countTextLength","infoCallBackObj","infoCallBack","setFontSize","measureText","l","j","substr","countL","countStrLength","test","images","rejcet","setImageFn","base64ToPathFn","reg","base64ToPath","imgUrl","hasinfoCallBack","imageInfo","dWidth","dHeight","newArr","lineFeed","lineNum","maxWidth","lineHeight","chr","temp","row","len","push","allNum","str","drawTexts","setFont","font","fontStyle","fontVariant","fontWeight","fontSize","fontFamily","trim","drawTextFn","setTextAlign","setTextBaseline","fillText","lineThrough","mx","my","style","cap","setLineCap","lineTo","readyDrawImageFn","circleSet","drawCircleImage","roundRectSet","drawRoundRectImage","drawImageFn","hasAlpha","sx","sy","sWidth","sHeight","save","arc","PI","fillStyle","clip","restore","qrCodeObj","qrcodeAlgObjCache","options","foreground","pdground","correctLevel","imageSize","qrCodeAlg","QRCodeAlg","getForeGround","config","col","count","getModuleCount","ratioSize","ratioImgSize","tileW","toPrecision","tileH","w","floor","h","modules","round","drawRoundedRect","ctxi","toFixed","getShreUserPosterBackgroundFc","setPosterStorage","getStorageKey","upimage","imageObj","returnObj","unicodeFormat8","code","c0","c1","c2","getUTF8Bytes","string","utf8codes","charCodeAt","utf8","errorCorrectLevel","typeNumber","moduleCount","dataCache","rsBlocks","totalDataCount","utf8bytes","make","constructor","getRightType","createData","createQrcode","makeImpl","maskPattern","Array","setupPositionProbePattern","setupPositionAdjustPattern","setupTimingPattern","setupTypeInfo","setupTypeNumber","mapData","c","minLostPoint","pattern","bestModules","lostPoint","QRUtil","getLostPoint","pos","getPatternPosition","bits","getBCHTypeNumber","mod","QRErrorCorrectLevel","getBCHTypeInfo","buffer","QRBitBuffer","lengthBits","put","putBit","PAD0","PAD1","createBytes","offset","maxDcCount","maxEcCount","rsBlock","totalCount","dataCount","dcdata","ecdata","dcCount","ecCount","max","rsPoly","getErrorCorrectPolynomial","rawPoly","QRPolynomial","getLength","modPoly","modIndex","get","inc","bitIndex","byteIndex","dark","getMask","QRMaskPattern","PATTERN000","PATTERN001","PATTERN010","PATTERN011","PATTERN100","PATTERN101","PATTERN110","PATTERN111","PATTERN_POSITION_TABLE","G15","G18","G15_MASK","getBCHDigit","digit","Error","errorCorrectLength","multiply","QRMath","gexp","qrCode","darkCount","sameCount","head","current","ratio","abs","glog","LOG_TABLE","EXP_TABLE","num","shift","tl","el","RS_BLOCK_TABLE","lengthBytes","bufIndex","bit","getLocalFilePath","indexOf","localFilePath","plus","io","convertAbsoluteFileSystem","pathToBase64","window","FileReader","xhr","XMLHttpRequest","open","responseType","onload","status","fileReader","target","result","onerror","readAsDataURL","response","send","canvas","document","createElement","c2x","getContext","Image","toDataURL","wx","canIUse","getFileSystemManager","readFile","encoding","error","resolveLocalFileSystemURL","entry","file","base64","match","atob","Uint8Array","URL","webkitURL","createObjectURL","Blob","extName","fileName","Date","now","env","USER_DATA_PATH","writeFile","replace","bitmap","nativeObj","Bitmap","loadBase64Data","clear"],"mappings":"gHAAA,gBAAIA,EAAMC,QAAQD,IAEdE,EAAO,CAEVF,IAFU,SAENG,GACHH,EAAIG,IAELC,YALU,SAKEC,EAAKC,GAChBC,EAAIH,YAAY,CACfI,MAAOH,EACPI,KAAMH,IAAU,KAGlBI,YAXU,WAYTH,EAAIG,eAELC,UAdU,SAcAN,EAAKO,GACdL,EAAII,UAAU,CACbH,MAAOH,EACPO,KAAMA,GAAQ,UAGhBC,aApBU,SAoBGC,GAAM,IAEjBC,EAGGD,EAHHC,gBACAC,EAEGF,EAFHE,KAEGF,EADHG,SAED,OAAO,IAAIC,SAAQ,SAACC,EAAIC,GACvB,IAAIC,EACJ,GAAIN,EACHM,EAAQN,OAER,OAAQC,GACP,KAAK,EACJK,EAAQ,GACR,MACD,QACCA,EAAQ,gBACR,MAGCA,EACHF,EAAGE,GAEHD,EAAG,iBAWNE,wBAAyB,CACxBC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,IAExBC,QAzDU,SAyDFC,GACP,MAA+C,mBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,IAEvCK,SA5DU,SA4DDL,GACR,MAA+C,oBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,IAEvCM,UA/DU,SA+DAC,GACT,QAASA,IAAuB,kBAARA,GAAmC,oBAARA,IAA2C,oBAAbA,EAAIC,MAEtFC,OAlEU,SAkEHT,GACN,OAAe,OAARA,GAERU,YArEU,SAqEEV,GACX,YAAeW,IAARX,GAERY,QAxEU,SAwEFZ,GACP,YAAeW,IAARX,GAERa,iBA3EU,SA2EOb,GAChB,OAAe,OAARA,QAAwBW,IAARX,GAA6B,KAARA,GAE7Cc,KA9EU,SA8ELC,GACJ,OAAOA,GAAoB,oBAAPA,GAErBC,WAjFU,SAiFCC,EAAKC,EAAKC,GACpBrC,EAAIkC,WAAW,CACdC,MACAG,QAAS,SAASC,GACbA,EAAIC,MAAoB,IAAZD,EAAIC,KACfJ,GAAKA,EAAIG,EAAIC,MAEbH,GAAKA,KAGXI,KAAM,WACDJ,GAAKA,QAIZK,WAhGU,SAgGCP,EAAKK,GACf/C,EAAI,QACJA,EAAI,OAAS0C,GACb1C,EAAI,QAAUkD,KAAKC,UAAUJ,IAC7BxC,EAAI0C,WAAW,CACdP,MACAK,UAGFK,eAzGU,SAyGKV,EAAKK,GACnBxC,EAAI6C,eAAeV,EAAKK,IAEzBM,eA5GU,SA4GKX,GACd,OAAOnC,EAAI8C,eAAeX,IAE3BY,iBA/GU,WAgHT/C,EAAI+C,oBAELC,kBAlHU,SAkHQb,GACjBnC,EAAIgD,kBAAkBb,IAEvBc,aArHU,SAqHGC,EAAKC,EAAId,GACrBa,EAAME,EAAWF,GACjBlD,EAAIiD,aAAa,CAChBI,IAAKH,EACLZ,QAFgB,SAERC,GACHY,GAAoB,mBAAPA,GAAmBA,EAAGZ,IAExCE,KALgB,SAKXa,GACAjB,GAAsB,mBAARA,GAAoBA,EAAIiB,OAI7CC,aAjIU,SAiIGL,EAAKC,GACjBD,EAAME,EAAWF,GACjBlD,EAAIuD,aAAa,CAChBL,MACAZ,QAFgB,SAERC,GACHY,GAAoB,mBAAPA,GAAmBA,EAAGZ,OAI1CiB,uBA1IU,SA0IaN,GACtB,OAAO,IAAIvC,SAAQ,SAACC,EAAIC,GACK,SAAxBqC,EAAIO,UAAU,EAAG,GACpB7C,EAAGsC,IAEHA,EAAME,EAAWF,GACjBzD,EAAI,OAASyD,GACblD,EAAIuD,aAAa,CAChBL,MACAZ,QAFgB,SAERC,GACHA,GAAOA,EAAImB,aACd9C,EAAG2B,EAAImB,cAEP7C,EAAG,0BAEL4B,KARgB,SAQXa,GACJzC,EAAGyC,WAMRK,SAhKU,SAgKDT,GACRlD,EAAI2D,SAAS,CACZD,aAAcR,EACdZ,QAFY,SAEJC,GACP9C,EAAI,QAAUkD,KAAKC,UAAUL,QAIhCqB,8BAxKU,SAwKoBV,GAC7B,OAAO,IAAIvC,SAAQ,SAACC,EAAIC,GACvBpB,EAAI,aAAeyD,GACS,SAAxBA,EAAIO,UAAU,EAAG,IACpBP,EAAME,EAAWF,GACjBlD,EAAIuD,aAAa,CAChBL,MACAZ,QAFgB,SAERuB,GACPpE,EAAI,WAAakD,KAAKC,UAAUiB,IAC5BA,GAASA,EAAMH,aAOlB1D,EAAI2D,SAAS,CACZD,aAAcG,EAAMH,aACpBpB,QAFY,SAEJwB,GACPrE,EAAI,WAAakD,KAAKC,UAAUkB,IAC5BA,GAASA,EAAMC,cAClBnD,EAAGkD,EAAMC,eAETnD,EAAGiD,EAAMH,eAEXjB,KATY,SASPa,GACJ1C,EAAGiD,EAAMH,iBAMX7C,EAAG,0BAGL4B,KA9BgB,SA8BXa,GACJzC,EAAGyC,OAIL1C,EAAGsC,OAINc,oBApNU,SAoNUd,GACnB,OAAO,IAAIvC,SAAQ,SAACC,EAAIC,GACvBb,EAAIiE,iBAAiB,CACpB3B,QADoB,SACZC,GACP,IAAI2B,EAAI3B,EAAI4B,SACRC,EAAQF,EAAEG,WAAU,SAAAC,GACvB,OAAOA,EAAKC,WAAarB,KAE1BtC,EAAGwD,IAEJ3B,KARoB,SAQfa,GACJzC,EAAGyC,UAKPkB,gBApOU,SAoOMC,GACfzE,EAAIiE,iBAAiB,CACpB3B,QADoB,SACZC,GACP,IAAI2B,EAAI3B,EAAI4B,SACRC,EAAQF,EAAEG,WAAU,SAAAC,GACvB,OAAOA,EAAKC,WAAaE,KAEtBL,GAAS,GACZpE,EAAIwE,gBAAgB,CACnBD,SAAUE,QAKfC,eAlPU,SAkPKD,GACd,IAAIE,EAAIF,EAAKG,MAAM,KACnB,OAAOD,EAAEA,EAAEE,OAAS,IAErBC,uBAtPU,SAsPaC,GACtB,OAAO,IAAIpE,SAAQ,SAACC,EAAIC,GACvBpB,EAAI,YAAcsF,GAClBA,EAAU3B,EAAW2B,GACrB/E,EAAIiD,aAAa,CAChBI,IAAK0B,EACLzC,QAAS,SAAAC,GACR9C,EAAI,YAAckD,KAAKC,UAAUL,IACjC3B,EAAG2B,IAEJE,KAAM,SAAAa,GACL7D,EAAI,YAAckD,KAAKC,UAAUU,IACjCzC,EAAGyC,UAKP0B,aAvQU,SAuQGC,GACQ,iBAATA,IACVA,EAAO,CAACA,IACTjF,EAAIgF,aAAa,CAChBC,UAGFC,YA9QU,SA8QEzD,EAAK0B,GAEhB,IADA,IAAIgC,EAAa,GACRC,EAAI,EAAGA,EAAI3D,EAAIT,MAAM6D,OAAQO,IACrC,OAAQ3D,EAAIT,MAAMoE,IACjB,IAAK,YACJD,EAAWC,GAAK,OAChB,MACD,IAAK,KACJD,EAAWC,GAAK,KAChB,MACD,IAAK,SACJD,EAAWC,GAAK,KAChB,MACD,IAAK,iBACJD,EAAWC,GAAK,OAChB,MACD,IAAK,kBACJD,EAAWC,GAAK,QAChB,MACD,IAAK,kBACJD,EAAWC,GAAK,OAChB,MACD,KAAK,EACJD,EAAWC,GAAK,OAChB,MACD,KAAK,EACJD,EAAWC,GAAK,MAChB,MACD,KAAK,EACJD,EAAWC,GAAK,MAChB,MACD,KAAK,EACJD,EAAWC,GAAK,KAChB,MACD,KAAK,EACJD,EAAWC,GAAK,KAChB,MACD,KAAK,EACJD,EAAWC,GAAK,MAChB,MACD,QACC,MAGHC,KAAKC,gBAAgBH,EAAYhC,IAElCmC,gBA5TU,SA4TMH,EAAYhC,GAC3BnD,EAAIsF,gBAAgB,CACnBC,SAAUJ,EACV7C,QAAS,SAACkD,GACLrC,GAAoB,mBAAPA,GAAmBA,EAAGqC,EAAEC,cAI5CC,YApUU,SAoUEjF,EAAM0C,EAAIwC,GACrB,IAAIC,EAAQP,KACZrF,EAAI0F,YAAY,CACfG,QAASpF,EACT6B,QAAS,SAASC,GACjB,GAAIoD,EAAO,CACV,IAAIlE,EAAM,GACVA,EAAIT,MAAQuB,EAAIuD,SAChBF,EAAMV,YAAYzD,GAAK,SAAS2C,GAC3BjB,GAAoB,mBAAPA,GAAmBA,EAAGZ,EAAIuD,SAAS1B,YAGrD,GAAY,WAAR3D,EAAmB,CAGtB,IAFA,IAAIsF,EAAYxD,EAAIuD,SAChBE,EAAe,GACVZ,EAAI,EAAGA,EAAIW,EAAUlB,OAAQO,IACjB,SAAhBW,EAAUX,GACbY,EAAaZ,GAAK,CACjBa,KAAM,OACNC,MAAOH,EAAUX,GACjBe,IAAK,yBAEoB,UAAhBJ,EAAUX,KACpBY,EAAaZ,GAAK,CACjBa,KAAM,QACNC,MAAOH,EAAUX,GACjBe,IAAK,0BAIJhD,GAAoB,mBAAPA,GAAmBA,EAAG6C,QAEnC7C,GAAoB,mBAAPA,GAAmBA,EAAGZ,QAyL7C,SAASa,EAAWF,GAcnB,OAAOA,EAGRkD,EAAOC,QAAU1G,I,yFChjBjB,YACA,YACA,S,ixDACA,IAAM2G,EAA8B,wBAC9BC,EAAQ,sBAMd,IAAIC,EAAW,EAEf,SAASC,EAAehF,GACvB,OAAO,IAAId,QAAJ,mCAAY,WAAO+F,EAASC,GAAhB,yGAEKC,EAAcnF,GAFnB,OAEXoF,EAFW,OAGjBH,EAAQG,GAHS,mEAObpF,EAAIqF,QACNrF,EAAIqF,QAAUC,OAAOtF,EAAIqF,SAAW,GAEpCN,GAAsB,GAEvB9G,QAAQD,IAAI,0CAZI,UAaMmH,EAAcnF,GAbpB,QAaVuF,EAbU,OAchBN,EAAQM,GAdQ,qDAiBhBL,EAAO,EAAD,IAjBU,gEAAZ,yDAwBR,SAASC,EAAcnF,GAAM,IAE3BhB,EAkBGgB,EAlBHhB,KACAC,EAiBGe,EAjBHf,SACAuG,EAgBGxF,EAhBHwF,WACAC,EAeGzF,EAfHyF,eACA1G,EAcGiB,EAdHjB,gBACA2G,EAaG1F,EAbH0F,QACAC,EAYG3F,EAZH2F,UACAC,EAWG5F,EAXH4F,UACAC,EAUG7F,EAVH6F,YACAC,EASG9F,EATH8F,YACAC,EAQG/F,EARH+F,YACAC,EAOGhG,EAPHgG,wBACAC,EAMGjG,EANHiG,QACAZ,EAKGrF,EALHqF,QACAa,EAIGlG,EAJHkG,QACA/B,EAGGnE,EAHHmE,MACAgC,EAEGnG,EAFHmG,eACAC,EACGpG,EADHoG,cAED,OAAO,IAAIlH,QAAJ,mCAAY,WAAOC,EAAIC,GAAX,kHAEjBlB,UAAKE,YAAY,YACZ8H,IACJhI,UAAKF,IAAI,iBACTkI,EAAU3H,EAAI8H,oBAAoBZ,EAAiBtB,GAAS,SAGzDqB,GAAcA,EAAWc,OAASd,EAAWe,QARhC,gBAShBC,EAAQhB,EATQ,uCAWFiB,EAA4B,CACzC1H,kBACAC,OACAC,aAde,OAWhBuH,EAXgB,kBAiBjBnB,EAAUA,GAAWN,EACrByB,EAAMF,MAAQE,EAAMF,MAAQjB,EAC5BmB,EAAMD,OAASC,EAAMD,OAASlB,EAE9BnH,UAAKF,IAAI,eAAiBkD,KAAKC,UAAUqF,IACnCE,EAAS,CACdF,QACAxH,OACAqG,UACAsB,SAAU,WACT,OAAOD,EAAOF,OAEfI,SAAU,SAASC,GAClB,IAAMC,EAAI,EAAH,KAAOJ,EAAOF,OAAUK,GAC/BH,EAAOF,MAAQM,EACfN,EAAQM,KAGNhB,EAnCa,uBAoCW,mBAAhBA,IACVA,EAAcA,EAAYY,IAC3BxI,UAAKE,YAAY,kBACjBF,UAAKF,IAAI,UAvCO,UAwCI+I,EAASjB,GAxCb,QAwChBA,EAxCgB,OAyChB5H,UAAKQ,cAzCW,WA2CbiH,IACsB,mBAAdA,IACVA,EAAYA,EAAUe,IACvBf,EAAYqB,EAAQd,EAASP,KAG1BE,EAjDa,iBAkDW,mBAAhBA,IACVA,EAAcA,EAAYa,IAC3BxI,UAAKE,YAAY,kBACRuF,EAAI,EArDG,aAqDAA,EAAIkC,EAAYzC,QArDhB,oBAsDflF,UAAKF,IAAI2F,IACLkC,EAAYlC,GAAGtE,MAvDJ,kCAwDenB,UAAK6D,uBAAuB8D,EAAYlC,GAAGtE,OAxD1D,QAwDdwG,EAAYlC,GAAGtE,MAxDD,eAqDwBsE,IArDxB,wBA0DhBzF,UAAKQ,cA1DW,YA4DbkH,EA5Da,oBA6DS,mBAAdA,IACVA,EAAYA,EAAUc,KAEnBxI,UAAK6B,UAAU6F,GAhEH,4CAiEfA,EAjEe,oBAoEZ1H,UAAKsB,QAAQoG,IAAcA,EAAUxC,OAAS,GApElC,iBAqEX6D,GAAqB,EAChBtD,EAAI,EAtEE,aAsECA,EAAIiC,EAAUxC,QAtEf,iBAuER8D,EAAgBtB,EAAUjC,GAC5BzF,UAAKqC,KAAK2G,EAAcC,mBAAqBF,IAAoBA,GAAqB,GAC1FC,EAAcpC,GAASnB,EACnByD,OA1EU,OA2ENF,EAAclI,KA3ER,OA4ER,UA5EQ,QA+ER,SA/EQ,QAkFR,WAlFQ,QAwFR,WAxFQ,QA0FR,aA1FQ,QA4FR,eA5FQ,QA8FR,oBA9FQ,QAgGR,kBAhGQ,0CA6EI+H,EAASG,GA7Eb,eA6EZE,EA7EY,2CAgFZA,EAAUJ,EAAQd,EAASgB,GAhFf,iCAmFRA,EAAc7H,MAnFN,kCAqFGnB,UAAK6D,uBAAuBmF,EAAc7H,OArF7C,oBAoFX+H,EApFW,CAqFV/H,MArFU,6OAmGZnB,UAAKF,IAAI,UAnGG,6BAsGVoJ,GAAWlJ,UAAK4B,SAASsH,KAC5BxB,EAAUjC,GAAV,OAAoBuD,GAChBE,IAxGS,QAsEuBzD,IAtEvB,4BA6GXsD,EA7GW,iBA8Gd/I,UAAKF,IAAI,sDACHqJ,EA/GQ,EA+GazB,GAC3ByB,EAAeC,MAAK,SAACC,EAAGC,GACvB,IAAMC,EAAevJ,UAAKmC,QAAQkH,EAAEG,YAAexJ,UAAKgC,OAAOqH,EAAEG,WAAmCpC,OAAOqC,kBAA7BrC,OAAOiC,EAAEG,WACjFE,EAAe1J,UAAKmC,QAAQmH,EAAEE,YAAexJ,UAAKgC,OAAOsH,EAAEE,WAAmCpC,OAAOqC,kBAA7BrC,OAAOkC,EAAEE,WACvF,OAAOD,EAAcG,KAEtB1J,UAAKF,IAAI,WAEA2F,EAAI,EAvHC,aAuHEA,EAAI0D,EAAejE,QAvHrB,oBAwHPP,EAxHO,KAwHKwE,EAAe1D,KAE7BzF,UAAKqC,KAAKsC,EAAKsE,iBA1HN,oBA2HRC,EAAUvE,EAAKsE,gBAAgB,CAClCvB,eAEG1H,UAAK6B,UAAUqH,GA9HP,kCA8HiCA,EA9HjC,QA8HiBA,EA9HjB,eA+HNS,EAAahF,EAAKiC,GACnB5G,UAAKmC,QAAQwH,GAKjB5J,QAAQD,IAAI,8BAJZ4H,EAAU/C,EAAKiC,IAAf,OAA8BjC,GAC1BuE,GAlIO,QAuH6BzD,IAvH7B,wBAyIdzF,UAAKF,IAAI,WAzIK,WA6IjBC,QAAQD,IAAI,UAAYkD,KAAKC,UAAUuF,KACnCX,GAAsC,mBAAhBA,EA9IT,wCA+IN7G,SAAQ,SAAC+F,EAASC,GAC3Ba,EAAYW,GACZoB,YAAW,WACV7C,MACE,OAnJY,2BAsJI8C,EAAe,CACnC7B,UACAlH,OACAyG,iBACAC,UACAE,YACAD,YACAG,cACAU,QACAX,cACAG,0BACAC,UACAZ,UACAlB,QACAgC,iBACAC,kBArKgB,SAsJX4B,EAtJW,OAuKjB9J,UAAKQ,cACLS,EAAG,CACFqH,QACAwB,SACAhJ,SA3KgB,wDA+KjBI,EAAG,EAAD,IA/Ke,4DAAZ,yDAoLR,SAAS2I,EAAe/H,GAAK,IAE3BkG,EAeGlG,EAfHkG,QACAlH,EAcGgB,EAdHhB,KACAyG,EAaGzF,EAbHyF,eACAC,EAYG1F,EAZH0F,QACAc,EAWGxG,EAXHwG,MACAZ,EAUG5F,EAVH4F,UACAD,EASG3F,EATH2F,UACAE,EAQG7F,EARH6F,YACAC,EAOG9F,EAPH8F,YACAE,EAMGhG,EANHgG,wBACAC,EAKGjG,EALHiG,QACAZ,EAIGrF,EAJHqF,QACAlB,EAGGnE,EAHHmE,MACAgC,EAEGnG,EAFHmG,eACAC,EACGpG,EADHoG,cAEKM,EAAS,CACdR,UACAM,QACAxH,OACAqG,WAID,OAFAc,OAAoC/F,IAAnB+F,EAA+BA,EAAiB,GACjEC,OAAkChG,IAAlBgG,EAA8BA,EAAgB,IACvD,IAAIlH,SAAQ,SAACC,EAAIC,GACvB,IA6BC,GA5BAlB,UAAKE,YAAY,UACjBF,UAAKF,IAAI,QAAUkD,KAAKC,UAAUqF,IAC9BA,GAASA,EAAMxD,MAClB9E,UAAKF,IAAI,WACTkI,EAAQ+B,UAAUzB,EAAMxD,KAAM,EAAG,EAAGwD,EAAMF,MAAOE,EAAMD,UAEvDrI,UAAKF,IAAI,YACLwI,EAAM0B,iBACThK,UAAKF,IAAI,WAAawI,EAAM0B,iBAC5BhC,EAAQiC,aAAa3B,EAAM0B,iBAC3BhC,EAAQkC,SAAS,EAAG,EAAG5B,EAAMF,MAAOE,EAAMD,SAE1CrI,UAAKF,IAAI,aAIXE,UAAKE,YAAY,QACb0H,GAAeA,EAAY1C,OAAS,GACvC6E,EAAU/B,EAASJ,GAEpB5H,UAAKE,YAAY,WACb6H,GAA8B,mBAAZA,GAAwBA,EAAQS,GAEtDxI,UAAKE,YAAY,QACbuH,GAAaA,EAAUvC,OAAS,GACnCiF,EAASnC,EAASP,EAAWa,GAE9BtI,UAAKE,YAAY,SACbyH,GAAeA,EAAYzC,OAAS,EACvC,IAAK,IAAIO,EAAI,EAAGA,EAAIkC,EAAYzC,OAAQO,IACvC2E,EAAWpC,EAASL,EAAYlC,IAKlC,GADAzF,UAAKE,YAAY,YACbwH,GAAaA,EAAUxC,OAAS,EACnC,IAAK,IAAIO,EAAI,EAAGA,EAAIiC,EAAUxC,OAAQO,IAAK,CAC1C,IAAMuD,EAAgBtB,EAAUjC,GAEhC,OADAzF,UAAKF,IAAI,2BAA6BkD,KAAKC,UAAU+F,IAC7CA,EAAclI,MACrB,IAAK,QACJd,UAAKF,IAAI,kBACTiK,EAAU/B,EAASgB,GACnB,MACD,IAAK,OACJhJ,UAAKF,IAAI,kBACTqK,EAASnC,EAASgB,EAAeV,GACjC,MACD,IAAK,SACJtI,UAAKF,IAAI,mBACTsK,EAAWpC,EAASgB,GACpB,MACD,IAAK,SACJhJ,UAAKF,IAAI,qBACLkJ,EAAcjB,SAA4C,oBAA1BiB,EAAcjB,SACjDiB,EAAcjB,QAAQC,GACvB,MACD,IAAK,WACJhI,UAAKF,IAAI,sBACTuK,EAAarC,EAASgB,GACtB,MACD,IAAK,aACJhJ,UAAKF,IAAI,sBACTwK,EAAetC,EAASgB,GACxB,MACD,IAAK,kBACJhJ,UAAKF,IAAI,sBACTyK,EAAoBvC,EAASgB,GAC7B,MACD,IAAK,gBACJhJ,UAAKF,IAAI,sBACT0K,EAAkBxC,EAASgB,GAC3B,MACD,QACChJ,UAAKF,IAAI,UACT,OAIJE,UAAKE,YAAY,OACjB0J,YAAW,WACV5J,UAAKF,IAAI,cACTE,UAAKF,IAAI,WAAakI,GACtB,IAAM1F,EAAK,WACVtC,UAAKE,YAAY,UACjB,IAGIuK,EAHAC,EAAS5C,GAA2B,GACpC4C,GAA4B,mBAAXA,IACpBA,EAAS5C,EAAwBQ,EAAOxH,IAEzC,IAAM+B,EAAO,EAAH,CACT8H,EAAG,EACHC,EAAG,EACHxC,MAAOhB,OAAOkB,EAAMF,OACpBC,OAAQjB,OAAOkB,EAAMD,QACrBwC,UAAWzD,OAAOkB,EAAMF,OACxB0C,WAAY1D,OAAOkB,EAAMD,QACzB0C,QAAS,GACTC,SAAU,OACPN,GAEJ3K,QAAQD,IAAI,+BAAiCkD,KAAKC,UAAUJ,IAC5D4H,EAAyB,WACxB,IAAMQ,EAAoB,EAAH,KACnBpI,GADmB,IAEtBqI,SAAU3D,EACV5E,QAHsB,SAGdC,GACP5C,UAAKQ,cACLS,EAAG2B,IAEJE,KAPsB,SAOjBa,GACJ3D,UAAKQ,cACLT,QAAQD,IAAI,UACZE,UAAKF,IAAI,UAAYkD,KAAKC,UAAUU,IACpCzC,EAAG,UAAY8B,KAAKC,UAAUU,OAGhCtD,EAAI8K,qBAAqBF,EAAmBhF,GAAS,OAEtD,IAAImF,EAAY,EACZzD,GACHA,EAAY0D,SAAQ,SAAA1G,GACfA,EAAK2G,OACRF,GAAahE,OAAOzC,EAAK2G,KAAKpG,YAI7B0C,GACHA,EAAYyD,SAAQ,WACnBD,GAAanD,KAGXR,GACHA,EAAU4D,SAAQ,WACjBD,GAAanD,KAGXP,GACHA,EAAU2D,SAAQ,SAAA1G,GACjB,OAAQA,EAAK7D,MACZ,IAAK,OACA6D,EAAK2G,OACRF,GAAazG,EAAK2G,KAAKpG,QAExB,MACD,QACCkG,GAAanD,EACb,UAIJjI,UAAKF,IAAI,QAAUmI,GACnBjI,UAAKF,IAAI,QAAUsL,GACnBxB,WAAWa,EAAwBW,IAEpCpD,EAAQuD,KAAyB,kBAAZ/D,GAAwBA,EAAkBlF,KAC7D4F,GACF,MAAOrC,GAER7F,UAAKQ,cACLU,EAAG2E,OAMN,SAASwE,EAAarC,GAA8B,IAArBgB,EAAoB,uDAAJ,GAC9ChJ,UAAKF,IAAI,+BAAiCkD,KAAKC,UAAU+F,IACzDhB,EAAQiC,aAAajB,EAAcgB,iBAAmB,SACtDhC,EAAQwD,eAAexC,EAAcyC,OAAS,GAC9CzD,EAAQkC,SAASlB,EAAc0C,IAAM,EAAG1C,EAAc2C,IAAM,EAAG3C,EAAcZ,OAAS,EAAGY,EAAcX,QAAU,GACjHL,EAAQwD,eAAe,GAIxB,SAASlB,EAAetC,GAA8B,IAArBgB,EAAoB,uDAAJ,GAChDhB,EAAQ4D,eAAe5C,EAAc6C,OAAO,SAC5C7D,EAAQ8D,aAAa9C,EAAc+C,WAAa,GAChD/D,EAAQgE,WAAWhD,EAAc0C,GAAI1C,EAAc2C,GAAI3C,EAAcZ,MAAOY,EAAcX,QAI3F,SAASkC,EAAoBvC,GAA8B,IAArBgB,EAAoB,uDAAJ,GAC/C0C,EAA+C1C,EAA/C0C,GAAIC,EAA2C3C,EAA3C2C,GAAIvD,EAAuCY,EAAvCZ,MAAOC,EAAgCW,EAAhCX,OAAQ4D,EAAwBjD,EAAxBiD,EAAGF,EAAqB/C,EAArB+C,UAAWF,EAAU7C,EAAV6C,MAC3CI,EAAIA,GAAa,GAAR7D,EAELA,EAAQ,EAAI6D,IACfA,EAAI7D,EAAQ,GAETA,EAAQ,EAAI6D,IACfA,EAAI7D,EAAQ,GAEbJ,EAAQkE,YACRlE,EAAQmE,OAAOT,EAAKO,EAAGN,GACvB3D,EAAQoE,MAAMV,EAAKtD,EAAOuD,EAAID,EAAKtD,EAAOuD,EAAKtD,EAAQ4D,GACvDjE,EAAQoE,MAAMV,EAAKtD,EAAOuD,EAAKtD,EAAQqD,EAAIC,EAAKtD,EAAQ4D,GACxDjE,EAAQoE,MAAMV,EAAIC,EAAKtD,EAAQqD,EAAIC,EAAIM,GACvCjE,EAAQoE,MAAMV,EAAIC,EAAID,EAAKtD,EAAOuD,EAAIM,GACtCjE,EAAQqE,YACRrE,EAAQ8D,aAAaC,GAAa,GAClC/D,EAAQ4D,eAAeC,GAAS,SAChC7D,EAAQsE,SAIT,SAAS9B,EAAkBxC,GAA8B,IAArBgB,EAAoB,uDAAJ,GAC7C0C,EAA8C1C,EAA9C0C,GAAIC,EAA0C3C,EAA1C2C,GAAIvD,EAAsCY,EAAtCZ,MAAOC,EAA+BW,EAA/BX,OAAQ4D,EAAuBjD,EAAvBiD,EAAGjC,EAAoBhB,EAApBgB,gBAChCiC,EAAIA,GAAa,GAAR7D,EAELA,EAAQ,EAAI6D,IACfA,EAAI7D,EAAQ,GAETA,EAAQ,EAAI6D,IACfA,EAAI7D,EAAQ,GAEbJ,EAAQkE,YACRlE,EAAQmE,OAAOT,EAAKO,EAAGN,GACvB3D,EAAQoE,MAAMV,EAAKtD,EAAOuD,EAAID,EAAKtD,EAAOuD,EAAKtD,EAAQ4D,GACvDjE,EAAQoE,MAAMV,EAAKtD,EAAOuD,EAAKtD,EAAQqD,EAAIC,EAAKtD,EAAQ4D,GACxDjE,EAAQoE,MAAMV,EAAIC,EAAKtD,EAAQqD,EAAIC,EAAIM,GACvCjE,EAAQoE,MAAMV,EAAIC,EAAID,EAAKtD,EAAOuD,EAAIM,GACtCjE,EAAQqE,YACRrE,EAAQiC,aAAaD,GACrBhC,EAAQuE,OAIT,SAASzD,EAAQd,EAASwE,GAEzB,GADAxM,UAAKF,IAAI,mBAAqBkD,KAAKC,UAAUuJ,IACzCA,GAASxM,UAAKsB,QAAQkL,IAEzB,GADAxM,UAAKF,IAAI,YACL0M,EAAMtH,OAAS,EAClB,IAAK,IAAIO,EAAI,EAAGA,EAAI+G,EAAMtH,OAAQO,IACjCzF,UAAKF,IAAI,eAAiBkD,KAAKC,UAAUuJ,EAAM/G,KAC/C+G,EAAM/G,GAAKgH,EAAUzE,EAASwE,EAAM/G,SAItCzF,UAAKF,IAAI,YACT0M,EAAQC,EAAUzE,EAASwE,GAG5B,OADAxM,UAAKF,IAAI,WAAakD,KAAKC,UAAUuJ,IAC9BA,EAGR,SAASC,EAAUzE,EAAS0E,GAE3B,GADA1M,UAAKF,IAAI,sBAAwBkD,KAAKC,UAAUyJ,IAC5C1M,UAAKoC,iBAAiBsK,EAASpB,MAAO,CACzCoB,EAASpB,KAAOqB,OAAOD,EAASpB,MAChCoB,EAASjB,WAA2BvJ,IAAnBwK,EAASjB,MAAsBrE,OAAOsF,EAASjB,OAAS,EACzEiB,EAASb,MAAQa,EAASb,OAAS,QACnCa,EAASE,UAAyB1K,IAAlBwK,EAASE,KAAqBxF,OAAOsF,EAASE,MAAQ,GACtEF,EAASG,UAAYH,EAASG,WAAa,OAC3CH,EAASI,aAAeJ,EAASI,cAAgB,SACjDJ,EAAShB,GAAKtE,OAAOsF,EAAShB,KAAO,EACrCgB,EAASf,GAAKvE,OAAOsF,EAASf,KAAO,EACrCe,EAASE,KAAOG,KAAKC,KAAK5F,OAAOsF,EAASE,OAC1C5M,UAAKF,IAAI,iBAAmBkD,KAAKC,UAAUyJ,IAC3C,IAAMO,EAAaC,EAAgBlF,EAAS,CAC3CsD,KAAMoB,EAASpB,KACfsB,KAAMF,EAASE,OAEhB5M,UAAKF,IAAI,mBAAqBmN,GAC9B,IAAIE,EAAkB,GAClBT,EAASU,cAAkD,oBAA3BV,EAASU,eAC5CD,EAAkBT,EAASU,aAAaH,IAEzCP,EAAW,EAAH,KACJA,GADI,IAEPO,cACGE,GAEJnN,UAAKF,IAAI,uBAAyBkD,KAAKC,UAAUyJ,IAElD,OAAOA,EAGR,SAASQ,EAAgBlF,EAASlG,GACjC9B,UAAKF,IAAI,eAAiBkD,KAAKC,UAAUnB,IADH,IAOlCmL,EAJH3B,EAEGxJ,EAFHwJ,KACAsB,EACG9K,EADH8K,KAED5E,EAAQqF,YAAYT,GAEpB,IACCK,EAAajF,EAAQsF,YAAYhC,GACjC,MAAMzF,GAENoH,EAAa,GAKd,GAHAA,EAAa,GACbjN,UAAKF,IAAI,iCAAmCkD,KAAKC,UAAUgK,IAC3DA,EAAaA,GAAcA,EAAW7E,MAAQ6E,EAAW7E,MAAQ,GAC5D6E,EAAY,CAEhB,IADA,IAAIM,EAAI,EACCC,EAAI,EAAGA,EAAIlC,EAAKpG,OAAQsI,IAAK,CACrC,IAAIvN,EAAIqL,EAAKmC,OAAOD,EAAG,GACjBE,EAASC,EAAe1N,GAC9BD,UAAKF,IAAI,YAAc4N,GACvBH,GAAKG,EAEN1N,UAAKF,IAAI,WAAayN,GACtBN,EAAaM,EAAIX,EAElB,OAAOK,EAIR,SAASU,EAAe1N,GACvB,IAAIsN,EAkLJ,OAhLCA,EADG,IAAIK,KAAK3N,GACR,WACM,IAAI2N,KAAK3N,GACf,WACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,WACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,WACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,WACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,UACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,OACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,SACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,WACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,YACM,IAAI2N,KAAK3N,GACf,aACM,IAAI2N,KAAK3N,GACf,WACM,IAAI2N,KAAK3N,GACf,YACM,QAAQ2N,KAAK3N,GACnB,aACM,kBAAkB2N,KAAK3N,GAC7B,EACM,IAAI2N,KAAK3N,GACf,YACM,KAAK2N,KAAK3N,GAChB,WACM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,MACM,KAAK2N,KAAK3N,GAChB,QACM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,YACM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,YACM,KAAK2N,KAAK3N,GAChB,WACM,KAAK2N,KAAK3N,IAEV,KAAK2N,KAAK3N,GADhB,WAGM,KAAK2N,KAAK3N,GAChB,YACM,KAAK2N,KAAK3N,GAChB,YACM,KAAK2N,KAAK3N,IAEV,KAAK2N,KAAK3N,GADhB,aAGM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,WACM,KAAK2N,KAAK3N,IAEV,KAAK2N,KAAK3N,GADhB,WAGM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,IAEV,KAAK2N,KAAK3N,GADhB,aAGM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,IAEV,KAAK2N,KAAK3N,GADhB,WAGM,KAAK2N,KAAK3N,GAChB,aACM,KAAK2N,KAAK3N,GAChB,WACM,KAAK2N,KAAK3N,IAEV,KAAK2N,KAAK3N,GADhB,aAGM,KAAK2N,KAAK3N,GAChB,aAEA,EAEEsN,EAIR,SAAS1E,EAASgF,GAEjB,OADA7N,UAAKF,IAAI,cACF,IAAIkB,QAAJ,mCAAY,WAAO+F,EAAS+G,GAAhB,2FAEbD,IAAU7N,UAAKsB,QAAQuM,GAFV,iBAGhB7N,UAAKF,IAAI,eACA2F,EAAI,EAJG,YAIAA,EAAIoI,EAAO3I,QAJX,wBAKflF,UAAKF,IAAI,aAAe2F,GALT,SAMGsI,EAAWF,EAAOpI,IANrB,OAMfoI,EAAOpI,GANQ,cAImBA,IAJnB,sDAShBzF,UAAKF,IAAI,eATO,UAUDiO,EAAWF,GAVV,QAUhBA,EAVgB,eAYjB9G,EAAQ8G,GAZS,qDAejBC,EAAO,EAAD,IAfW,0DAAZ,yDAoBR,SAASE,EAAelJ,GACvB,IAAImJ,EAAM,6GACV,OAAIA,EAAIL,KAAK9I,IAGN,IAAAoJ,cAAapJ,GAFX9D,QAAQ+F,QAAQjC,GAK1B,SAASiJ,EAAW5M,GACnB,OAAO,IAAIH,QAAJ,mCAAY,WAAO+F,EAASC,GAAhB,sFACd7F,EAAMoC,IADQ,iCAEEyK,EAAe7M,EAAMoC,KAFvB,cAEjBpC,EAAMoC,IAFW,OAGb4K,EAAShN,EAAMoC,IAHF,SAIFvD,UAAK6D,uBAAuBsK,GAJ1B,cAIjBA,EAJiB,OAKjBhN,EAAMoC,IAAM4K,EACNC,EAAkBjN,EAAMiM,cAA+C,oBAAxBjM,EAAMiM,aACvDiB,EAAY,GAPC,UAQCrO,UAAKmF,uBAAuBgJ,GAR7B,QAQjBE,EARiB,OASbD,IACHjN,EAAQ,EAAH,KACDA,GACAA,EAAMiM,aAAaiB,KAGxBlN,EAAMuK,GAAKtE,OAAOjG,EAAMuK,KAAO,EAC/BvK,EAAMwK,GAAKvE,OAAOjG,EAAMwK,KAAO,EAC/BxK,EAAMmN,OAASlH,OAAOjG,EAAMmN,QAAUD,EAAUjG,OAChDjH,EAAMoN,QAAUnH,OAAOjG,EAAMoN,SAAWF,EAAUhG,QAClDlH,EAAQ,EAAH,KACDA,GADC,IAEJkN,cArBgB,QAwBlBtH,EAAQ5F,GAxBU,4CAAZ,yDA6BR,SAASgJ,EAASnC,EAASP,EAAWa,GAChCtI,UAAKsB,QAAQmG,GAIjBzH,UAAKF,IAAI,gBAHTE,UAAKF,IAAI,gBACT2H,EAAY,CAACA,IAIdzH,UAAKF,IAAI,qBAAuBkD,KAAKC,UAAUwE,IAC/C,IAAM+G,EAAS,GACf,GAAI/G,GAAaA,EAAUvC,OAAS,EACnC,IAAK,IAAIsI,EAAI,EAAGA,EAAI/F,EAAUvC,OAAQsI,IAAK,CAC1C,IAAMd,EAAWjF,EAAU+F,GAC3B,GAAId,EAASpB,MAAQoB,EAAS+B,SAAU,CACvC,IAAIC,GAAW,EACdC,EAAWrG,EAAMF,MACjBwG,EAAalC,EAASE,KACtBlB,EAAKgB,EAAShB,GACf,GAAI1L,UAAK4B,SAAS8K,EAAS+B,UAAW,CACrC,IAAMA,EAAW/B,EAAS+B,SAC1BC,OAAgCxM,IAArBuM,EAASC,SAAsD,kBAAtBD,EAASC,SAA0BD,EAASC,SAAW,EAC1GD,EAASC,QAAUA,EACpBC,OAAkCzM,IAAtBuM,EAASE,UAAwD,kBAAvBF,EAASE,SAA0BF,EAASE,SACjGA,EACDC,OAAsC1M,IAAxBuM,EAASG,YAA4D,kBAAzBH,EAASG,WAA4BH,EAASG,WACvGA,EACDlD,OAAsBxJ,IAAhBuM,EAAS/C,IAA4C,kBAAjB+C,EAAS/C,GAAoB+C,EAAS/C,GAAKA,EAMtF,IAJA,IAAMmD,EAAOnC,EAASpB,KAAMrG,MAAM,IAC9B6J,EAAO,GACLC,EAAM,GAEH1F,EAAI,EAAG2F,EAAMH,EAAI3J,OAAQmE,EAAI2F,EAAK3F,IACtC6D,EAAgBlF,EAAS,CAC3BsD,KAAMwD,EACNlC,KAAMF,EAASE,QACV+B,GAAYzB,EAAgBlF,EAAS,CAC1CsD,KAAOwD,EAAOD,EAAIxF,GAClBuD,KAAMF,EAASE,QACV+B,GACNG,GAAQD,EAAIxF,GACRA,GAAMwF,EAAI3J,OAAS,GACtB6J,EAAIE,KAAKH,KAGVC,EAAIE,KAAKH,GACTA,EAAOD,EAAIxF,IAGbrJ,UAAKF,IAAI,YAAckD,KAAKC,UAAU8L,IAItC,IAFA,IAAIG,EAAUR,GAAW,GAAKA,EAAUK,EAAI7J,OAAUwJ,EAAUK,EAAI7J,OAE3DO,EAAI,EAAGA,EAAIyJ,EAAQzJ,IAAK,CAChC,IAAI0J,EAAMJ,EAAItJ,GACVA,GAAMyJ,EAAS,GAAMA,EAASH,EAAI7J,SACrCiK,EAAMA,EAAIrL,UAAU,EAAGqL,EAAIjK,OAAS,GAAK,OAE1C,IAAMpD,EAAM,EAAH,KAAQ4K,GAAR,IACRpB,KAAM6D,EACNzD,GAAU,IAANjG,EAAUiH,EAAShB,GAAMA,GAAM,EAAIA,EAAKgB,EAAShB,GACrDC,GAAIe,EAASf,GAAMlG,EAAImJ,EACvB3B,WAAYC,EAAgBlF,EAAS,CACpCsD,KAAM6D,EACNvC,KAAMF,EAASE,SAGjB5M,UAAKF,IAAI,aAAekD,KAAKC,UAAUnB,IACvC0M,EAAOS,KAAKnN,SAGb0M,EAAOS,KAAKvC,GAIf1M,UAAKF,IAAI,WAAakD,KAAKC,UAAUuL,IACrCY,EAAUpH,EAASwG,GAGpB,SAASa,IAAwB,IAAhB3C,EAAe,uDAAJ,GAC3B,GAAIA,EAAS4C,MAAkC,kBAAnB5C,EAAS4C,KAEpC,OADAtP,UAAKF,IAAI4M,EAAS4C,MACX5C,EAAS4C,KAEhB,IAAIC,EAAY,SACZC,EAAc,SACdC,EAAa,SACbC,EAAWhD,EAASE,MAAQ,GAC5B+C,EAAa,aAUjB,OATAD,EAAW3C,KAAKC,KAAK5F,OAAOsI,IACxBhD,EAAS6C,WAA4C,kBAAxB7C,EAAS6C,YACzCA,EAAY7C,EAAS6C,UAAUK,QAC5BlD,EAAS8C,aAAgD,kBAA1B9C,EAAS8C,cAC3CA,EAAc9C,EAAS8C,YAAYI,SAChClD,EAAS+C,YAA+C,kBAAzB/C,EAAS+C,YAA4D,kBAAzB/C,EAAS+C,aACvFA,EAAa/C,EAAS+C,WAAWG,QAC9BlD,EAASiD,YAA8C,kBAAzBjD,EAASiD,aAC1CA,EAAajD,EAASiD,WAAWC,QAC3BL,EAAY,IAClBC,EAAc,IACdC,EAAa,IACbC,EAHMH,MAINI,EAIH,SAASP,EAAUpH,EAASwE,GAE3B,GADAxM,UAAKF,IAAI,mBAAqBkD,KAAKC,UAAUuJ,IACzCA,GAASxM,UAAKsB,QAAQkL,IAEzB,GADAxM,UAAKF,IAAI,iBACL0M,EAAMtH,OAAS,EAClB,IAAK,IAAIO,EAAI,EAAGA,EAAI+G,EAAMtH,OAAQO,IACjCoK,EAAW7H,EAASwE,EAAM/G,SAI5BzF,UAAKF,IAAI,kBACT+P,EAAW7H,EAASwE,GAItB,SAASqD,EAAW7H,EAAS0E,GAE5B,GADA1M,UAAKF,IAAI,sBAAwBkD,KAAKC,UAAUyJ,IAC5CA,GAAY1M,UAAK4B,SAAS8K,IAAaA,EAASpB,KAAM,CAOzD,GANAtD,EAAQsH,KAAOD,EAAQ3C,GACvB1E,EAAQiC,aAAayC,EAASb,OAC9B7D,EAAQwD,eAAekB,EAASjB,OAChCzD,EAAQ8H,aAAapD,EAASG,WAC9B7E,EAAQ+H,gBAAgBrD,EAASI,cACjC9E,EAAQgI,SAAStD,EAASpB,KAAMoB,EAAShB,GAAIgB,EAASf,IAClDe,EAASuD,aAAejQ,UAAK4B,SAAS8K,EAASuD,aAAc,CAChEjQ,UAAKF,IAAI,QACT,IAUIoQ,EAAIC,EAVJF,EAAcvD,EAASuD,YAW3B,OAVAA,EAAYxE,WAA8BvJ,IAAtB+N,EAAYxE,MAAsBwE,EAAYxE,MAAQiB,EAASjB,MACnFwE,EAAYG,MAAQH,EAAYG,OAAS1D,EAASb,MAClDoE,EAAY7H,WAA8BlG,IAAtB+N,EAAY7H,MAAsB6H,EAAY7H,MAAQsE,EAASE,KAAO,GAC1FqD,EAAYI,SAA0BnO,IAApB+N,EAAYI,IAAoBJ,EAAYI,IAAM,OACpErQ,UAAKF,IAAI,SAAWkD,KAAKC,UAAUgN,IACnCjI,EAAQwD,eAAeyE,EAAYxE,OACnCzD,EAAQ4D,eAAeqE,EAAYG,OACnCpI,EAAQ8D,aAAamE,EAAY7H,OACjCJ,EAAQsI,WAAWL,EAAYI,KAEvB3D,EAASG,WAChB,IAAK,OACJqD,EAAKxD,EAAShB,GACd,MACD,IAAK,SACJwE,EAAKxD,EAAShB,GAAMgB,EAASO,WAAc,EAC3C,MACD,QACCiD,EAAKxD,EAAShB,GAAMgB,EAASO,WAC7B,MAEF,OAAQP,EAASI,cAChB,IAAK,MACJqD,EAAKzD,EAASf,GAAsB,GAAhBe,EAASE,KAC7B,MACD,IAAK,SACJuD,EAAKzD,EAASf,GACd,MACD,QACCwE,EAAKzD,EAASf,GAAsB,GAAhBe,EAASE,KAC7B,MAEF5E,EAAQkE,YACRlE,EAAQmE,OAAO+D,EAAIC,GACnBnI,EAAQuI,OAAOL,EAAKxD,EAASO,WAAYkD,GACzCnI,EAAQsE,SACRtE,EAAQqE,YACRrM,UAAKF,IAAI,SAEVkI,EAAQwD,eAAe,GACvBxD,EAAQsH,KAAO,mBAIjB,SAASvF,EAAU/B,EAAS6F,GAE3B,GADA7N,UAAKF,IAAI,YAAckD,KAAKC,UAAU4K,IAClCA,GAAU7N,UAAKsB,QAAQuM,IAC1B,GAAIA,EAAO3I,OAAS,EACnB,IAAK,IAAIO,EAAI,EAAGA,EAAIoI,EAAO3I,OAAQO,IAClC+K,EAAiBxI,EAAS6F,EAAOpI,SAInC+K,EAAiBxI,EAAS6F,GAK5B,SAAS2C,EAAiBxI,EAASxB,GAClCxG,UAAKF,IAAI,iBAAmBkD,KAAKC,UAAUuD,IACvCA,EAAIjD,MACHiD,EAAIiK,UACPC,EAAgB1I,EAASxB,GACfA,EAAImK,aACdC,EAAmB5I,EAASxB,GAE5BqK,EAAY7I,EAASxB,IAKxB,SAASqK,EAAY7I,EAASxB,GAE7B,GADAxG,UAAKF,IAAI,mBAAqBkD,KAAKC,UAAUuD,IACzCA,EAAIjD,IAAK,CACZ,IAAMuN,GAAY9Q,UAAKmC,QAAQqE,EAAIiF,OACnCjF,EAAIiF,MAAQrE,OAAQpH,UAAKmC,QAAQqE,EAAIiF,OAAqB,EAAZjF,EAAIiF,OAClDzD,EAAQwD,eAAehF,EAAIiF,OAC3BzL,UAAKF,IAAI,kBACL0G,EAAI8H,QAAU9H,EAAI+H,SAAW/H,EAAIuK,IAAMvK,EAAIwK,IAAMxK,EAAIyK,QAAUzK,EAAI0K,SACtElR,UAAKF,IAAI,qBACTkI,EAAQ+B,UAAUvD,EAAIjD,IACtB6D,OAAOZ,EAAIuK,MAAO,EAAO3J,OAAOZ,EAAIwK,MAAO,EAC3C5J,OAAOZ,EAAIyK,UAAW,EAAO7J,OAAOZ,EAAI0K,WAAY,EACpD9J,OAAOZ,EAAIkF,IAAM,GAAItE,OAAOZ,EAAImF,IAAM,GACtCvE,OAAOZ,EAAI8H,UAAW,EAAOlH,OAAOZ,EAAI+H,WAAY,IAC1C/H,EAAI8H,QAAU9H,EAAI+H,SAC5BvO,UAAKF,IAAI,qBACTkI,EAAQ+B,UAAUvD,EAAIjD,IAAK6D,OAAOZ,EAAIkF,IAAM,GAAItE,OAAOZ,EAAImF,IAAM,GAChEvE,OAAOZ,EAAI8H,UAAW,EAAOlH,OAAOZ,EAAI+H,WAAY,KAErDvO,UAAKF,IAAI,qBACTkI,EAAQ+B,UAAUvD,EAAIjD,IAAK6D,OAAOZ,EAAIkF,IAAM,GAAItE,OAAOZ,EAAImF,IAAM,KAE9DmF,GACH9I,EAAQwD,eAAe,GAGzBxL,UAAKF,IAAI,kBAGV,SAAS4Q,EAAgB1I,EAASlG,GACjC9B,UAAKF,IAAI,mBAAqBkD,KAAKC,UAAUnB,IADP,IAUlC6I,EAAGC,EAAGqB,EAOL1H,EAdJmH,EAMG5J,EANH4J,GACAC,EAKG7J,EALH6J,GACA2C,EAIGxM,EAJHwM,OACAC,EAGGzM,EAHHyM,QACAkC,EAEG3O,EAFH2O,UAEG3O,EADHuM,WAGwB,kBAAdoC,IACV9F,EAAI8F,EAAU9F,EACdC,EAAI6F,EAAU7F,EACdqB,EAAIwE,EAAUxE,GAEVA,KAEJ1H,EAAI+J,EAASC,EAAUA,EAAUD,EACjCrC,EAAI1H,EAAI,GAGToG,EAAIA,EAAIe,EAAKf,GAAKe,GAAM,GAAKO,EAC7BrB,EAAIA,EAAIe,EAAKf,GAAKe,GAAM,GAAKM,EAC7BjE,EAAQmJ,OACRnJ,EAAQkE,YACRlE,EAAQoJ,IAAIzG,EAAGC,EAAGqB,EAAG,EAAG,EAAIc,KAAKsE,IAAI,GACrCrJ,EAAQqE,YACRrE,EAAQwD,eAAe,GACvBxD,EAAQsJ,UAAY,UACpBtJ,EAAQuE,OACRvE,EAAQwD,eAAe,GACvBxD,EAAQuJ,OACRV,EAAY7I,EAASlG,GACrB9B,UAAKF,IAAI,YACTkI,EAAQwJ,UAGT,SAASZ,EAAmB5I,EAASlG,GACpC9B,UAAKF,IAAI,mBAAqBkD,KAAKC,UAAUnB,IAC7CkG,EAAQmJ,OAFiC,IAWrClF,EAPHP,EAMG5J,EANH4J,GACAC,EAKG7J,EALH6J,GACA2C,EAIGxM,EAJHwM,OACAC,EAGGzM,EAHHyM,QACAoC,EAEG7O,EAFH6O,aAEG7O,EADHuM,UAG2B,kBAAjBsC,IACV1E,EAAI0E,EAAa1E,GAElBA,EAAIA,GAAc,GAATqC,EAELA,EAAS,EAAIrC,IAChBA,EAAIqC,EAAS,GAEVC,EAAU,EAAItC,IACjBA,EAAIsC,EAAU,GAEfvG,EAAQkE,YACRlE,EAAQmE,OAAOT,EAAKO,EAAGN,GACvB3D,EAAQoE,MAAMV,EAAK4C,EAAQ3C,EAAID,EAAK4C,EAAQ3C,EAAK4C,EAAStC,GAC1DjE,EAAQoE,MAAMV,EAAK4C,EAAQ3C,EAAK4C,EAAS7C,EAAIC,EAAK4C,EAAStC,GAC3DjE,EAAQoE,MAAMV,EAAIC,EAAK4C,EAAS7C,EAAIC,EAAIM,GACxCjE,EAAQoE,MAAMV,EAAIC,EAAID,EAAK4C,EAAQ3C,EAAIM,GACvCjE,EAAQqE,YACRrE,EAAQwD,eAAe,GACvBxD,EAAQsJ,UAAY,UACpBtJ,EAAQuE,OACRvE,EAAQwD,eAAe,GACvBxD,EAAQuJ,OACRV,EAAY7I,EAASlG,GACrBkG,EAAQwJ,UACRxR,UAAKF,IAAI,oBAIV,SAASsK,EAAWpC,EAASyJ,GAC5BzR,UAAKF,IAAI,aACTE,UAAKE,YAAY,WAgBjB,IAfA,IAAIwR,EAAoB,GACpBC,EAAU,CACbrG,KAAMqB,OAAO8E,EAAUnG,MAAQ,KAAO,GACtCsB,KAAMxF,OAAOqK,EAAU7E,MAAQ,IAAM,IACrCtF,WAAYqF,OAAO8E,EAAUnK,YAAc,KAAO,UAClDsK,WAAYjF,OAAO8E,EAAUG,YAAc,KAAO,UAClDC,SAAUlF,OAAO8E,EAAUI,UAAY,KAAO,UAC9CC,aAAc1K,OAAOqK,EAAUK,cAAgB,IAAM,EACrD3Q,MAAOwL,OAAO8E,EAAUtQ,OAAS,KAAO,GACxC4Q,UAAW3K,OAAOqK,EAAUM,WAAa,IAAM,GAC/CrG,GAAItE,OAAOqK,EAAU/F,IAAM,IAAM,EACjCC,GAAIvE,OAAOqK,EAAU9F,IAAM,IAAM,GAE9BqG,EAAY,KACZzN,EAAI,EACCkB,EAAI,EAAG8H,EAAImE,EAAkBxM,OAAQO,EAAI8H,EAAG9H,IAEpD,GADAlB,EAAIkB,EACAiM,EAAkBjM,GAAG6F,MAAQqG,EAAQrG,MAAQoG,EAAkBjM,GAAG6F,KAAKwG,cAAgBH,EAAQG,aAAc,CAChHE,EAAYN,EAAkBjM,GAAG3D,IACjC,MAGEyC,GAAKgJ,IACRyE,EAAY,IAAIC,UAAUN,EAAQrG,KAAMqG,EAAQG,cAChDJ,EAAkBzC,KAAK,CACtB3D,KAAMqG,EAAQrG,KACdwG,aAAcH,EAAQG,aACtBhQ,IAAKkQ,KAqBP,IAlBA,IAAIE,EAAgB,SAASC,GAC5B,IAAIR,EAAUQ,EAAOR,QACrB,OAAIA,EAAQE,WACTM,EAAOpD,IAAM,GAAKoD,EAAOpD,IAAM,GAAKoD,EAAOC,IAAM,GAAKD,EAAOC,IAAM,GACnED,EAAOpD,IAAOoD,EAAOE,MAAQ,GAAMF,EAAOpD,IAAOoD,EAAOE,MAAQ,GAAMF,EAAOC,IAAM,GAAKD,EAAOC,IAAM,GACrGD,EAAOpD,IAAM,GAAKoD,EAAOpD,IAAM,GAAKoD,EAAOC,IAAOD,EAAOE,MAAQ,GAAMF,EAAOC,IAAOD,EAAOE,MAAQ,GAE/FV,EAAQE,SAETF,EAAQC,YAEZS,EAAQL,EAAUM,iBAClBC,EAAYZ,EAAQ/E,KACpB4F,EAAeb,EAAQI,UAEvBU,GAASF,EAAYF,GAAOK,YAAY,GACxCC,GAASJ,EAAYF,GAAOK,YAAY,GAEnC3D,EAAM,EAAGA,EAAMsD,EAAOtD,IAC9B,IAAK,IAAIqD,EAAM,EAAGA,EAAMC,EAAOD,IAAO,CACrC,IAAIQ,EAAK7F,KAAKC,MAAMoF,EAAM,GAAKK,GAAS1F,KAAK8F,MAAMT,EAAMK,GACrDK,EAAK/F,KAAKC,MAAM+B,EAAM,GAAK0D,GAAS1F,KAAK8F,MAAM9D,EAAM0D,GACrDb,EAAaM,EAAc,CAC9BnD,IAAKA,EACLqD,IAAKA,EACLC,MAAOA,EACPV,QAASA,IAEV3J,EAAQiC,aAAa+H,EAAUe,QAAQhE,GAAKqD,GAAOR,EAAaD,EAAQrK,YACxEU,EAAQkC,SAASyH,EAAQjG,GAAKqB,KAAKiG,MAAMZ,EAAMK,GAAQd,EAAQhG,GAAKoB,KAAKiG,MAAMjE,EAAM4D,GAAQC,EAAGE,GAGlG,GAAInB,EAAQxQ,MAAO,KAMT8R,EAAT,SAAyBC,EAAMvI,EAAGC,EAAGxC,EAAOC,EAAQ4D,EAAGF,EAAWQ,EAAMD,GACvE4G,EAAKpH,aAAaC,GAClBmH,EAAKjJ,aAAa0H,EAAQrK,YAC1B4L,EAAKtH,eAAe+F,EAAQrK,YAC5B4L,EAAKhH,YACLgH,EAAK/G,OAAOxB,EAAIsB,EAAGrB,GACnBsI,EAAK9G,MAAMzB,EAAIvC,EAAOwC,EAAGD,EAAIvC,EAAOwC,EAAIqB,EAAGA,GAC3CiH,EAAK9G,MAAMzB,EAAIvC,EAAOwC,EAAIvC,EAAQsC,EAAIvC,EAAQ6D,EAAGrB,EAAIvC,EAAQ4D,GAC7DiH,EAAK9G,MAAMzB,EAAGC,EAAIvC,EAAQsC,EAAGC,EAAIvC,EAAS4D,EAAGA,GAC7CiH,EAAK9G,MAAMzB,EAAGC,EAAGD,EAAIsB,EAAGrB,EAAGqB,GAC3BiH,EAAK7G,YACDE,GACH2G,EAAK3G,OAEFD,GACH4G,EAAK5G,UApBH3B,EAAIgH,EAAQjG,GAAKtE,SAASmL,EAAYC,GAAgB,GAAGW,QAAQ,IACjEvI,EAAI+G,EAAQhG,GAAKvE,SAASmL,EAAYC,GAAgB,GAAGW,QAAQ,IACrEF,EAAgBjL,EAAS2C,EAAGC,EAAG4H,EAAcA,EAAc,EAAG,GAAG,GAAM,GACvExK,EAAQ+B,UAAU4H,EAAQxQ,MAAOwJ,EAAGC,EAAG4H,EAAcA,GAqBtDxS,UAAKF,IAAI,eACTE,UAAKQ,cAIN,SAAS+H,EAA4B3H,GAIhCA,EAFHC,gBAEGD,EADHE,KAED,OAAO,IAAIE,QAAJ,mCAAY,WAAO+F,EAASC,GAAhB,8FAEjBhH,UAAKE,YAAY,aAFA,SAGWkT,EAA8BxS,GAHzC,OAGXwD,EAHW,OAIjBpE,UAAKQ,cACLuG,EAAQ3C,GALS,mDAOjBpE,UAAKQ,cACLR,UAAKS,UAAU,eAAiBuC,KAAKC,UAAL,OAChCjD,UAAKF,IAAIkD,KAAKC,UAAL,OACT+D,EAAO,EAAD,IAVW,yDAAZ,yDA2BR,SAASqM,EAAiBvS,EAAM+B,GAC/B7C,UAAK+C,WAAWuQ,EAAcxS,GAAO+B,GAGtC,SAASyQ,EAAcxS,GACtB,OAAO6F,GAA+B7F,GAAQ,WAG/C,SAASsS,EAA8BxS,EAAM2S,GAAS,IAEpD1S,EAEGD,EAFHC,gBACAC,EACGF,EADHE,KAGD,OADAd,UAAKF,IAAI,qBACF,IAAIkB,QAAJ,mCAAY,WAAO+F,EAASC,GAAhB,gGAEjBhH,UAAKE,YAAY,aACjBF,UAAKF,IAAI,kCACGe,EAJK,qBAIWA,EAJX,uCAIkCb,UAAKW,aAAaC,GAJpD,kCAIbO,EAJa,eAKF6M,EAAe7M,GALb,eAKjBA,EALiB,OAMjBnB,UAAKF,IAAI,cAAgBqB,GANR,UAOWnB,UAAKiE,8BAA8B9C,GAP9C,WAOXiD,EAPW,QAQbA,EARa,wBAShBpE,UAAKF,IAAI,cAAgBsE,GATT,UAUOpE,UAAKmF,uBAAuBf,GAVnC,QAUVoP,EAVU,OAWhBxT,UAAKF,IAAI,YACH2T,EAAY,CACjB3O,KAAMV,EACNgE,MAAOoL,EAASpL,MAChBC,OAAQmL,EAASnL,OACjB/B,KAAMtG,UAAK+E,eAAe5D,IAE3BnB,UAAKF,IAAI,eAAiBkD,KAAKC,UAAUwQ,IAGzCJ,EAAiBvS,EAAD,KAAY2S,IAI5BzT,UAAKQ,cACLR,UAAKF,IAAI,aACTiH,EAAQ,EAAD,GAAM0M,IA3BG,wBA8BhBzT,UAAKQ,cACLwG,EAAO,0BA/BS,6DAmCjBA,EAAO,EAAD,IAnCW,0DAAZ,yDAyCRP,EAAOC,QAAU,CAChBI,iBACAgC,UACAD,WACAsB,WACAJ,YACAK,aACAC,eACAC,iBACAC,sBACAC,uB,6DClyCG,SAASkJ,EAAeC,GAEpB,IAAIC,EAAIC,EAAIC,EACZ,OAAIH,EAAO,IACA,CAACA,GAEDA,EAAO,MACdC,EAAK,KAAOD,GAAQ,GACpBE,EAAK,KAAc,GAAPF,GACL,CAACC,EAAIC,KAGZD,EAAK,KAAOD,GAAQ,IACpBE,EAAK,KAAOF,GAAQ,EAAI,IACxBG,EAAK,KAAc,GAAPH,GACL,CAACC,EAAIC,EAAIC,IAQxB,SAASC,EAAaC,GAElB,IADA,IAAIC,EAAY,GACPxO,EAAI,EAAGA,EAAIuO,EAAO9O,OAAQO,IAG/B,IAFA,IAAIkO,EAAOK,EAAOE,WAAWzO,GACzB0O,EAAOT,EAAeC,GACjBnG,EAAI,EAAGA,EAAI2G,EAAKjP,OAAQsI,IAC7ByG,EAAUhF,KAAKkF,EAAK3G,IAG5B,OAAOyG,EAOI,SAAShC,EAAUpP,EAAMuR,GACpC1O,KAAK2O,YAAc,EACnB3O,KAAK0O,kBAAoBA,EACzB1O,KAAKqN,QAAU,KACfrN,KAAK4O,YAAc,EACnB5O,KAAK6O,UAAY,KACjB7O,KAAK8O,SAAW,KAChB9O,KAAK+O,gBAAkB,EACvB/O,KAAK7C,KAAOA,EACZ6C,KAAKgP,UAAYX,EAAalR,GAC9B6C,KAAKiP,O,6DAET1C,EAAUxQ,UAAY,CAClBmT,YAAa3C,EAKbK,eAAgB,WACZ,OAAO5M,KAAK4O,aAKhBK,KAAM,WACFjP,KAAKmP,eACLnP,KAAK6O,UAAY7O,KAAKoP,aACtBpP,KAAKqP,gBAOTC,SAAU,SAAUC,GAChBvP,KAAK4O,YAAgC,EAAlB5O,KAAK2O,WAAiB,GACzC3O,KAAKqN,QAAU,IAAImC,MAAMxP,KAAK4O,aAC9B,IAAK,IAAIvF,EAAM,EAAGA,EAAMrJ,KAAK4O,YAAavF,IACtCrJ,KAAKqN,QAAQhE,GAAO,IAAImG,MAAMxP,KAAK4O,aAEvC5O,KAAKyP,0BAA0B,EAAG,GAClCzP,KAAKyP,0BAA0BzP,KAAK4O,YAAc,EAAG,GACrD5O,KAAKyP,0BAA0B,EAAGzP,KAAK4O,YAAc,GACrD5O,KAAK0P,6BACL1P,KAAK2P,qBACL3P,KAAK4P,eAAc,EAAML,GACrBvP,KAAK2O,YAAc,GACnB3O,KAAK6P,iBAAgB,GAEzB7P,KAAK8P,QAAQ9P,KAAK6O,UAAWU,IAOjCE,0BAA2B,SAAUpG,EAAKqD,GACtC,IAAK,IAAInG,GAAK,EAAGA,GAAK,EAAGA,IACrB,KAAI8C,EAAM9C,IAAM,GAAKvG,KAAK4O,aAAevF,EAAM9C,GAC/C,IAAK,IAAIwJ,GAAK,EAAGA,GAAK,EAAGA,IACjBrD,EAAMqD,IAAM,GAAK/P,KAAK4O,aAAelC,EAAMqD,IAE3C/P,KAAKqN,QAAQhE,EAAM9C,GAAGmG,EAAMqD,GAD3B,GAAKxJ,GAAKA,GAAK,IAAW,GAALwJ,GAAe,GAALA,IAAa,GAAKA,GAAKA,GAAK,IAAW,GAALxJ,GAAe,GAALA,IAAa,GAAKA,GAAKA,GAAK,GAAK,GAAKwJ,GAAKA,GAAK,IAY5IV,aAAc,WAIV,IAHA,IAAIW,EAAe,EACfC,EAAU,EACVC,EAAc,KACTnQ,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxBC,KAAKsP,SAASvP,GACd,IAAIoQ,EAAYC,EAAOC,aAAarQ,OAC3B,GAALD,GAAUiQ,EAAeG,KACzBH,EAAeG,EACfF,EAAUlQ,EACVmQ,EAAclQ,KAAKqN,SAG3BrN,KAAKqN,QAAU6C,EACflQ,KAAK4P,eAAc,EAAOK,GACtBjQ,KAAK2O,YAAc,GACnB3O,KAAK6P,iBAAgB,IAO7BF,mBAAoB,WAChB,IAAK,IAAIpJ,EAAI,EAAGA,EAAIvG,KAAK4O,YAAc,EAAGrI,IACZ,MAAtBvG,KAAKqN,QAAQ9G,GAAG,KAGpBvG,KAAKqN,QAAQ9G,GAAG,GAAMA,EAAI,GAAK,EACL,MAAtBvG,KAAKqN,QAAQ,GAAG9G,KAGpBvG,KAAKqN,QAAQ,GAAG9G,GAAMA,EAAI,GAAK,KAOvCmJ,2BAA4B,WAExB,IADA,IAAIY,EAAMF,EAAOG,mBAAmBvQ,KAAK2O,YAChC5O,EAAI,EAAGA,EAAIuQ,EAAI9Q,OAAQO,IAC5B,IAAK,IAAI+H,EAAI,EAAGA,EAAIwI,EAAI9Q,OAAQsI,IAAK,CACjC,IAAIuB,EAAMiH,EAAIvQ,GACV2M,EAAM4D,EAAIxI,GACd,GAA8B,MAA1B9H,KAAKqN,QAAQhE,GAAKqD,GAGtB,IAAK,IAAInG,GAAK,EAAGA,GAAK,EAAGA,IACrB,IAAK,IAAIwJ,GAAK,EAAGA,GAAK,EAAGA,IAEjB/P,KAAKqN,QAAQhE,EAAM9C,GAAGmG,EAAMqD,IADtB,GAANxJ,GAAgB,GAALA,IAAgB,GAANwJ,GAAgB,GAALA,GAAgB,GAALxJ,GAAe,GAALwJ,IAe7EF,gBAAiB,SAAU3H,GAEvB,IADA,IAAIsI,EAAOJ,EAAOK,iBAAiBzQ,KAAK2O,YAC/B5O,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAI2Q,GAAQxI,GAA6B,IAAnBsI,GAAQzQ,EAAK,GACnCC,KAAKqN,QAAQhG,KAAK8F,MAAMpN,EAAI,IAAIA,EAAI,EAAIC,KAAK4O,YAAc,EAAI,GAAK8B,EACpE1Q,KAAKqN,QAAQtN,EAAI,EAAIC,KAAK4O,YAAc,EAAI,GAAGvH,KAAK8F,MAAMpN,EAAI,IAAM2Q,IAS5Ed,cAAe,SAAU1H,EAAMqH,GAI3B,IAHA,IAAIpS,EAAQwT,EAAoB3Q,KAAK0O,oBAAsB,EAAKa,EAC5DiB,EAAOJ,EAAOQ,eAAezT,GAExB4C,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAI2Q,GAAQxI,GAA6B,IAAnBsI,GAAQzQ,EAAK,GAC/BA,EAAI,EACJC,KAAKqN,QAAQtN,GAAG,GAAK2Q,EACd3Q,EAAI,EACXC,KAAKqN,QAAQtN,EAAI,GAAG,GAAK2Q,EAEzB1Q,KAAKqN,QAAQrN,KAAK4O,YAAc,GAAK7O,GAAG,GAAK2Q,EAG7CA,GAAQxI,GAA6B,IAAnBsI,GAAQzQ,EAAK,GAC/BA,EAAI,EACJC,KAAKqN,QAAQ,GAAGrN,KAAK4O,YAAc7O,EAAI,GAAK2Q,EACrC3Q,EAAI,EACXC,KAAKqN,QAAQ,GAAG,GAAKtN,EAAI,EAAI,GAAK2Q,EAElC1Q,KAAKqN,QAAQ,GAAG,GAAKtN,EAAI,GAAK2Q,EAItC1Q,KAAKqN,QAAQrN,KAAK4O,YAAc,GAAG,IAAO1G,GAM9CkH,WAAY,WACR,IAAIyB,EAAS,IAAIC,EACbC,EAAa/Q,KAAK2O,WAAa,EAAI,GAAK,EAC5CkC,EAAOG,IAAI,EAAG,GACdH,EAAOG,IAAIhR,KAAKgP,UAAUxP,OAAQuR,GAClC,IAAK,IAAIhR,EAAI,EAAG8H,EAAI7H,KAAKgP,UAAUxP,OAAQO,EAAI8H,EAAG9H,IAC9C8Q,EAAOG,IAAIhR,KAAKgP,UAAUjP,GAAI,GAE9B8Q,EAAOrR,OAAS,GAA2B,EAAtBQ,KAAK+O,gBAC1B8B,EAAOG,IAAI,EAAG,GAGlB,MAAOH,EAAOrR,OAAS,GAAK,EACxBqR,EAAOI,QAAO,GAGlB,MAAO,EAAM,CACT,GAAIJ,EAAOrR,QAAgC,EAAtBQ,KAAK+O,eACtB,MAGJ,GADA8B,EAAOG,IAAIzE,EAAU2E,KAAM,GACvBL,EAAOrR,QAAgC,EAAtBQ,KAAK+O,eACtB,MAEJ8B,EAAOG,IAAIzE,EAAU4E,KAAM,GAE/B,OAAOnR,KAAKoR,YAAYP,IAO5BO,YAAa,SAAUP,GAMnB,IALA,IAAIQ,EAAS,EACTC,EAAa,EACbC,EAAa,EACb/R,EAASQ,KAAKwR,QAAQhS,OAAS,EAC/BsP,EAAW,IAAIU,MACVzP,EAAI,EAAGA,EAAIP,EAAQO,IAIxB,IAHA,IAAI4M,EAAQ3M,KAAKwR,QAAY,EAAJzR,EAAQ,GAC7B0R,EAAazR,KAAKwR,QAAY,EAAJzR,EAAQ,GAClC2R,EAAY1R,KAAKwR,QAAY,EAAJzR,EAAQ,GAC5B+H,EAAI,EAAGA,EAAI6E,EAAO7E,IACvBgH,EAASvF,KAAK,CAACmI,EAAWD,IAKlC,IAFA,IAAIE,EAAS,IAAInC,MAAMV,EAAStP,QAC5BoS,EAAS,IAAIpC,MAAMV,EAAStP,QACvB+G,EAAI,EAAGA,EAAIuI,EAAStP,OAAQ+G,IAAK,CACtC,IAAIsL,EAAU/C,EAASvI,GAAG,GACtBuL,EAAUhD,EAASvI,GAAG,GAAKsL,EAC/BP,EAAajK,KAAK0K,IAAIT,EAAYO,GAClCN,EAAalK,KAAK0K,IAAIR,EAAYO,GAClCH,EAAOpL,GAAK,IAAIiJ,MAAMqC,GACtB,IAAS9R,EAAI,EAAGA,EAAI4R,EAAOpL,GAAG/G,OAAQO,IAClC4R,EAAOpL,GAAGxG,GAAK,IAAO8Q,EAAOA,OAAO9Q,EAAIsR,GAE5CA,GAAUQ,EACV,IAAIG,EAAS5B,EAAO6B,0BAA0BH,GAC1CI,EAAU,IAAIC,EAAaR,EAAOpL,GAAIyL,EAAOI,YAAc,GAC3DC,EAAUH,EAAQxB,IAAIsB,GAC1BJ,EAAOrL,GAAK,IAAIiJ,MAAMwC,EAAOI,YAAc,GAC3C,IAASrS,EAAI,EAAGA,EAAI6R,EAAOrL,GAAG/G,OAAQO,IAAK,CACvC,IAAIuS,EAAWvS,EAAIsS,EAAQD,YAAcR,EAAOrL,GAAG/G,OACnDoS,EAAOrL,GAAGxG,GAAMuS,GAAY,EAAKD,EAAQE,IAAID,GAAY,GAGjE,IAAInV,EAAO,IAAIqS,MAAMxP,KAAK+O,gBACtBhQ,EAAQ,EACZ,IAASgB,EAAI,EAAGA,EAAIuR,EAAYvR,IAC5B,IAASwG,EAAI,EAAGA,EAAIuI,EAAStP,OAAQ+G,IAC7BxG,EAAI4R,EAAOpL,GAAG/G,SACdrC,EAAK4B,KAAW4S,EAAOpL,GAAGxG,IAItC,IAASA,EAAI,EAAGA,EAAIwR,EAAYxR,IAC5B,IAASwG,EAAI,EAAGA,EAAIuI,EAAStP,OAAQ+G,IAC7BxG,EAAI6R,EAAOrL,GAAG/G,SACdrC,EAAK4B,KAAW6S,EAAOrL,GAAGxG,IAItC,OAAO5C,GASX2S,QAAS,SAAU3S,EAAMoS,GAKrB,IAJA,IAAIiD,GAAO,EACPnJ,EAAMrJ,KAAK4O,YAAc,EACzB6D,EAAW,EACXC,EAAY,EACPhG,EAAM1M,KAAK4O,YAAc,EAAGlC,EAAM,EAAGA,GAAO,EAAG,CACzC,GAAPA,GAAUA,IACd,MAAO,EAAM,CACT,IAAK,IAAIqD,EAAI,EAAGA,EAAI,EAAGA,IACnB,GAAkC,MAA9B/P,KAAKqN,QAAQhE,GAAKqD,EAAMqD,GAAY,CACpC,IAAI4C,GAAO,EACPD,EAAYvV,EAAKqC,SACjBmT,EAAgD,IAAtCxV,EAAKuV,KAAeD,EAAY,IAE9C,IAAI5X,EAAOuV,EAAOwC,QAAQrD,EAAalG,EAAKqD,EAAMqD,GAC9ClV,IACA8X,GAAQA,GAEZ3S,KAAKqN,QAAQhE,GAAKqD,EAAMqD,GAAK4C,EAC7BF,KACiB,GAAbA,IACAC,IACAD,EAAW,GAKvB,GADApJ,GAAOmJ,EACHnJ,EAAM,GAAKrJ,KAAK4O,aAAevF,EAAK,CACpCA,GAAOmJ,EACPA,GAAOA,EACP,WASpBjG,EAAU2E,KAAO,IACjB3E,EAAU4E,KAAO,GAsQjB,IAlQA,IAAIR,EAAsB,CAAC,EAAG,EAAG,EAAG,GAIhCkC,EAAgB,CAChBC,WAAY,EACZC,WAAY,EACZC,WAAY,EACZC,WAAY,EACZC,WAAY,EACZC,WAAY,EACZC,WAAY,EACZC,WAAY,GAKZjD,EAAS,CAITkD,uBAAwB,CACpB,GACA,CAAC,EAAG,IACJ,CAAC,EAAG,IACJ,CAAC,EAAG,IACJ,CAAC,EAAG,IACJ,CAAC,EAAG,IACJ,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,IACZ,CAAC,EAAG,GAAI,GAAI,GAAI,IAChB,CAAC,EAAG,GAAI,GAAI,GAAI,IAChB,CAAC,EAAG,GAAI,GAAI,GAAI,KAChB,CAAC,EAAG,GAAI,GAAI,GAAI,KAChB,CAAC,EAAG,GAAI,GAAI,GAAI,KAChB,CAAC,EAAG,GAAI,GAAI,GAAI,KAChB,CAAC,EAAG,GAAI,GAAI,GAAI,KAChB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,KACpB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACrB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACrB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACrB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACrB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACrB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACrB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAC1B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAC1B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAC1B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAC1B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,KAC1B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,IAAK,MAE9BC,IAAM,KACNC,IAAM,KACNC,SAAW,MAIX7C,eAAgB,SAAUzT,GACtB,IAAI0B,EAAI1B,GAAQ,GAChB,MAAOiT,EAAOsD,YAAY7U,GAAKuR,EAAOsD,YAAYtD,EAAOmD,MAAQ,EAC7D1U,GAAMuR,EAAOmD,KAAQnD,EAAOsD,YAAY7U,GAAKuR,EAAOsD,YAAYtD,EAAOmD,KAE3E,OAASpW,GAAQ,GAAM0B,GAAKuR,EAAOqD,UAKvChD,iBAAkB,SAAUtT,GACxB,IAAI0B,EAAI1B,GAAQ,GAChB,MAAOiT,EAAOsD,YAAY7U,GAAKuR,EAAOsD,YAAYtD,EAAOoD,MAAQ,EAC7D3U,GAAMuR,EAAOoD,KAAQpD,EAAOsD,YAAY7U,GAAKuR,EAAOsD,YAAYtD,EAAOoD,KAE3E,OAAQrW,GAAQ,GAAM0B,GAK1B6U,YAAa,SAAUvW,GACnB,IAAIwW,EAAQ,EACZ,MAAe,GAARxW,EACHwW,IACAxW,KAAU,EAEd,OAAOwW,GAKXpD,mBAAoB,SAAU5B,GAC1B,OAAOyB,EAAOkD,uBAAuB3E,EAAa,IAKtDiE,QAAS,SAAUrD,EAAaxP,EAAG+H,GAC/B,OAAQyH,GACJ,KAAKsD,EAAcC,WACf,OAAQ/S,EAAI+H,GAAK,GAAK,EAC1B,KAAK+K,EAAcE,WACf,OAAOhT,EAAI,GAAK,EACpB,KAAK8S,EAAcG,WACf,OAAOlL,EAAI,GAAK,EACpB,KAAK+K,EAAcI,WACf,OAAQlT,EAAI+H,GAAK,GAAK,EAC1B,KAAK+K,EAAcK,WACf,OAAQ7L,KAAK8F,MAAMpN,EAAI,GAAKsH,KAAK8F,MAAMrF,EAAI,IAAM,GAAK,EAC1D,KAAK+K,EAAcM,WACf,OAAQpT,EAAI+H,EAAK,EAAK/H,EAAI+H,EAAK,GAAK,EACxC,KAAK+K,EAAcO,WACf,OAASrT,EAAI+H,EAAK,EAAK/H,EAAI+H,EAAK,GAAK,GAAK,EAC9C,KAAK+K,EAAcQ,WACf,OAAStT,EAAI+H,EAAK,GAAK/H,EAAI+H,GAAK,GAAK,GAAK,EAC9C,QACI,MAAM,IAAI8L,MAAM,mBAAqBrE,KAMjD0C,0BAA2B,SAAU4B,GAEjC,IADA,IAAIlQ,EAAI,IAAIwO,EAAa,CAAC,GAAI,GACrBpS,EAAI,EAAGA,EAAI8T,EAAoB9T,IACpC4D,EAAIA,EAAEmQ,SAAS,IAAI3B,EAAa,CAAC,EAAG4B,EAAOC,KAAKjU,IAAK,IAEzD,OAAO4D,GAKX0M,aAAc,SAAU4D,GAIpB,IAHA,IAAIrF,EAAcqF,EAAOrH,iBACrBuD,EAAY,EACZ+D,EAAY,EACP7K,EAAM,EAAGA,EAAMuF,EAAavF,IAGjC,IAFA,IAAI8K,EAAY,EACZC,EAAOH,EAAO5G,QAAQhE,GAAK,GACtBqD,EAAM,EAAGA,EAAMkC,EAAalC,IAAO,CACxC,IAAI2H,EAAUJ,EAAO5G,QAAQhE,GAAKqD,GAgBlC,GAdIA,EAAMkC,EAAc,GAChByF,IAAYJ,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,KAAOuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,KACnMA,EAAMkC,EAAc,GAChBqF,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,MAC1HyD,GAAa,IAEVzD,EAAM,GACTuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAMuH,EAAO5G,QAAQhE,GAAKqD,EAAM,KAC1HyD,GAAa,KAMxB9G,EAAMuF,EAAc,GAAOlC,EAAMkC,EAAc,EAAI,CACpD,IAAIjC,EAAQ,EACR0H,GAAS1H,IACTsH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAMC,IAC9BsH,EAAO5G,QAAQhE,GAAKqD,EAAM,IAAIC,IAC9BsH,EAAO5G,QAAQhE,EAAM,GAAGqD,EAAM,IAAIC,IACzB,GAATA,GAAuB,GAATA,IACdwD,GAAa,GAIjBiE,EAAOC,EACPF,KAEAC,EAAOC,EACHF,GAAa,IACbhE,GAAc,EAAIgE,EAAY,GAElCA,EAAY,GAGZE,GACAH,IAIZ,IAASxH,EAAM,EAAGA,EAAMkC,EAAalC,IAGjC,IAFIyH,EAAY,EACZC,EAAOH,EAAO5G,QAAQ,GAAGX,GACpBrD,EAAM,EAAGA,EAAMuF,EAAavF,IAAO,CACpCgL,EAAUJ,EAAO5G,QAAQhE,GAAKqD,GAE9BrD,EAAMuF,EAAc,GAChByF,IAAYJ,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,KAASuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,KACjMrD,EAAMuF,EAAc,GAChBqF,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,IAAIqD,KACzHyD,GAAa,IAEV9G,EAAM,GACT4K,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,IAAQuH,EAAO5G,QAAQhE,EAAM,GAAGqD,KACxHyD,GAAa,KAMzBiE,EAAOC,EACPF,KAEAC,EAAOC,EACHF,GAAa,IACbhE,GAAc,EAAIgE,EAAY,GAElCA,EAAY,GAKxB,IAAIG,EAAQjN,KAAKkN,IAAI,IAAML,EAAYtF,EAAcA,EAAc,IAAM,EAEzE,OADAuB,GAAqB,GAARmE,EACNnE,IAOX4D,EAAS,CAITS,KAAM,SAAUtR,GACZ,GAAIA,EAAI,EACJ,MAAM,IAAI0Q,MAAM,QAAU1Q,EAAI,KAElC,OAAO6Q,EAAOU,UAAUvR,IAK5B8Q,KAAM,SAAU9Q,GACZ,MAAOA,EAAI,EACPA,GAAK,IAET,MAAOA,GAAK,IACRA,GAAK,IAET,OAAO6Q,EAAOW,UAAUxR,IAE5BwR,UAAW,IAAIlF,MAAM,KACrBiF,UAAW,IAAIjF,MAAM,MAGhBzP,EAAI,EAAGA,EAAI,EAAGA,IACnBgU,EAAOW,UAAU3U,GAAK,GAAKA,EAE/B,IAASA,EAAI,EAAGA,EAAI,IAAKA,IACrBgU,EAAOW,UAAU3U,GAAKgU,EAAOW,UAAU3U,EAAI,GAAKgU,EAAOW,UAAU3U,EAAI,GAAKgU,EAAOW,UAAU3U,EAAI,GAAKgU,EAAOW,UAAU3U,EAAI,GAE7H,IAASA,EAAI,EAAGA,EAAI,IAAKA,IACrBgU,EAAOU,UAAUV,EAAOW,UAAU3U,IAAMA,EAU5C,SAASoS,EAAawC,EAAKC,GACvB,QAAkBpY,GAAdmY,EAAInV,OACJ,MAAM,IAAIoU,MAAMe,EAAInV,OAAS,IAAMoV,GAEvC,IAAIvD,EAAS,EACb,MAAOA,EAASsD,EAAInV,QAAyB,GAAfmV,EAAItD,GAC9BA,IAEJrR,KAAK2U,IAAM,IAAInF,MAAMmF,EAAInV,OAAS6R,EAASuD,GAC3C,IAAK,IAAI7U,EAAI,EAAGA,EAAI4U,EAAInV,OAAS6R,EAAQtR,IACrCC,KAAK2U,IAAI5U,GAAK4U,EAAI5U,EAAIsR,GAG9Bc,EAAapW,UAAY,CACrBwW,IAAK,SAAUxT,GACX,OAAOiB,KAAK2U,IAAI5V,IAEpBqT,UAAW,WACP,OAAOpS,KAAK2U,IAAInV,QAOpBsU,SAAU,SAAU3T,GAEhB,IADA,IAAIwU,EAAM,IAAInF,MAAMxP,KAAKoS,YAAcjS,EAAEiS,YAAc,GAC9CrS,EAAI,EAAGA,EAAIC,KAAKoS,YAAarS,IAClC,IAAK,IAAI+H,EAAI,EAAGA,EAAI3H,EAAEiS,YAAatK,IAC/B6M,EAAI5U,EAAI+H,IAAMiM,EAAOC,KAAKD,EAAOS,KAAKxU,KAAKuS,IAAIxS,IAAMgU,EAAOS,KAAKrU,EAAEoS,IAAIzK,KAG/E,OAAO,IAAIqK,EAAawC,EAAK,IAOjCjE,IAAK,SAAUvQ,GACX,IAAI0U,EAAK7U,KAAKoS,YACV0C,EAAK3U,EAAEiS,YACX,GAAIyC,EAAKC,EAAK,EACV,OAAO9U,KAGX,IADA,IAAI2U,EAAM,IAAInF,MAAMqF,GACX9U,EAAI,EAAGA,EAAI8U,EAAI9U,IACpB4U,EAAI5U,GAAKC,KAAKuS,IAAIxS,GAEtB,MAAO4U,EAAInV,QAAUsV,EAAI,CACrB,IAAIR,EAAQP,EAAOS,KAAKG,EAAI,IAAMZ,EAAOS,KAAKrU,EAAEoS,IAAI,IAEpD,IAASxS,EAAI,EAAGA,EAAII,EAAEiS,YAAarS,IAC/B4U,EAAI5U,IAAMgU,EAAOC,KAAKD,EAAOS,KAAKrU,EAAEoS,IAAIxS,IAAMuU,GAElD,MAAiB,GAAVK,EAAI,GACPA,EAAIC,QAGZ,OAAO,IAAIzC,EAAawC,EAAK,KAUrC,IAAII,EAAiB,CAMjB,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,GAGR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IAGR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IAGR,CAAC,EAAG,IAAK,IACT,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,GAGR,CAAC,EAAG,IAAK,KACT,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IAGR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,IACR,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,IAAK,IACT,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,IAAK,KACT,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,IAAK,IACT,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,IAAK,GAAI,EAAG,IAAK,IACrB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IAGnB,CAAC,EAAG,IAAK,KACT,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IAGpB,CAAC,EAAG,IAAK,GAAI,EAAG,IAAK,IACrB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,GAAI,GAAI,IAGT,CAAC,EAAG,IAAK,GAAI,EAAG,IAAK,IACrB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,EAAG,GAAI,IACnB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,GAAI,GAAI,IACT,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,GAAI,GAAI,IACT,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,IAGT,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IAGpB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,GAAI,IAAK,KACvB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,EAAG,IAAK,KACtB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,GAAI,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,KACV,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IAGpB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,GAAI,IAAK,KACvB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,IAGpB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,EAAG,IAAK,IAAK,GAAI,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,EAAG,GAAI,IACpB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGrB,CAAC,GAAI,IAAK,IAAK,EAAG,IAAK,KACvB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IACrB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,KAiCzB,SAASjE,IACL9Q,KAAK6Q,OAAS,IAAIrB,MAClBxP,KAAKR,OAAS,EA5BlB+M,EAAUxQ,UAAUoT,aAAe,WAC/B,IAAK,IAAIR,EAAa,EAAGA,EAAa,GAAIA,IAAc,CACpD,IAAI6C,EAAUuD,EAAkC,GAAlBpG,EAAa,GAAS3O,KAAK0O,mBACzD,QAAelS,GAAXgV,EACA,MAAM,IAAIoC,MAAM,6BAA+BjF,EAAa,sBAAwB3O,KAAK0O,mBAI7F,IAFA,IAAIlP,EAASgS,EAAQhS,OAAS,EAC1BuP,EAAiB,EACZhP,EAAI,EAAGA,EAAIP,EAAQO,IAAK,CAC7B,IAAI4M,EAAQ6E,EAAY,EAAJzR,EAAQ,GACxB2R,EAAYF,EAAY,EAAJzR,EAAQ,GAChCgP,GAAkB2C,EAAY/E,EAElC,IAAIqI,EAAcrG,EAAa,EAAI,EAAI,EACvC,GAAI3O,KAAKgP,UAAUxP,OAASwV,EAAcjG,GAAgC,IAAdJ,EAAkB,CAC1E3O,KAAK2O,WAAaA,EAClB3O,KAAKwR,QAAUA,EACfxR,KAAK+O,eAAiBA,EACtB,SAYZ+B,EAAY/U,UAAY,CACpBwW,IAAK,SAAUxT,GACX,IAAIkW,EAAW5N,KAAK8F,MAAMpO,EAAQ,GAClC,OAASiB,KAAK6Q,OAAOoE,KAAe,EAAIlW,EAAQ,EAAM,GAE1DiS,IAAK,SAAU2D,EAAKnV,GAChB,IAAK,IAAIO,EAAI,EAAGA,EAAIP,EAAQO,IACxBC,KAAKiR,OAAS0D,IAASnV,EAASO,EAAI,EAAM,IAGlDkR,OAAQ,SAAUiE,GACd,IAAID,EAAW5N,KAAK8F,MAAMnN,KAAKR,OAAS,GACpCQ,KAAK6Q,OAAOrR,QAAUyV,GACtBjV,KAAK6Q,OAAOtH,KAAK,GAEjB2L,IACAlV,KAAK6Q,OAAOoE,IAAc,MAAUjV,KAAKR,OAAS,GAEtDQ,KAAKR,Y,iCC9+BjB,SAAS2V,EAAiB/V,GACtB,GAA6B,IAAzBA,EAAKgW,QAAQ,SAA0C,IAAzBhW,EAAKgW,QAAQ,SAAgD,IAA/BhW,EAAKgW,QAAQ,eAAsD,IAA/BhW,EAAKgW,QAAQ,cAC7G,OAAOhW,EAEX,GAAgC,IAA5BA,EAAKgW,QAAQ,WACb,OAAOhW,EAEX,GAA6C,IAAzCA,EAAKgW,QAAQ,wBACb,OAAOhW,EAEX,GAA0B,IAAtBA,EAAKgW,QAAQ,KAAY,CACzB,IAAIC,EAAgBC,KAAKC,GAAGC,0BAA0BpW,GACtD,GAAIiW,IAAkBjW,EAClB,OAAOiW,EAEPjW,EAAOA,EAAK2I,OAAO,GAG3B,MAAO,QAAU3I,EAGd,SAASqW,EAAarW,GACzB,OAAO,IAAI9D,SAAQ,SAAS+F,EAASC,GACjC,GAAsB,kBAAXoU,QAAuB,aAAcA,OAAQ,CACpD,GAA0B,oBAAfC,WAA2B,CAClC,IAAIC,EAAM,IAAIC,eAed,OAdAD,EAAIE,KAAK,MAAO1W,GAAM,GACtBwW,EAAIG,aAAe,OACnBH,EAAII,OAAS,WACT,GAAoB,MAAhBhW,KAAKiW,OAAgB,CACrB,IAAIC,EAAa,IAAIP,WACrBO,EAAWF,OAAS,SAAS7V,GACzBkB,EAAQlB,EAAEgW,OAAOC,SAErBF,EAAWG,QAAU/U,EACrB4U,EAAWI,cAActW,KAAKuW,YAGtCX,EAAIS,QAAU/U,OACdsU,EAAIY,OAGR,IAAIC,EAASC,SAASC,cAAc,UAChCC,EAAMH,EAAOI,WAAW,MACxB/V,EAAM,IAAIgW,MAUd,OATAhW,EAAIkV,OAAS,WACTS,EAAO/T,MAAQ5B,EAAI4B,MACnB+T,EAAO9T,OAAS7B,EAAI6B,OACpBiU,EAAIvS,UAAUvD,EAAK,EAAG,GACtBO,EAAQoV,EAAOM,aACfN,EAAO9T,OAAS8T,EAAO/T,MAAQ,GAEnC5B,EAAIuV,QAAU/U,OACdR,EAAI9C,IAAMoB,GAGM,kBAATkW,KAmBO,kBAAP0B,IAAmBA,GAAGC,QAAQ,wBACrCD,GAAGE,uBAAuBC,SAAS,CAC/BjY,SAAUE,EACVgY,SAAU,SACVna,QAAS,SAASC,GACdmE,EAAQ,yBAA2BnE,EAAIC,OAE3CC,KAAM,SAASia,GACX/V,EAAO+V,MAKnB/V,EAAO,IAAIsS,MAAM,gBA/Bb0B,KAAKC,GAAG+B,0BAA0BnC,EAAiB/V,IAAO,SAASmY,GAC/DA,EAAMC,MAAK,SAASA,GAChB,IAAItB,EAAa,IAAIZ,KAAKC,GAAGI,WAC7BO,EAAWF,OAAS,SAAS7Y,GACzBkE,EAAQlE,EAAKgZ,OAAOC,SAExBF,EAAWG,QAAU,SAASgB,GAC1B/V,EAAO+V,IAEXnB,EAAWI,cAAckB,MAC1B,SAASH,GACR/V,EAAO+V,SAEZ,SAASA,GACR/V,EAAO+V,SAqBhB,SAAS7O,EAAaiP,GACzB,OAAO,IAAInc,SAAQ,SAAS+F,EAASC,GACjC,GAAsB,kBAAXoU,QAAuB,aAAcA,OAAQ,CACpD+B,EAASA,EAAOlY,MAAM,KACtB,IAAInE,EAAOqc,EAAO,GAAGC,MAAM,WAAW,GAClCjO,EAAMkO,KAAKF,EAAO,IAClBvU,EAAIuG,EAAIjK,OACR7D,EAAQ,IAAIic,WAAW1U,GAC3B,MAAOA,IACHvH,EAAMuH,GAAKuG,EAAI+E,WAAWtL,GAE9B,OAAO7B,GAASqU,OAAOmC,KAAOnC,OAAOoC,WAAWC,gBAAgB,IAAIC,KAAK,CAACrc,GAAQ,CAAEP,KAAMA,MAE9F,IAAI6c,EAAUR,EAAOC,MAAM,qBACvBO,EACAA,EAAUA,EAAQ,GAElB3W,EAAO,IAAIsS,MAAM,iBAErB,IAAIsE,EAAWC,KAAKC,MAAQ,IAAMH,EAClC,GAAoB,kBAAT3C,KAiBX,GAAkB,kBAAP0B,IAAmBA,GAAGC,QAAQ,wBAAzC,CACI,IAAI/X,EAAW8X,GAAGqB,IAAIC,eAAiB,IAAMJ,EAC7ClB,GAAGE,uBAAuBqB,UAAU,CAChCrZ,SAAUA,EACV/B,KAAMsa,EAAOe,QAAQ,yBAA0B,IAC/CpB,SAAU,SACVna,QAAS,WACLoE,EAAQnC,IAEZ9B,KAAM,SAASia,GACX/V,EAAO+V,WAKnB/V,EAAO,IAAIsS,MAAM,oBAhCjB,CACI,IAAI6E,EAAS,IAAInD,KAAKoD,UAAUC,OAAO,SAAWR,KAAKC,OACvDK,EAAOG,eAAenB,GAAQ,WAC1B,IAAIvY,EAAW,oBAAsBgZ,EACrCO,EAAOhN,KAAKvM,EAAU,IAAI,WACtBuZ,EAAOI,QACPxX,EAAQnC,MACT,SAASmY,GACRoB,EAAOI,QACPvX,EAAO+V,SAEZ,SAASA,GACRoB,EAAOI,QACPvX,EAAO+V,U","file":"tn_components/common/vendor.js","sourcesContent":["let log = console.log; // 如果在项目的APP.vue文件中的onlaunch中设置 console.log = ()=> {} 则在此也不会有打印信息\r\n// log = ()=>{};\t// 打开注释则该插件不会打印任何信息\r\nlet _app = {\r\n\t//交互控制\r\n\tlog(t) {\r\n\t\tlog(t);\r\n\t}, // 打印控制,\r\n\tshowLoading(msg, ifmask) {\r\n\t\tuni.showLoading({\r\n\t\t\ttitle: msg,\r\n\t\t\tmask: ifmask || false\r\n\t\t})\r\n\t},\r\n\thideLoading() {\r\n\t\tuni.hideLoading();\r\n\t},\r\n\tshowToast(msg, icon) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: msg,\r\n\t\t\ticon: icon || 'none'\r\n\t\t})\r\n\t},\r\n\tgetPosterUrl(objs) { // 后端获取背景图的url路径方法\r\n\t\tlet {\r\n\t\t\tbackgroundImage,\r\n\t\t\ttype,\r\n\t\t\tformData\r\n\t\t} = objs;\r\n\t\treturn new Promise((rs, rj) => {\r\n\t\t\tlet image;\r\n\t\t\tif (backgroundImage) {\r\n\t\t\t\timage = backgroundImage;\r\n\t\t\t}else{\r\n\t\t\t\tswitch (type) { //根据type获取背景图, 一般要改成request获取\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\timage = '';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\timage = '/static/1.png';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (image) {\r\n\t\t\t\trs(image); // resolve图片的路径\r\n\t\t\t}else{\r\n\t\t\t\trj('背景图片路径不存在');\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t//下面一般不用动他\r\n\tshareTypeListSheetArray: {\r\n\t\tarray: [0, 1, 2, 3, 4, 5]\r\n\t}, // 分享类型 0-图文链接 1-纯文字 2-纯图片 3-音乐 4-视频 5-小程序\r\n\tisArray(arg) {\r\n\t\treturn Object.prototype.toString.call(arg) === '[object Array]';\r\n\t},\r\n\tisObject(arg) {\r\n\t\treturn Object.prototype.toString.call(arg) === '[object Object]';\r\n\t},\r\n\tisPromise(obj) {\r\n\t\treturn !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function';\r\n\t},\r\n\tisNull(arg) {\r\n\t\treturn arg === null;\r\n\t},\r\n\tisUndefined(arg) {\r\n\t\treturn arg === undefined;\r\n\t},\r\n\tisUndef(arg) {\r\n\t\treturn arg === undefined;\r\n\t},\r\n\tisNotNull_string(arg) {\r\n\t\treturn arg !== null && arg !== undefined && arg !== '';\r\n\t},\r\n\tisFn(fn) {\r\n\t\treturn fn && typeof fn === 'function';\r\n\t},\r\n\tgetStorage(key, scb, fcb) {\r\n\t\tuni.getStorage({\r\n\t\t\tkey,\r\n\t\t\tsuccess: function(res) {\r\n\t\t\t\tif (res.data && res.data != \"\") {\r\n\t\t\t\t\tif (scb) scb(res.data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (fcb) fcb();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: function() {\r\n\t\t\t\tif (fcb) fcb();\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tsetStorage(key, data) {\r\n\t\tlog('设置缓存')\r\n\t\tlog('key：' + key)\r\n\t\tlog('data：' + JSON.stringify(data));\r\n\t\tuni.setStorage({\r\n\t\t\tkey,\r\n\t\t\tdata\r\n\t\t})\r\n\t},\r\n\tsetStorageSync(key, data) {\r\n\t\tuni.setStorageSync(key, data);\r\n\t},\r\n\tgetStorageSync(key) {\r\n\t\treturn uni.getStorageSync(key);\r\n\t},\r\n\tclearStorageSync() {\r\n\t\tuni.clearStorageSync();\r\n\t},\r\n\tremoveStorageSync(key) {\r\n\t\tuni.removeStorageSync(key);\r\n\t},\r\n\tgetImageInfo(url, cb, fcb) {\r\n\t\turl = checkMPUrl(url);\r\n\t\tuni.getImageInfo({\r\n\t\t\tsrc: url,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tif (cb && typeof(cb) == 'function') cb(res);\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tif (fcb && typeof(fcb) == 'function') fcb(err);\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tdownloadFile(url, cb) {\r\n\t\turl = checkMPUrl(url);\r\n\t\tuni.downloadFile({\r\n\t\t\turl,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tif (cb && typeof(cb) == 'function') cb(res);\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tdownloadFile_PromiseFc(url) {\r\n\t\treturn new Promise((rs, rj) => {\r\n\t\t\tif (url.substring(0, 4) !== 'http') {\r\n\t\t\t\trs(url);\r\n\t\t\t}else {\r\n\t\t\t\turl = checkMPUrl(url);\r\n\t\t\t\tlog('url:' + url);\r\n\t\t\t\tuni.downloadFile({\r\n\t\t\t\t\turl,\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif (res && res.tempFilePath)\r\n\t\t\t\t\t\t\trs(res.tempFilePath);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\trj('not find tempFilePath');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\trj(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tsaveFile(url) {\r\n\t\tuni.saveFile({\r\n\t\t\ttempFilePath: url,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tlog('保存成功:' + JSON.stringify(res))\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tdownLoadAndSaveFile_PromiseFc(url) {\r\n\t\treturn new Promise((rs, rj) => {\r\n\t\t\tlog('准备下载并保存图片:' + url);\r\n\t\t\tif (url.substring(0, 4) === 'http') {\r\n\t\t\t\turl = checkMPUrl(url);\r\n\t\t\t\tuni.downloadFile({\r\n\t\t\t\t\turl,\r\n\t\t\t\t\tsuccess(d_res) {\r\n\t\t\t\t\t\tlog('下载背景图成功：' + JSON.stringify(d_res));\r\n\t\t\t\t\t\tif (d_res && d_res.tempFilePath) {\r\n\t\t\t\t\t\t\t\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tuni.saveFile({\r\n\t\t\t\t\t\t\t\ttempFilePath: d_res.tempFilePath,\r\n\t\t\t\t\t\t\t\tsuccess(s_res) {\r\n\t\t\t\t\t\t\t\t\tlog('保存背景图成功:' + JSON.stringify(s_res));\r\n\t\t\t\t\t\t\t\t\tif (s_res && s_res.savedFilePath)\r\n\t\t\t\t\t\t\t\t\t\trs(s_res.savedFilePath);\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trs(d_res.tempFilePath);\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\t\trs(d_res.tempFilePath);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trj('not find tempFilePath');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\trj(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\trs(url);\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tcheckFile_PromiseFc(url) {\r\n\t\treturn new Promise((rs, rj) => {\r\n\t\t\tuni.getSavedFileList({\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tlet d = res.fileList;\r\n\t\t\t\t\tlet index = d.findIndex(item => {\r\n\t\t\t\t\t\treturn item.filePath === url;\r\n\t\t\t\t\t})\r\n\t\t\t\t\trs(index);\r\n\t\t\t\t},\r\n\t\t\t\tfail(err) {\r\n\t\t\t\t\trj(err);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t},\r\n\tremoveSavedFile(path) {\r\n\t\tuni.getSavedFileList({\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tlet d = res.fileList;\r\n\t\t\t\tlet index = d.findIndex(item => {\r\n\t\t\t\t\treturn item.filePath === path;\r\n\t\t\t\t});\r\n\t\t\t\tif (index >= 0)\r\n\t\t\t\t\tuni.removeSavedFile({\r\n\t\t\t\t\t\tfilePath: path\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tfileNameInPath(path) {\r\n\t\tlet s = path.split(\"/\");\r\n\t\treturn s[s.length - 1];\r\n\t},\r\n\tgetImageInfo_PromiseFc(imgPath) {\r\n\t\treturn new Promise((rs, rj) => {\r\n\t\t\tlog('准备获取图片信息:' + imgPath);\r\n\t\t\timgPath = checkMPUrl(imgPath);\r\n\t\t\tuni.getImageInfo({\r\n\t\t\t\tsrc: imgPath,\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tlog('获取图片信息成功:' + JSON.stringify(res));\r\n\t\t\t\t\trs(res);\r\n\t\t\t\t},\r\n\t\t\t\tfail: err => {\r\n\t\t\t\t\tlog('获取图片信息失败:' + JSON.stringify(err));\r\n\t\t\t\t\trj(err)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t},\r\n\tpreviewImage(urls) {\r\n\t\tif (typeof(urls) == 'string')\r\n\t\t\turls = [urls];\r\n\t\tuni.previewImage({\r\n\t\t\turls,\r\n\t\t})\r\n\t},\r\n\tactionSheet(obj, cb) {\r\n\t\tlet sheetArray = [];\r\n\t\tfor (let i = 0; i < obj.array.length; i++) {\r\n\t\t\tswitch (obj.array[i]) {\r\n\t\t\t\tcase 'sinaweibo':\r\n\t\t\t\t\tsheetArray[i] = '新浪微博';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'qq':\r\n\t\t\t\t\tsheetArray[i] = 'QQ';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'weixin':\r\n\t\t\t\t\tsheetArray[i] = '微信';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'WXSceneSession':\r\n\t\t\t\t\tsheetArray[i] = '微信好友';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'WXSenceTimeline':\r\n\t\t\t\t\tsheetArray[i] = '微信朋友圈';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'WXSceneFavorite':\r\n\t\t\t\t\tsheetArray[i] = '微信收藏';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tsheetArray[i] = '图文链接';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tsheetArray[i] = '纯文字';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tsheetArray[i] = '纯图片';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tsheetArray[i] = '音乐';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tsheetArray[i] = '视频';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tsheetArray[i] = '小程序';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.showActionSheet(sheetArray, cb);\r\n\t},\r\n\tshowActionSheet(sheetArray, cb) {\r\n\t\tuni.showActionSheet({\r\n\t\t\titemList: sheetArray,\r\n\t\t\tsuccess: (e) => {\r\n\t\t\t\tif (cb && typeof(cb) == 'function') cb(e.tapIndex);\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tgetProvider(type, cb, sheet) {\r\n\t\tlet _this = this;\r\n\t\tuni.getProvider({\r\n\t\t\tservice: type,\r\n\t\t\tsuccess: function(res) {\r\n\t\t\t\tif (sheet) {\r\n\t\t\t\t\tlet obj = {};\r\n\t\t\t\t\tobj.array = res.provider;\r\n\t\t\t\t\t_this.actionSheet(obj, function(index) {\r\n\t\t\t\t\t\tif (cb && typeof(cb) == \"function\") cb(res.provider[index]);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (type == 'payment') {\r\n\t\t\t\t\t\tlet providers = res.provider;\r\n\t\t\t\t\t\tlet payTypeArray = [];\r\n\t\t\t\t\t\tfor (let i = 0; i < providers.length; i++) {\r\n\t\t\t\t\t\t\tif (providers[i] == 'wxpay') {\r\n\t\t\t\t\t\t\t\tpayTypeArray[i] = {\r\n\t\t\t\t\t\t\t\t\tname: '微信支付',\r\n\t\t\t\t\t\t\t\t\tvalue: providers[i],\r\n\t\t\t\t\t\t\t\t\timg: '/static/image/wei.png'\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t} else if (providers[i] == 'alipay') {\r\n\t\t\t\t\t\t\t\tpayTypeArray[i] = {\r\n\t\t\t\t\t\t\t\t\tname: \"支付宝支付\",\r\n\t\t\t\t\t\t\t\t\tvalue: providers[i],\r\n\t\t\t\t\t\t\t\t\timg: '/static/image/ali.png'\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (cb && typeof(cb) == \"function\") cb(payTypeArray);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (cb && typeof(cb) == \"function\") cb(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t})\r\n\t},\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nfunction checkMPUrl(url) {\r\n\r\n\tif(process.env.NODE_ENV !== 'development'){\r\n\t\tif(\r\n\t\t\turl.substring(0, 4) === 'http' && \r\n\t\t\turl.substring(0, 5) !== 'https' && \r\n\t\t\turl.substring(0, 12) !== 'http://store' && \r\n\t\t\turl.substring(0, 10) !== 'http://tmp' && \r\n\t\t\turl.substring(0, 10) !== 'http://usr'\r\n\t\t) {\r\n\t\t\turl = 'https' + url.substring(4, url.length);\r\n\t\t}\r\n\t}\r\n\r\n\treturn url;\r\n}\r\n\r\nmodule.exports = _app;\r\n","import _app from './app.js';\r\nimport QRCodeAlg from './QRCodeAlg.js';\r\nimport { base64ToPath } from './image-tools.js';\r\nconst ShreUserPosterBackgroundKey = 'ShrePosterBackground_'; // 背景图片缓存名称前缀\r\nconst idKey = 'QSSHAREPOSTER_IDKEY'; //drawArray自动生成的idkey\r\nvar isMp = false;\r\n\r\nisMp = true;\r\n\r\n\r\nvar nbgScale = 1;\r\n// export default \r\nfunction getSharePoster(obj) {\r\n\treturn new Promise(async (resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tconst result1 = await returnPromise(obj);\r\n\t\t\tresolve(result1);\r\n\t\t} catch (e) {\r\n\t\t\t//TODO handle the exception\r\n\t\t\ttry {\r\n\t\t\t\tif(obj.bgScale) {\r\n\t\t\t\t\tobj.bgScale = Number(obj.bgScale) - 0.1\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnbgScale = nbgScale - 0.1\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('------------清除缓存后, 开始第二次尝试------------');\r\n\t\t\t\tconst result2 = await returnPromise(obj);\r\n\t\t\t\tresolve(result2);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t//TODO handle the exception\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n}\r\n\r\nfunction returnPromise(obj) {\r\n\tlet {\r\n\t\ttype,\r\n\t\tformData,\r\n\t\tbackground,\r\n\t\tposterCanvasId,\r\n\t\tbackgroundImage,\r\n\t\treserve,\r\n\t\ttextArray,\r\n\t\tdrawArray,\r\n\t\tqrCodeArray,\r\n\t\timagesArray,\r\n\t\tsetCanvasWH,\r\n\t\tsetCanvasToTempFilePath,\r\n\t\tsetDraw,\r\n\t\tbgScale,\r\n\t\tContext,\r\n\t\t_this,\r\n\t\tdelayTimeScale,\r\n\t\tdrawDelayTime\r\n\t} = obj;\r\n\treturn new Promise(async (rs, rj) => {\r\n\t\ttry {\r\n\t\t\t_app.showLoading('正在准备海报数据');\r\n\t\t\tif (!Context) {\r\n\t\t\t\t_app.log('没有画布对象,创建画布对象');\r\n\t\t\t\tContext = uni.createCanvasContext(posterCanvasId, (_this || null));\r\n\t\t\t}\r\n\t\t\tlet bgObj;\r\n\t\t\tif (background && background.width && background.height) {\r\n\t\t\t\tbgObj = background;\r\n\t\t\t} else {\r\n\t\t\t\tbgObj = await getShreUserPosterBackground({\r\n\t\t\t\t\tbackgroundImage,\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tformData\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tbgScale = bgScale || nbgScale;\r\n\t\t\tbgObj.width = bgObj.width * bgScale;\r\n\t\t\tbgObj.height = bgObj.height * bgScale;\r\n\r\n\t\t\t_app.log('获取背景图信息对象成功:' + JSON.stringify(bgObj));\r\n\t\t\tconst params = {\r\n\t\t\t\tbgObj,\r\n\t\t\t\ttype,\r\n\t\t\t\tbgScale,\r\n\t\t\t\tgetBgObj: function() {\r\n\t\t\t\t\treturn params.bgObj;\r\n\t\t\t\t},\r\n\t\t\t\tsetBgObj: function(newBgObj){\r\n\t\t\t\t\tconst n = {...params.bgObj, ...newBgObj};\r\n\t\t\t\t\tparams.bgObj = n;\r\n\t\t\t\t\tbgObj = n;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tif (imagesArray) {\r\n\t\t\t\tif (typeof(imagesArray) == 'function')\r\n\t\t\t\t\timagesArray = imagesArray(params);\r\n\t\t\t\t_app.showLoading('正在生成需绘制图片的临时路径');\r\n\t\t\t\t_app.log('准备设置图片');\r\n\t\t\t\timagesArray = await setImage(imagesArray);\r\n\t\t\t\t_app.hideLoading();\r\n\t\t\t}\r\n\t\t\tif (textArray) {\r\n\t\t\t\tif (typeof(textArray) == 'function')\r\n\t\t\t\t\ttextArray = textArray(params);\r\n\t\t\t\ttextArray = setText(Context, textArray);\r\n\r\n\t\t\t}\r\n\t\t\tif (qrCodeArray) {\r\n\t\t\t\tif (typeof(qrCodeArray) == 'function')\r\n\t\t\t\t\tqrCodeArray = qrCodeArray(params);\r\n\t\t\t\t_app.showLoading('正在生成需绘制图片的临时路径');\r\n\t\t\t\tfor (let i = 0; i < qrCodeArray.length; i++) {\r\n\t\t\t\t\t_app.log(i);\r\n\t\t\t\t\tif (qrCodeArray[i].image)\r\n\t\t\t\t\t\tqrCodeArray[i].image = await _app.downloadFile_PromiseFc(qrCodeArray[i].image);\r\n\t\t\t\t}\r\n\t\t\t\t_app.hideLoading();\r\n\t\t\t}\r\n\t\t\tif (drawArray) {\r\n\t\t\t\tif (typeof(drawArray) == 'function') {\r\n\t\t\t\t\tdrawArray = drawArray(params);\r\n\t\t\t\t}\r\n\t\t\t\tif (_app.isPromise(drawArray)) {\r\n\t\t\t\t\tdrawArray = await drawArray;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (_app.isArray(drawArray) && drawArray.length > 0) {\r\n\t\t\t\t\tlet hasAllInfoCallback = false;\r\n\t\t\t\t\tfor (let i = 0; i < drawArray.length; i++) {\r\n\t\t\t\t\t\tconst drawArrayItem = drawArray[i];\r\n\t\t\t\t\t\tif (_app.isFn(drawArrayItem.allInfoCallback) && !hasAllInfoCallback) hasAllInfoCallback = true;\r\n\t\t\t\t\t\tdrawArrayItem[idKey] = i;\r\n\t\t\t\t\t\tlet newData;\r\n\t\t\t\t\t\tswitch (drawArrayItem.type) {\r\n\t\t\t\t\t\t\tcase 'image':\r\n\t\t\t\t\t\t\t\tnewData = await setImage(drawArrayItem);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\t\t\tnewData = setText(Context, drawArrayItem);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'qrcode':\r\n\t\t\t\t\t\t\t\tif (drawArrayItem.image)\r\n\t\t\t\t\t\t\t\t\tnewData = {\r\n\t\t\t\t\t\t\t\t\t\timage: await _app.downloadFile_PromiseFc(drawArrayItem.image)\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'custom':\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'fillrect':\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'strokeRect':\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'roundStrokeRect':\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'roundFillRect':\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t_app.log('未识别的类型');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (newData && _app.isObject(newData)) {\r\n\t\t\t\t\t\t\tdrawArray[i] = { ...drawArrayItem,\r\n\t\t\t\t\t\t\t\t...newData\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (hasAllInfoCallback) {\r\n\t\t\t\t\t\t_app.log('----------------hasAllInfoCallback----------------');\r\n\t\t\t\t\t\tconst drawArray_copy = [...drawArray];\r\n\t\t\t\t\t\tdrawArray_copy.sort((a, b) => {\r\n\t\t\t\t\t\t\tconst a_serialNum = !_app.isUndef(a.serialNum) && !_app.isNull(a.serialNum) ? Number(a.serialNum) : Number.NEGATIVE_INFINITY;\r\n\t\t\t\t\t\t\tconst b_serialNum = !_app.isUndef(b.serialNum) && !_app.isNull(b.serialNum) ? Number(b.serialNum) : Number.NEGATIVE_INFINITY;\r\n\t\t\t\t\t\t\treturn a_serialNum - b_serialNum;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t_app.log('开始for循环');\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < drawArray_copy.length; i++) {\r\n\t\t\t\t\t\t\tconst item = { ...drawArray_copy[i]\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif (_app.isFn(item.allInfoCallback)) {\r\n\t\t\t\t\t\t\t\tlet newData = item.allInfoCallback({\r\n\t\t\t\t\t\t\t\t\tdrawArray\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tif (_app.isPromise(newData)) newData = await newData;\r\n\t\t\t\t\t\t\t\tconst item_idKey = item[idKey];\r\n\t\t\t\t\t\t\t\tif (!_app.isUndef(item_idKey)) {\r\n\t\t\t\t\t\t\t\t\tdrawArray[item[idKey]] = { ...item,\r\n\t\t\t\t\t\t\t\t\t\t...newData\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconsole.log('程序错误 找不到idKey!!!\t...这不应该啊');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_app.log('for循环结束');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconsole.log('params:' + JSON.stringify(params))\r\n\t\t\tif (setCanvasWH && typeof(setCanvasWH) == 'function') {\r\n\t\t\t\tawait new Promise((resolve, reject)=>{\r\n\t\t\t\t\tsetCanvasWH(params);\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}, 50)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tconst poster = await drawShareImage({\r\n\t\t\t\tContext,\r\n\t\t\t\ttype,\r\n\t\t\t\tposterCanvasId,\r\n\t\t\t\treserve,\r\n\t\t\t\tdrawArray,\r\n\t\t\t\ttextArray,\r\n\t\t\t\timagesArray,\r\n\t\t\t\tbgObj,\r\n\t\t\t\tqrCodeArray,\r\n\t\t\t\tsetCanvasToTempFilePath,\r\n\t\t\t\tsetDraw,\r\n\t\t\t\tbgScale,\r\n\t\t\t\t_this,\r\n\t\t\t\tdelayTimeScale,\r\n\t\t\t\tdrawDelayTime\r\n\t\t\t});\r\n\t\t\t_app.hideLoading();\r\n\t\t\trs({\r\n\t\t\t\tbgObj,\r\n\t\t\t\tposter,\r\n\t\t\t\ttype\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\t//TODO handle the exception\r\n\t\t\trj(e);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction drawShareImage(obj) { //绘制海报方法\r\n\tlet {\r\n\t\tContext,\r\n\t\ttype,\r\n\t\tposterCanvasId,\r\n\t\treserve,\r\n\t\tbgObj,\r\n\t\tdrawArray,\r\n\t\ttextArray,\r\n\t\tqrCodeArray,\r\n\t\timagesArray,\r\n\t\tsetCanvasToTempFilePath,\r\n\t\tsetDraw,\r\n\t\tbgScale,\r\n\t\t_this,\r\n\t\tdelayTimeScale,\r\n\t\tdrawDelayTime\r\n\t} = obj;\r\n\tconst params = {\r\n\t\tContext,\r\n\t\tbgObj,\r\n\t\ttype,\r\n\t\tbgScale\r\n\t};\r\n\tdelayTimeScale = delayTimeScale !== undefined ? delayTimeScale : 15;\r\n\tdrawDelayTime = drawDelayTime !== undefined ? drawDelayTime : 100;\r\n\treturn new Promise((rs, rj) => {\r\n\t\ttry {\r\n\t\t\t_app.showLoading('正在绘制海报');\r\n\t\t\t_app.log('背景对象:' + JSON.stringify(bgObj));\r\n\t\t\tif (bgObj && bgObj.path) {\r\n\t\t\t\t_app.log('背景有图片路径');\r\n\t\t\t\tContext.drawImage(bgObj.path, 0, 0, bgObj.width, bgObj.height);\r\n\t\t\t} else {\r\n\t\t\t\t_app.log('背景没有图片路径');\r\n\t\t\t\tif (bgObj.backgroundColor) {\r\n\t\t\t\t\t_app.log('背景有背景颜色:' + bgObj.backgroundColor);\r\n\t\t\t\t\tContext.setFillStyle(bgObj.backgroundColor);\r\n\t\t\t\t\tContext.fillRect(0, 0, bgObj.width, bgObj.height);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_app.log('背景没有背景颜色');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_app.showLoading('绘制图片');\r\n\t\t\tif (imagesArray && imagesArray.length > 0)\r\n\t\t\t\tdrawImage(Context, imagesArray);\r\n\r\n\t\t\t_app.showLoading('绘制自定义内容');\r\n\t\t\tif (setDraw && typeof(setDraw) == 'function') setDraw(params);\r\n\r\n\t\t\t_app.showLoading('绘制文本');\r\n\t\t\tif (textArray && textArray.length > 0)\r\n\t\t\t\tdrawText(Context, textArray, bgObj);\r\n\r\n\t\t\t_app.showLoading('绘制二维码');\r\n\t\t\tif (qrCodeArray && qrCodeArray.length > 0) {\r\n\t\t\t\tfor (let i = 0; i < qrCodeArray.length; i++) {\r\n\t\t\t\t\tdrawQrCode(Context, qrCodeArray[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_app.showLoading('绘制可控层级序列');\r\n\t\t\tif (drawArray && drawArray.length > 0) {\r\n\t\t\t\tfor (let i = 0; i < drawArray.length; i++) {\r\n\t\t\t\t\tconst drawArrayItem = drawArray[i];\r\n\t\t\t\t\t_app.log('绘制可控层级序列, drawArrayItem:' + JSON.stringify(drawArrayItem));\r\n\t\t\t\t\tswitch (drawArrayItem.type) {\r\n\t\t\t\t\t\tcase 'image':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制图片');\r\n\t\t\t\t\t\t\tdrawImage(Context, drawArrayItem);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制文本');\r\n\t\t\t\t\t\t\tdrawText(Context, drawArrayItem, bgObj);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'qrcode':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制二维码');\r\n\t\t\t\t\t\t\tdrawQrCode(Context, drawArrayItem);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'custom':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制自定义内容');\r\n\t\t\t\t\t\t\tif (drawArrayItem.setDraw && typeof drawArrayItem.setDraw === 'function')\r\n\t\t\t\t\t\t\t\tdrawArrayItem.setDraw(Context);\r\n\t\t\t\t\t\t\tbreak;drawRoundStrokeRect, drawStrokeRect\r\n\t\t\t\t\t\tcase 'fillRect':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制填充直角矩形');\r\n\t\t\t\t\t\t\tdrawFillRect(Context, drawArrayItem);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'strokeRect':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制线条直角矩形');\r\n\t\t\t\t\t\t\tdrawStrokeRect(Context, drawArrayItem);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'roundStrokeRect':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制线条圆角矩形');\r\n\t\t\t\t\t\t\tdrawRoundStrokeRect(Context, drawArrayItem);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'roundFillRect':\r\n\t\t\t\t\t\t\t_app.log('绘制可控层级序列, 绘制填充圆角矩形');\r\n\t\t\t\t\t\t\tdrawRoundFillRect(Context, drawArrayItem);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t_app.log('未识别的类型');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t_app.showLoading('绘制中')\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_app.log('准备执行draw方法')\r\n\t\t\t\t_app.log('Context:' + Context);\r\n\t\t\t\tconst fn = function(){\r\n\t\t\t\t\t_app.showLoading('正在输出图片');\r\n\t\t\t\t\tlet setObj = setCanvasToTempFilePath || {};\r\n\t\t\t\t\tif (setObj && typeof(setObj) == 'function')\r\n\t\t\t\t\t\tsetObj = setCanvasToTempFilePath(bgObj, type);\r\n\t\t\t\t\tlet canvasToTempFilePathFn;\r\n\t\t\t\t\tconst data = {\r\n\t\t\t\t\t\tx: 0,\r\n\t\t\t\t\t\ty: 0,\r\n\t\t\t\t\t\twidth: Number(bgObj.width),\r\n\t\t\t\t\t\theight: Number(bgObj.height),\r\n\t\t\t\t\t\tdestWidth: Number(bgObj.width), // 若H5使用这里请不要乘以二\r\n\t\t\t\t\t\tdestHeight: Number(bgObj.height), // 若H5使用这里请不要乘以二\r\n\t\t\t\t\t\tquality: .8,\r\n\t\t\t\t\t\tfileType: 'jpg',\r\n\t\t\t\t\t\t...setObj\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconsole.log('canvasToTempFilePath的data对象:' + JSON.stringify(data));\r\n\t\t\t\t\tcanvasToTempFilePathFn = function() {\r\n\t\t\t\t\t\tconst toTempFilePathObj = { //输出为图片\r\n\t\t\t\t\t\t\t...data,\r\n\t\t\t\t\t\t\tcanvasId: posterCanvasId,\r\n\t\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t\t_app.hideLoading();\r\n\t\t\t\t\t\t\t\trs(res);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\t_app.hideLoading();\r\n\t\t\t\t\t\t\t\tconsole.log('输出图片失败');\r\n\t\t\t\t\t\t\t\t_app.log('输出图片失败:' + JSON.stringify(err));\r\n\t\t\t\t\t\t\t\trj('输出图片失败:' + JSON.stringify(err))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.canvasToTempFilePath(toTempFilePathObj, _this || null);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet delayTime = 0;\r\n\t\t\t\t\tif (qrCodeArray) {\r\n\t\t\t\t\t\tqrCodeArray.forEach(item => {\r\n\t\t\t\t\t\t\tif (item.text) {\r\n\t\t\t\t\t\t\t\tdelayTime += Number(item.text.length);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (imagesArray) {\r\n\t\t\t\t\t\timagesArray.forEach(() => {\r\n\t\t\t\t\t\t\tdelayTime += delayTimeScale;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (textArray) {\r\n\t\t\t\t\t\ttextArray.forEach(() => {\r\n\t\t\t\t\t\t\tdelayTime += delayTimeScale;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (drawArray) {\r\n\t\t\t\t\t\tdrawArray.forEach(item => {\r\n\t\t\t\t\t\t\tswitch (item.type) {\r\n\t\t\t\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\t\t\t\tif (item.text) {\r\n\t\t\t\t\t\t\t\t\t\tdelayTime += item.text.length;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tdelayTime += delayTimeScale;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_app.log('延时系数:' + delayTimeScale);\r\n\t\t\t\t\t_app.log('总计延时:' + delayTime);\r\n\t\t\t\t\tsetTimeout(canvasToTempFilePathFn, delayTime);\r\n\t\t\t\t}\r\n\t\t\t\tContext.draw((typeof(reserve) == 'boolean' ? reserve : false), fn);\r\n\t\t\t}, drawDelayTime);\r\n\t\t} catch (e) {\r\n\t\t\t//TODO handle the exception\r\n\t\t\t_app.hideLoading();\r\n\t\t\trj(e);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// export\r\nfunction drawFillRect(Context, drawArrayItem = {}) {\t//填充矩形\r\n\t_app.log('进入绘制填充直角矩形方法, drawArrayItem:' + JSON.stringify(drawArrayItem));\r\n\tContext.setFillStyle(drawArrayItem.backgroundColor || 'black');\r\n\tContext.setGlobalAlpha(drawArrayItem.alpha || 1);\r\n\tContext.fillRect(drawArrayItem.dx || 0, drawArrayItem.dy || 0, drawArrayItem.width || 0, drawArrayItem.height || 0);\r\n\tContext.setGlobalAlpha(1);\r\n}\r\n\r\n// export\r\nfunction drawStrokeRect(Context, drawArrayItem = {}) {\t//线条矩形\r\n\tContext.setStrokeStyle(drawArrayItem.color||'black');\r\n\tContext.setLineWidth(drawArrayItem.lineWidth || 1);\r\n\tContext.strokeRect(drawArrayItem.dx, drawArrayItem.dy, drawArrayItem.width, drawArrayItem.height);\r\n}\r\n\r\n// export\r\nfunction drawRoundStrokeRect(Context, drawArrayItem = {}) {\r\n\tlet { dx, dy, width, height, r, lineWidth, color } = drawArrayItem;\r\n\tr = r || width * .1;\r\n\r\n\tif (width < 2 * r) {\r\n\t\tr = width / 2;\r\n\t}\r\n\tif (width < 2 * r) {\r\n\t\tr = width / 2;\r\n\t}\r\n\tContext.beginPath();\r\n\tContext.moveTo(dx + r, dy);\r\n\tContext.arcTo(dx + width, dy, dx + width, dy + height, r);\r\n\tContext.arcTo(dx + width, dy + height, dx, dy + height, r);\r\n\tContext.arcTo(dx, dy + height, dx, dy, r);\r\n\tContext.arcTo(dx, dy, dx + width, dy, r);\r\n\tContext.closePath();\r\n\tContext.setLineWidth(lineWidth || 1);\r\n\tContext.setStrokeStyle(color || 'black');\r\n\tContext.stroke();\r\n}\r\n\r\n// export\r\nfunction drawRoundFillRect(Context, drawArrayItem = {}) {\r\n\tlet { dx, dy, width, height, r, backgroundColor } = drawArrayItem;\r\n\tr = r || width * .1;\r\n\r\n\tif (width < 2 * r) {\r\n\t\tr = width / 2;\r\n\t}\r\n\tif (width < 2 * r) {\r\n\t\tr = width / 2;\r\n\t}\r\n\tContext.beginPath();\r\n\tContext.moveTo(dx + r, dy);\r\n\tContext.arcTo(dx + width, dy, dx + width, dy + height, r);\r\n\tContext.arcTo(dx + width, dy + height, dx, dy + height, r);\r\n\tContext.arcTo(dx, dy + height, dx, dy, r);\r\n\tContext.arcTo(dx, dy, dx + width, dy, r);\r\n\tContext.closePath();\r\n\tContext.setFillStyle(backgroundColor);\r\n\tContext.fill();\r\n}\r\n\r\n// export \r\nfunction setText(Context, texts) { // 设置文本数据\r\n\t_app.log('进入设置文字方法, texts:' + JSON.stringify(texts));\r\n\tif (texts && _app.isArray(texts)) {\r\n\t\t_app.log('texts是数组');\r\n\t\tif (texts.length > 0) {\r\n\t\t\tfor (let i = 0; i < texts.length; i++) {\r\n\t\t\t\t_app.log('字符串信息-初始化之前:' + JSON.stringify(texts[i]));\r\n\t\t\t\ttexts[i] = setTextFn(Context, texts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t_app.log('texts是对象');\r\n\t\ttexts = setTextFn(Context, texts);\r\n\t}\r\n\t_app.log('返回texts:' + JSON.stringify(texts));\r\n\treturn texts;\r\n}\r\n\r\nfunction setTextFn(Context, textItem) {\r\n\t_app.log('进入设置文字方法, textItem:' + JSON.stringify(textItem));\r\n\tif (_app.isNotNull_string(textItem.text)) {\r\n\t\ttextItem.text = String(textItem.text);\r\n\t\ttextItem.alpha = textItem.alpha !== undefined ? Number(textItem.alpha) : 1;\r\n\t\ttextItem.color = textItem.color || 'black';\r\n\t\ttextItem.size = textItem.size !== undefined ? Number(textItem.size) : 10;\r\n\t\ttextItem.textAlign = textItem.textAlign || 'left';\r\n\t\ttextItem.textBaseline = textItem.textBaseline || 'middle';\r\n\t\ttextItem.dx = Number(textItem.dx) || 0;\r\n\t\ttextItem.dy = Number(textItem.dy) || 0;\r\n\t\ttextItem.size = Math.ceil(Number(textItem.size));\r\n\t\t_app.log('字符串信息-初始化默认值后:' + JSON.stringify(textItem));\r\n\t\tconst textLength = countTextLength(Context, {\r\n\t\t\ttext: textItem.text,\r\n\t\t\tsize: textItem.size\r\n\t\t});\r\n\t\t_app.log('字符串信息-初始化时的文本长度:' + textLength);\r\n\t\tlet infoCallBackObj = {};\r\n\t\tif (textItem.infoCallBack && typeof(textItem.infoCallBack) === 'function') {\r\n\t\t\tinfoCallBackObj = textItem.infoCallBack(textLength);\r\n\t\t}\r\n\t\ttextItem = {\r\n\t\t\t...textItem,\r\n\t\t\ttextLength,\r\n\t\t\t...infoCallBackObj\r\n\t\t}\r\n\t\t_app.log('字符串信息-infoCallBack后:' + JSON.stringify(textItem));\r\n\t}\r\n\treturn textItem;\r\n}\r\n\r\nfunction countTextLength(Context, obj) {\r\n\t_app.log('计算文字长度, obj:' + JSON.stringify(obj));\r\n\tconst {\r\n\t\ttext,\r\n\t\tsize\r\n\t} = obj;\r\n\tContext.setFontSize(size);\r\n\tlet textLength;\r\n\ttry{\r\n\t\ttextLength = Context.measureText(text); // 官方文档说 App端自定义组件编译模式暂时不可用measureText方法\r\n\t}catch(e){\r\n\t\t//TODO handle the exception\r\n\t\ttextLength = {};\r\n\t}\r\n\ttextLength = {};\r\n\t_app.log('measureText计算文字长度, textLength:' + JSON.stringify(textLength));\r\n\ttextLength = textLength && textLength.width ? textLength.width : 0;\r\n\tif (!textLength) {\r\n\t\tlet l = 0;\r\n\t\tfor (let j = 0; j < text.length; j++) {\r\n\t\t\tlet t = text.substr(j, 1);\r\n\t\t\tconst countL = countStrLength(t);\r\n\t\t\t_app.log('计算文字宽度系数:' + countL);\r\n\t\t\tl += countL;\r\n\t\t}\r\n\t\t_app.log('文字宽度总系数:' + l);\r\n\t\ttextLength = l * size;\r\n\t}\r\n\treturn textLength;\r\n}\r\n\r\n//计算字符长度系数\r\nfunction countStrLength(t) {\r\n\tlet l;\r\n\tif (/a/.test(t)) {\r\n\t\tl = 0.552734375\r\n\t} else if (/b/.test(t)) {\r\n\t\tl = 0.638671875\r\n\t} else if (/c/.test(t)) {\r\n\t\tl = 0.50146484375\r\n\t} else if (/d/.test(t)) {\r\n\t\tl = 0.6396484375\r\n\t} else if (/e/.test(t)) {\r\n\t\tl = 0.5673828125\r\n\t} else if (/f/.test(t)) {\r\n\t\tl = 0.3466796875\r\n\t} else if (/g/.test(t)) {\r\n\t\tl = 0.6396484375\r\n\t} else if (/h/.test(t)) {\r\n\t\tl = 0.61572265625\r\n\t} else if (/i/.test(t)) {\r\n\t\tl = 0.26611328125\r\n\t} else if (/j/.test(t)) {\r\n\t\tl = 0.26708984375\r\n\t} else if (/k/.test(t)) {\r\n\t\tl = 0.54443359375\r\n\t} else if (/l/.test(t)) {\r\n\t\tl = 0.26611328125\r\n\t} else if (/m/.test(t)) {\r\n\t\tl = 0.93701171875\r\n\t} else if (/n/.test(t)) {\r\n\t\tl = 0.6162109375\r\n\t} else if (/o/.test(t)) {\r\n\t\tl = 0.6357421875\r\n\t} else if (/p/.test(t)) {\r\n\t\tl = 0.638671875\r\n\t} else if (/q/.test(t)) {\r\n\t\tl = 0.6396484375\r\n\t} else if (/r/.test(t)) {\r\n\t\tl = 0.3818359375\r\n\t} else if (/s/.test(t)) {\r\n\t\tl = 0.462890625\r\n\t} else if (/t/.test(t)) {\r\n\t\tl = 0.37255859375\r\n\t} else if (/u/.test(t)) {\r\n\t\tl = 0.6162109375\r\n\t} else if (/v/.test(t)) {\r\n\t\tl = 0.52490234375\r\n\t} else if (/w/.test(t)) {\r\n\t\tl = 0.78955078125\r\n\t} else if (/x/.test(t)) {\r\n\t\tl = 0.5068359375\r\n\t} else if (/y/.test(t)) {\r\n\t\tl = 0.529296875\r\n\t} else if (/z/.test(t)) {\r\n\t\tl = 0.49169921875\r\n\t} else if (/A/.test(t)) {\r\n\t\tl = 0.70361328125\r\n\t} else if (/B/.test(t)) {\r\n\t\tl = 0.62744140625\r\n\t} else if (/C/.test(t)) {\r\n\t\tl = 0.6689453125\r\n\t} else if (/D/.test(t)) {\r\n\t\tl = 0.76171875\r\n\t} else if (/E/.test(t)) {\r\n\t\tl = 0.5498046875\r\n\t} else if (/F/.test(t)) {\r\n\t\tl = 0.53125\r\n\t} else if (/G/.test(t)) {\r\n\t\tl = 0.74365234375\r\n\t} else if (/H/.test(t)) {\r\n\t\tl = 0.7734375\r\n\t} else if (/I/.test(t)) {\r\n\t\tl = 0.2939453125\r\n\t} else if (/J/.test(t)) {\r\n\t\tl = 0.39599609375\r\n\t} else if (/K/.test(t)) {\r\n\t\tl = 0.634765625\r\n\t} else if (/L/.test(t)) {\r\n\t\tl = 0.51318359375\r\n\t} else if (/M/.test(t)) {\r\n\t\tl = 0.97705078125\r\n\t} else if (/N/.test(t)) {\r\n\t\tl = 0.81298828125\r\n\t} else if (/O/.test(t)) {\r\n\t\tl = 0.81494140625\r\n\t} else if (/P/.test(t)) {\r\n\t\tl = 0.61181640625\r\n\t} else if (/Q/.test(t)) {\r\n\t\tl = 0.81494140625\r\n\t} else if (/R/.test(t)) {\r\n\t\tl = 0.65283203125\r\n\t} else if (/S/.test(t)) {\r\n\t\tl = 0.5771484375\r\n\t} else if (/T/.test(t)) {\r\n\t\tl = 0.5732421875\r\n\t} else if (/U/.test(t)) {\r\n\t\tl = 0.74658203125\r\n\t} else if (/V/.test(t)) {\r\n\t\tl = 0.67626953125\r\n\t} else if (/W/.test(t)) {\r\n\t\tl = 1.017578125\r\n\t} else if (/X/.test(t)) {\r\n\t\tl = 0.64501953125\r\n\t} else if (/Y/.test(t)) {\r\n\t\tl = 0.603515625\r\n\t} else if (/Z/.test(t)) {\r\n\t\tl = 0.6201171875\r\n\t} else if (/[0-9]/.test(t)) {\r\n\t\tl = 0.58642578125\r\n\t} else if (/[\\u4e00-\\u9fa5]/.test(t)) {\r\n\t\tl = 1\r\n\t} else if (/ /.test(t)) {\r\n\t\tl = 0.2958984375\r\n\t} else if (/\\`/.test(t)) {\r\n\t\tl = 0.294921875\r\n\t} else if (/\\~/.test(t)) {\r\n\t\tl = 0.74169921875\r\n\t} else if (/\\!/.test(t)) {\r\n\t\tl = 0.3125\r\n\t} else if (/\\@/.test(t)) {\r\n\t\tl = 1.03125\r\n\t} else if (/\\#/.test(t)) {\r\n\t\tl = 0.63818359375\r\n\t} else if (/\\$/.test(t)) {\r\n\t\tl = 0.58642578125\r\n\t} else if (/\\%/.test(t)) {\r\n\t\tl = 0.8896484375\r\n\t} else if (/\\^/.test(t)) {\r\n\t\tl = 0.74169921875\r\n\t} else if (/\\&/.test(t)) {\r\n\t\tl = 0.8701171875\r\n\t} else if (/\\*/.test(t)) {\r\n\t\tl = 0.455078125\r\n\t} else if (/\\(/.test(t)) {\r\n\t\tl = 0.333984375\r\n\t} else if (/\\)/.test(t)) {\r\n\t\tl = 0.333984375\r\n\t} else if (/\\_/.test(t)) {\r\n\t\tl = 0.4482421875\r\n\t} else if (/\\-/.test(t)) {\r\n\t\tl = 0.4326171875\r\n\t} else if (/\\+/.test(t)) {\r\n\t\tl = 0.74169921875\r\n\t} else if (/\\=/.test(t)) {\r\n\t\tl = 0.74169921875\r\n\t} else if (/\\|/.test(t)) {\r\n\t\tl = 0.26904296875\r\n\t} else if (/\\\\/.test(t)) {\r\n\t\tl = 0.416015625\r\n\t} else if (/\\[/.test(t)) {\r\n\t\tl = 0.333984375\r\n\t} else if (/\\]/.test(t)) {\r\n\t\tl = 0.333984375\r\n\t} else if (/\\;/.test(t)) {\r\n\t\tl = 0.24072265625\r\n\t} else if (/\\'/.test(t)) {\r\n\t\tl = 0.25634765625\r\n\t} else if (/\\,/.test(t)) {\r\n\t\tl = 0.24072265625\r\n\t} else if (/\\./.test(t)) {\r\n\t\tl = 0.24072265625\r\n\t} else if (/\\//.test(t)) {\r\n\t\tl = 0.42724609375\r\n\t} else if (/\\{/.test(t)) {\r\n\t\tl = 0.333984375\r\n\t} else if (/\\}/.test(t)) {\r\n\t\tl = 0.333984375\r\n\t} else if (/\\:/.test(t)) {\r\n\t\tl = 0.24072265625\r\n\t} else if (/\\\"/.test(t)) {\r\n\t\tl = 0.435546875\r\n\t} else if (/\\</.test(t)) {\r\n\t\tl = 0.74169921875\r\n\t} else if (/\\>/.test(t)) {\r\n\t\tl = 0.74169921875\r\n\t} else if (/\\?/.test(t)) {\r\n\t\tl = 0.48291015625\r\n\t} else {\r\n\t\tl = 1\r\n\t}\r\n\treturn l;\r\n}\r\n\r\n// export \r\nfunction setImage(images) { // 设置图片数据\r\n\t_app.log('进入设置图片数据方法');\r\n\treturn new Promise(async (resolve, rejcet) => {\r\n\t\ttry {\r\n\t\t\tif (images && _app.isArray(images)) {\r\n\t\t\t\t_app.log('images是一个数组');\r\n\t\t\t\tfor (let i = 0; i < images.length; i++) {\r\n\t\t\t\t\t_app.log('设置图片数据循环中:' + i);\r\n\t\t\t\t\timages[i] = await setImageFn(images[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t_app.log('images是一个对象');\r\n\t\t\t\timages = await setImageFn(images);\r\n\t\t\t}\r\n\t\t\tresolve(images);\r\n\t\t} catch (e) {\r\n\t\t\t//TODO handle the exception\r\n\t\t\trejcet(e);\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction base64ToPathFn(path) {\r\n\tvar reg = /^\\s*data:([a-z]+\\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\\-._~:@\\/?%\\s]*?)\\s*$/i;\r\n\tif(!reg.test(path)){\r\n\t  return Promise.resolve(path);\r\n\t}\r\n\treturn base64ToPath(path);\r\n}\r\n\r\nfunction setImageFn(image) {\r\n\treturn new Promise(async (resolve, reject) => {\r\n\t\tif (image.url) {\r\n\t\t\timage.url = (await base64ToPathFn(image.url));\r\n\t\t\tlet imgUrl = image.url;\r\n\t\t\timgUrl = await _app.downloadFile_PromiseFc(imgUrl);\r\n\t\t\timage.url = imgUrl;\r\n\t\t\tconst hasinfoCallBack = image.infoCallBack && typeof(image.infoCallBack) === 'function';\r\n\t\t\tlet imageInfo = {};\r\n\t\t\timageInfo = await _app.getImageInfo_PromiseFc(imgUrl);\r\n\t\t\tif (hasinfoCallBack) {\r\n\t\t\t\timage = {\r\n\t\t\t\t\t...image,\r\n\t\t\t\t\t...image.infoCallBack(imageInfo)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\timage.dx = Number(image.dx) || 0;\r\n\t\t\timage.dy = Number(image.dy) || 0;\r\n\t\t\timage.dWidth = Number(image.dWidth || imageInfo.width);\r\n\t\t\timage.dHeight = Number(image.dHeight || imageInfo.height);\r\n\t\t\timage = {\r\n\t\t\t\t...image,\r\n\t\t\t\timageInfo\r\n\t\t\t}\r\n\t\t}\r\n\t\tresolve(image);\r\n\t})\r\n}\r\n\r\n// export \r\nfunction drawText(Context, textArray, bgObj) { // 先遍历换行再绘制\r\n\tif (!_app.isArray(textArray)) {\r\n\t\t_app.log('遍历文本方法, 不是数组');\r\n\t\ttextArray = [textArray];\r\n\t} else {\r\n\t\t_app.log('遍历文本方法, 是数组');\r\n\t}\r\n\t_app.log('遍历文本方法, textArray:' + JSON.stringify(textArray));\r\n\tconst newArr = [];\r\n\tif (textArray && textArray.length > 0) {\r\n\t\tfor (let j = 0; j < textArray.length; j++) {\r\n\t\t\tconst textItem = textArray[j];\r\n\t\t\tif (textItem.text && textItem.lineFeed) {\r\n\t\t\t\tlet lineNum = -1,\r\n\t\t\t\t\tmaxWidth = bgObj.width,\r\n\t\t\t\t\tlineHeight = textItem.size,\r\n\t\t\t\t\tdx = textItem.dx;\r\n\t\t\t\tif (_app.isObject(textItem.lineFeed)) {\r\n\t\t\t\t\tconst lineFeed = textItem.lineFeed;\r\n\t\t\t\t\tlineNum = (lineFeed.lineNum !== undefined && typeof(lineFeed.lineNum) === 'number') && lineFeed.lineNum >= 0 ?\r\n\t\t\t\t\t\tlineFeed.lineNum : lineNum;\r\n\t\t\t\t\tmaxWidth = (lineFeed.maxWidth !== undefined && typeof(lineFeed.maxWidth) === 'number') ? lineFeed.maxWidth :\r\n\t\t\t\t\t\tmaxWidth;\r\n\t\t\t\t\tlineHeight = (lineFeed.lineHeight !== undefined && typeof(lineFeed.lineHeight) === 'number') ? lineFeed.lineHeight :\r\n\t\t\t\t\t\tlineHeight;\r\n\t\t\t\t\tdx = (lineFeed.dx !== undefined && typeof(lineFeed.dx) === 'number') ? lineFeed.dx : dx;\r\n\t\t\t\t}\r\n\t\t\t\tconst chr = (textItem.text).split(\"\");\r\n\t\t\t\tlet temp = \"\";\r\n\t\t\t\tconst row = [];\r\n\t\t\t\t//循环出几行文字组成数组\r\n\t\t\t\tfor (let a = 0, len = chr.length; a < len; a++) {\r\n\t\t\t\t\tif (countTextLength(Context, {\r\n\t\t\t\t\t\t\ttext: temp,\r\n\t\t\t\t\t\t\tsize: textItem.size\r\n\t\t\t\t\t\t}) <= maxWidth && countTextLength(Context, {\r\n\t\t\t\t\t\t\ttext: (temp + chr[a]),\r\n\t\t\t\t\t\t\tsize: textItem.size\r\n\t\t\t\t\t\t}) <= maxWidth) {\r\n\t\t\t\t\t\ttemp += chr[a];\r\n\t\t\t\t\t\tif (a == (chr.length - 1)) {\r\n\t\t\t\t\t\t\trow.push(temp);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(temp);\r\n\t\t\t\t\t\ttemp = chr[a];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_app.log('循环出的文本数组:' + JSON.stringify(row));\r\n\t\t\t\t//只显示几行 变量间距lineHeight  变量行数lineNum\r\n\t\t\t\tlet allNum = (lineNum >= 0 && lineNum < row.length) ? lineNum : row.length;\r\n\r\n\t\t\t\tfor (let i = 0; i < allNum; i++) {\r\n\t\t\t\t\tlet str = row[i];\r\n\t\t\t\t\tif (i == (allNum - 1) && allNum < row.length) {\r\n\t\t\t\t\t\tstr = str.substring(0, str.length - 1) + '...';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst obj = { ...textItem,\r\n\t\t\t\t\t\ttext: str,\r\n\t\t\t\t\t\tdx: i === 0 ? textItem.dx : (dx >= 0 ? dx : textItem.dx),\r\n\t\t\t\t\t\tdy: textItem.dy + (i * lineHeight),\r\n\t\t\t\t\t\ttextLength: countTextLength(Context, {\r\n\t\t\t\t\t\t\ttext: str,\r\n\t\t\t\t\t\t\tsize: textItem.size\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t};\r\n\t\t\t\t\t_app.log('重新组成的文本对象:' + JSON.stringify(obj));\r\n\t\t\t\t\tnewArr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnewArr.push(textItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t_app.log('绘制文本新数组:' + JSON.stringify(newArr));\r\n\tdrawTexts(Context, newArr);\r\n}\r\n\r\nfunction setFont(textItem = {}) {\r\n\tif (textItem.font && typeof(textItem.font) === 'string') {\r\n\t\t_app.log(textItem.font)\r\n\t\treturn textItem.font;\r\n\t} else {\r\n\t\tlet fontStyle = 'normal';\r\n\t\tlet fontVariant = 'normal';\r\n\t\tlet fontWeight = 'normal';\r\n\t\tlet fontSize = textItem.size || 10;\r\n\t\tlet fontFamily = 'sans-serif';\r\n\t\tfontSize = Math.ceil(Number(fontSize));\r\n\t\tif (textItem.fontStyle && typeof(textItem.fontStyle) === 'string')\r\n\t\t\tfontStyle = textItem.fontStyle.trim();\r\n\t\tif (textItem.fontVariant && typeof(textItem.fontVariant) === 'string')\r\n\t\t\tfontVariant = textItem.fontVariant.trim();\r\n\t\tif (textItem.fontWeight && (typeof(textItem.fontWeight) === 'string' || typeof(textItem.fontWeight) === 'number'))\r\n\t\t\tfontWeight = textItem.fontWeight.trim();\r\n\t\tif (textItem.fontFamily && typeof(textItem.fontFamily) === 'string')\r\n\t\t\tfontFamily = textItem.fontFamily.trim();\r\n\t\treturn fontStyle + ' ' +\r\n\t\t\tfontVariant + ' ' +\r\n\t\t\tfontWeight + ' ' +\r\n\t\t\tfontSize + 'px' + ' ' +\r\n\t\t\tfontFamily;\r\n\t}\r\n}\r\n\r\nfunction drawTexts(Context, texts) { // 绘制文本\r\n\t_app.log('准备绘制文本方法, texts:' + JSON.stringify(texts));\r\n\tif (texts && _app.isArray(texts)) {\r\n\t\t_app.log('准备绘制文本方法, 是数组');\r\n\t\tif (texts.length > 0) {\r\n\t\t\tfor (let i = 0; i < texts.length; i++) {\r\n\t\t\t\tdrawTextFn(Context, texts[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t_app.log('准备绘制文本方法, 不是数组');\r\n\t\tdrawTextFn(Context, texts);\r\n\t}\r\n}\r\n\r\nfunction drawTextFn(Context, textItem) {\r\n\t_app.log('进入绘制文本方法, textItem:' + JSON.stringify(textItem));\r\n\tif (textItem && _app.isObject(textItem) && textItem.text) {\r\n\t\tContext.font = setFont(textItem);\r\n\t\tContext.setFillStyle(textItem.color);\r\n\t\tContext.setGlobalAlpha(textItem.alpha);\r\n\t\tContext.setTextAlign(textItem.textAlign);\r\n\t\tContext.setTextBaseline(textItem.textBaseline);\r\n\t\tContext.fillText(textItem.text, textItem.dx, textItem.dy);\r\n\t\tif (textItem.lineThrough && _app.isObject(textItem.lineThrough)) {\r\n\t\t\t_app.log('有删除线');\r\n\t\t\tlet lineThrough = textItem.lineThrough;\r\n\t\t\tlineThrough.alpha = lineThrough.alpha !== undefined ? lineThrough.alpha : textItem.alpha;\r\n\t\t\tlineThrough.style = lineThrough.style || textItem.color;\r\n\t\t\tlineThrough.width = lineThrough.width !== undefined ? lineThrough.width : textItem.size / 10;\r\n\t\t\tlineThrough.cap = lineThrough.cap !== undefined ? lineThrough.cap : 'butt';\r\n\t\t\t_app.log('删除线对象:' + JSON.stringify(lineThrough));\r\n\t\t\tContext.setGlobalAlpha(lineThrough.alpha);\r\n\t\t\tContext.setStrokeStyle(lineThrough.style);\r\n\t\t\tContext.setLineWidth(lineThrough.width);\r\n\t\t\tContext.setLineCap(lineThrough.cap);\r\n\t\t\tlet mx, my;\r\n\t\t\tswitch (textItem.textAlign) {\r\n\t\t\t\tcase 'left':\r\n\t\t\t\t\tmx = textItem.dx;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'center':\r\n\t\t\t\t\tmx = textItem.dx - (textItem.textLength) / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tmx = textItem.dx - (textItem.textLength);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tswitch (textItem.textBaseline) {\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\tmy = textItem.dy + (textItem.size * .5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'middle':\r\n\t\t\t\t\tmy = textItem.dy;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tmy = textItem.dy - (textItem.size * .5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tContext.beginPath();\r\n\t\t\tContext.moveTo(mx, my);\r\n\t\t\tContext.lineTo(mx + textItem.textLength, my);\r\n\t\t\tContext.stroke();\r\n\t\t\tContext.closePath();\r\n\t\t\t_app.log('删除线完毕');\r\n\t\t}\r\n\t\tContext.setGlobalAlpha(1);\r\n\t\tContext.font = '10px sans-serif';\r\n\t}\r\n}\r\n// export \r\nfunction drawImage(Context, images) { // 绘制图片\r\n\t_app.log('判断图片数据类型:' + JSON.stringify(images))\r\n\tif (images && _app.isArray(images)) {\r\n\t\tif (images.length > 0) {\r\n\t\t\tfor (let i = 0; i < images.length; i++) {\r\n\t\t\t\treadyDrawImageFn(Context, images[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treadyDrawImageFn(Context, images);\r\n\t}\r\n\r\n}\r\n\r\nfunction readyDrawImageFn(Context, img) {\r\n\t_app.log('判断绘制图片形状, img:' + JSON.stringify(img));\r\n\tif (img.url) {\r\n\t\tif (img.circleSet) {\r\n\t\t\tdrawCircleImage(Context, img);\r\n\t\t} else if (img.roundRectSet) {\r\n\t\t\tdrawRoundRectImage(Context, img);\r\n\t\t} else {\r\n\t\t\tdrawImageFn(Context, img);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction drawImageFn(Context, img) {\r\n\t_app.log('进入绘制默认图片方法, img:' + JSON.stringify(img));\r\n\tif (img.url) {\r\n\t\tconst hasAlpha = !_app.isUndef(img.alpha);\r\n\t\timg.alpha = Number(!_app.isUndef(img.alpha) ? img.alpha : 1);\r\n\t\tContext.setGlobalAlpha(img.alpha);\r\n\t\t_app.log('绘制默认图片方法, 有url');\r\n\t\tif (img.dWidth && img.dHeight && img.sx && img.sy && img.sWidth && img.sHeight) {\r\n\t\t\t_app.log('绘制默认图片方法, 绘制第一种方案');\r\n\t\t\tContext.drawImage(img.url, \r\n\t\t\tNumber(img.sx) || false, Number(img.sy) || false, \r\n\t\t\tNumber(img.sWidth) || false, Number(img.sHeight) || false,\r\n\t\t\tNumber(img.dx || 0), Number(img.dy || 0),\r\n\t\t\tNumber(img.dWidth) || false, Number(img.dHeight) || false,);\r\n\t\t} else if (img.dWidth && img.dHeight) {\r\n\t\t\t_app.log('绘制默认图片方法, 绘制第二种方案');\r\n\t\t\tContext.drawImage(img.url, Number(img.dx || 0), Number(img.dy || 0),\r\n\t\t\t\tNumber(img.dWidth) || false, Number(img.dHeight) || false);\r\n\t\t} else {\r\n\t\t\t_app.log('绘制默认图片方法, 绘制第三种方案');\r\n\t\t\tContext.drawImage(img.url, Number(img.dx || 0), Number(img.dy || 0));\r\n\t\t}\r\n\t\tif (hasAlpha) {\r\n\t\t\tContext.setGlobalAlpha(1);\r\n\t\t}\r\n\t}\r\n\t_app.log('绘制默认图片方法, 绘制完毕');\r\n}\r\n\r\nfunction drawCircleImage(Context, obj) {\r\n\t_app.log('进入绘制圆形图片方法, obj:' + JSON.stringify(obj));\r\n\tlet {\r\n\t\tdx,\r\n\t\tdy,\r\n\t\tdWidth,\r\n\t\tdHeight,\r\n\t\tcircleSet,\r\n\t\timageInfo\r\n\t} = obj;\r\n\tlet x, y, r;\r\n\tif (typeof circleSet === 'object') {\r\n\t\tx = circleSet.x;\r\n\t\ty = circleSet.y;\r\n\t\tr = circleSet.r;\r\n\t}\r\n\tif (!r) {\r\n\t\tlet d;\r\n\t\td = dWidth > dHeight ? dHeight : dWidth;\r\n\t\tr = d / 2;\r\n\t}\r\n\r\n\tx = x ? dx + x : (dx || 0) + r;\r\n\ty = y ? dy + y : (dy || 0) + r;\r\n\tContext.save();\r\n\tContext.beginPath();\r\n\tContext.arc(x, y, r, 0, 2 * Math.PI, false);\r\n\tContext.closePath();\r\n\tContext.setGlobalAlpha(0);\r\n\tContext.fillStyle = '#FFFFFF';\r\n\tContext.fill();\r\n\tContext.setGlobalAlpha(1);\r\n\tContext.clip();\r\n\tdrawImageFn(Context, obj);\r\n\t_app.log('默认图片绘制完毕');\r\n\tContext.restore();\r\n}\r\n\r\nfunction drawRoundRectImage(Context, obj) { // 绘制矩形\r\n\t_app.log('进入绘制矩形图片方法, obj:' + JSON.stringify(obj));\r\n\tContext.save();\r\n\tlet {\r\n\t\tdx,\r\n\t\tdy,\r\n\t\tdWidth,\r\n\t\tdHeight,\r\n\t\troundRectSet,\r\n\t\timageInfo\r\n\t} = obj;\r\n\tlet r;\r\n\tif (typeof roundRectSet === 'object') {\r\n\t\tr = roundRectSet.r;\r\n\t}\r\n\tr = r || dWidth * .1;\r\n\r\n\tif (dWidth < 2 * r) {\r\n\t\tr = dWidth / 2;\r\n\t}\r\n\tif (dHeight < 2 * r) {\r\n\t\tr = dHeight / 2;\r\n\t}\r\n\tContext.beginPath();\r\n\tContext.moveTo(dx + r, dy);\r\n\tContext.arcTo(dx + dWidth, dy, dx + dWidth, dy + dHeight, r);\r\n\tContext.arcTo(dx + dWidth, dy + dHeight, dx, dy + dHeight, r);\r\n\tContext.arcTo(dx, dy + dHeight, dx, dy, r);\r\n\tContext.arcTo(dx, dy, dx + dWidth, dy, r);\r\n\tContext.closePath();\r\n\tContext.setGlobalAlpha(0);\r\n\tContext.fillStyle = '#FFFFFF';\r\n\tContext.fill();\r\n\tContext.setGlobalAlpha(1);\r\n\tContext.clip();\r\n\tdrawImageFn(Context, obj);\r\n\tContext.restore();\r\n\t_app.log('进入绘制矩形图片方法, 绘制完毕');\r\n}\r\n\r\n// export \r\nfunction drawQrCode(Context, qrCodeObj) { //生成二维码方法， 参考了 诗小柒 的二维码生成器代码\r\n\t_app.log('进入绘制二维码方法')\r\n\t_app.showLoading('正在生成二维码');\r\n\tlet qrcodeAlgObjCache = [];\r\n\tlet options = {\r\n\t\ttext: String(qrCodeObj.text || '') || '', // 生成内容\r\n\t\tsize: Number(qrCodeObj.size || 0) || 200, // 二维码大小\r\n\t\tbackground: String(qrCodeObj.background || '') || '#ffffff', // 背景色\r\n\t\tforeground: String(qrCodeObj.foreground || '') || '#000000', // 前景色\r\n\t\tpdground: String(qrCodeObj.pdground || '') || '#000000', // 定位角点颜色\r\n\t\tcorrectLevel: Number(qrCodeObj.correctLevel || 0) || 3, // 容错级别\r\n\t\timage: String(qrCodeObj.image || '') || '', // 二维码图标\r\n\t\timageSize: Number(qrCodeObj.imageSize || 0) || 40, // 二维码图标大小\r\n\t\tdx: Number(qrCodeObj.dx || 0) || 0, // x轴距离\r\n\t\tdy: Number(qrCodeObj.dy || 0) || 0 // y轴距离\r\n\t}\r\n\tlet qrCodeAlg = null;\r\n\tlet d = 0;\r\n\tfor (var i = 0, l = qrcodeAlgObjCache.length; i < l; i++) {\r\n\t\td = i;\r\n\t\tif (qrcodeAlgObjCache[i].text == options.text && qrcodeAlgObjCache[i].text.correctLevel == options.correctLevel) {\r\n\t\t\tqrCodeAlg = qrcodeAlgObjCache[i].obj;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (d == l) {\r\n\t\tqrCodeAlg = new QRCodeAlg(options.text, options.correctLevel);\r\n\t\tqrcodeAlgObjCache.push({\r\n\t\t\ttext: options.text,\r\n\t\t\tcorrectLevel: options.correctLevel,\r\n\t\t\tobj: qrCodeAlg\r\n\t\t});\r\n\t}\r\n\tlet getForeGround = function(config) {\r\n\t\tlet options = config.options;\r\n\t\tif (options.pdground && (\r\n\t\t\t\t(config.row > 1 && config.row < 5 && config.col > 1 && config.col < 5) ||\r\n\t\t\t\t(config.row > (config.count - 6) && config.row < (config.count - 2) && config.col > 1 && config.col < 5) ||\r\n\t\t\t\t(config.row > 1 && config.row < 5 && config.col > (config.count - 6) && config.col < (config.count - 2))\r\n\t\t\t)) {\r\n\t\t\treturn options.pdground;\r\n\t\t}\r\n\t\treturn options.foreground;\r\n\t}\r\n\tlet count = qrCodeAlg.getModuleCount();\r\n\tlet ratioSize = options.size;\r\n\tlet ratioImgSize = options.imageSize;\r\n\t//计算每个点的长宽\r\n\tlet tileW = (ratioSize / count).toPrecision(4);\r\n\tlet tileH = (ratioSize / count).toPrecision(4);\r\n\t//绘制\r\n\tfor (let row = 0; row < count; row++) {\r\n\t\tfor (let col = 0; col < count; col++) {\r\n\t\t\tlet w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));\r\n\t\t\tlet h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));\r\n\t\t\tlet foreground = getForeGround({\r\n\t\t\t\trow: row,\r\n\t\t\t\tcol: col,\r\n\t\t\t\tcount: count,\r\n\t\t\t\toptions: options\r\n\t\t\t});\r\n\t\t\tContext.setFillStyle(qrCodeAlg.modules[row][col] ? foreground : options.background);\r\n\t\t\tContext.fillRect(options.dx + Math.round(col * tileW), options.dy + Math.round(row * tileH), w, h);\r\n\t\t}\r\n\t}\r\n\tif (options.image) {\r\n\t\tlet x = options.dx + Number(((ratioSize - ratioImgSize) / 2).toFixed(2));\r\n\t\tlet y = options.dy + Number(((ratioSize - ratioImgSize) / 2).toFixed(2));\r\n\t\tdrawRoundedRect(Context, x, y, ratioImgSize, ratioImgSize, 2, 6, true, true)\r\n\t\tContext.drawImage(options.image, x, y, ratioImgSize, ratioImgSize);\r\n\t\t// 画圆角矩形\r\n\t\tfunction drawRoundedRect(ctxi, x, y, width, height, r, lineWidth, fill, stroke) {\r\n\t\t\tctxi.setLineWidth(lineWidth);\r\n\t\t\tctxi.setFillStyle(options.background);\r\n\t\t\tctxi.setStrokeStyle(options.background);\r\n\t\t\tctxi.beginPath(); // draw top and top right corner \r\n\t\t\tctxi.moveTo(x + r, y);\r\n\t\t\tctxi.arcTo(x + width, y, x + width, y + r, r); // draw right side and bottom right corner \r\n\t\t\tctxi.arcTo(x + width, y + height, x + width - r, y + height, r); // draw bottom and bottom left corner \r\n\t\t\tctxi.arcTo(x, y + height, x, y + height - r, r); // draw left and top left corner \r\n\t\t\tctxi.arcTo(x, y, x + r, y, r);\r\n\t\t\tctxi.closePath();\r\n\t\t\tif (fill) {\r\n\t\t\t\tctxi.fill();\r\n\t\t\t}\r\n\t\t\tif (stroke) {\r\n\t\t\t\tctxi.stroke();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t_app.log('进入绘制二维码方法完毕')\r\n\t_app.hideLoading();\r\n}\r\n\r\n\r\nfunction getShreUserPosterBackground(objs) { //检查背景图是否存在于本地， 若存在直接返回， 否则调用getShreUserPosterBackgroundFc方法\r\n\tlet {\r\n\t\tbackgroundImage,\r\n\t\ttype\r\n\t} = objs;\r\n\treturn new Promise(async (resolve, reject) => {\r\n\t\ttry {\r\n\t\t\t_app.showLoading('正在获取海报背景图');\r\n\t\t\tconst savedFilePath = await getShreUserPosterBackgroundFc(objs)\r\n\t\t\t_app.hideLoading();\r\n\t\t\tresolve(savedFilePath);\r\n\t\t} catch (e) {\r\n\t\t\t_app.hideLoading();\r\n\t\t\t_app.showToast('获取分享用户背景图失败:' + JSON.stringify(e));\r\n\t\t\t_app.log(JSON.stringify(e));\r\n\t\t\treject(e);\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction getPosterStorage(type) {\r\n\treturn _app.getStorageSync(getStorageKey(type));\r\n}\r\n\r\nfunction removePosterStorage(type) {\r\n\tconst ShreUserPosterBackgroundKey = getStorageKey(type);\r\n\tconst pbg = _app.getStorageSync(ShreUserPosterBackgroundKey);\r\n\tif (pbg && pbg.path) {\r\n\t\t_app.removeStorageSync(ShreUserPosterBackgroundKey);\r\n\t}\r\n}\r\n\r\nfunction setPosterStorage(type, data) {\r\n\t_app.setStorage(getStorageKey(type), data);\r\n}\r\n\r\nfunction getStorageKey(type) {\r\n\treturn ShreUserPosterBackgroundKey + (type || 'default');\r\n}\r\n\r\nfunction getShreUserPosterBackgroundFc(objs, upimage) { //下载并保存背景图方法\r\n\tlet {\r\n\t\tbackgroundImage,\r\n\t\ttype\r\n\t} = objs;\r\n\t_app.log('获取分享背景图, 尝试清空本地数据');\r\n\treturn new Promise(async (resolve, reject) => {\r\n\t\ttry {\r\n\t\t\t_app.showLoading('正在下载海报背景图');\r\n\t\t\t_app.log('没有从后端获取的背景图片路径, 尝试从后端获取背景图片路径');\r\n\t\t\tlet image = backgroundImage?backgroundImage:(await _app.getPosterUrl(objs));\r\n\t\t\timage = (await base64ToPathFn(image));\r\n\t\t\t_app.log('尝试下载并保存背景图:' + image);\r\n\t\t\tconst savedFilePath = await _app.downLoadAndSaveFile_PromiseFc(image);\r\n\t\t\tif (savedFilePath) {\r\n\t\t\t\t_app.log('下载并保存背景图成功:' + savedFilePath);\r\n\t\t\t\tconst imageObj = await _app.getImageInfo_PromiseFc(savedFilePath);\r\n\t\t\t\t_app.log('获取图片信息成功');\r\n\t\t\t\tconst returnObj = {\r\n\t\t\t\t\tpath: savedFilePath,\r\n\t\t\t\t\twidth: imageObj.width,\r\n\t\t\t\t\theight: imageObj.height,\r\n\t\t\t\t\tname: _app.fileNameInPath(image)\r\n\t\t\t\t}\r\n\t\t\t\t_app.log('拼接背景图信息对象成功:' + JSON.stringify(returnObj));\r\n\r\n\r\n\t\t\t\tsetPosterStorage(type, { ...returnObj\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\t_app.hideLoading();\r\n\t\t\t\t_app.log('返回背景图信息对象');\r\n\t\t\t\tresolve({ ...returnObj\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t_app.hideLoading();\r\n\t\t\t\treject('not find savedFilePath');\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t//TODO handle the exception\r\n\t\t\treject(e);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\nmodule.exports = {\r\n\tgetSharePoster,\r\n\tsetText,\r\n\tsetImage,\r\n\tdrawText,\r\n\tdrawImage,\r\n\tdrawQrCode,\r\n\tdrawFillRect,\r\n\tdrawStrokeRect,\r\n\tdrawRoundStrokeRect,\r\n\tdrawRoundFillRect\r\n}\r\n"," /**\r\n     * 获取单个字符的utf8编码\r\n     * unicode BMP平面约65535个字符\r\n     * @param {num} code\r\n     * return {array}\r\n     */\r\n    function unicodeFormat8(code) {\r\n        // 1 byte\r\n        var c0, c1, c2;\r\n        if (code < 128) {\r\n            return [code];\r\n            // 2 bytes\r\n        } else if (code < 2048) {\r\n            c0 = 192 + (code >> 6);\r\n            c1 = 128 + (code & 63);\r\n            return [c0, c1];\r\n            // 3 bytes\r\n        } else {\r\n            c0 = 224 + (code >> 12);\r\n            c1 = 128 + (code >> 6 & 63);\r\n            c2 = 128 + (code & 63);\r\n            return [c0, c1, c2];\r\n        }\r\n    }\r\n    /**\r\n     * 获取字符串的utf8编码字节串\r\n     * @param {string} string\r\n     * @return {array}\r\n     */\r\n    function getUTF8Bytes(string) {\r\n        var utf8codes = [];\r\n        for (var i = 0; i < string.length; i++) {\r\n            var code = string.charCodeAt(i);\r\n            var utf8 = unicodeFormat8(code);\r\n            for (var j = 0; j < utf8.length; j++) {\r\n                utf8codes.push(utf8[j]);\r\n            }\r\n        }\r\n        return utf8codes;\r\n    }\r\n    /**\r\n     * 二维码算法实现\r\n     * @param {string} data              要编码的信息字符串\r\n     * @param {num} errorCorrectLevel 纠错等级\r\n     */\r\n    export default function QRCodeAlg(data, errorCorrectLevel) {\r\n        this.typeNumber = -1; //版本\r\n        this.errorCorrectLevel = errorCorrectLevel;\r\n        this.modules = null; //二维矩阵，存放最终结果\r\n        this.moduleCount = 0; //矩阵大小\r\n        this.dataCache = null; //数据缓存\r\n        this.rsBlocks = null; //版本数据信息\r\n        this.totalDataCount = -1; //可使用的数据量\r\n        this.data = data;\r\n        this.utf8bytes = getUTF8Bytes(data);\r\n        this.make();\r\n    }\r\n    QRCodeAlg.prototype = {\r\n        constructor: QRCodeAlg,\r\n        /**\r\n         * 获取二维码矩阵大小\r\n         * @return {num} 矩阵大小\r\n         */\r\n        getModuleCount: function () {\r\n            return this.moduleCount;\r\n        },\r\n        /**\r\n         * 编码\r\n         */\r\n        make: function () {\r\n            this.getRightType();\r\n            this.dataCache = this.createData();\r\n            this.createQrcode();\r\n        },\r\n        /**\r\n         * 设置二位矩阵功能图形\r\n         * @param  {bool} test 表示是否在寻找最好掩膜阶段\r\n         * @param  {num} maskPattern 掩膜的版本\r\n         */\r\n        makeImpl: function (maskPattern) {\r\n            this.moduleCount = this.typeNumber * 4 + 17;\r\n            this.modules = new Array(this.moduleCount);\r\n            for (var row = 0; row < this.moduleCount; row++) {\r\n                this.modules[row] = new Array(this.moduleCount);\r\n            }\r\n            this.setupPositionProbePattern(0, 0);\r\n            this.setupPositionProbePattern(this.moduleCount - 7, 0);\r\n            this.setupPositionProbePattern(0, this.moduleCount - 7);\r\n            this.setupPositionAdjustPattern();\r\n            this.setupTimingPattern();\r\n            this.setupTypeInfo(true, maskPattern);\r\n            if (this.typeNumber >= 7) {\r\n                this.setupTypeNumber(true);\r\n            }\r\n            this.mapData(this.dataCache, maskPattern);\r\n        },\r\n        /**\r\n         * 设置二维码的位置探测图形\r\n         * @param  {num} row 探测图形的中心横坐标\r\n         * @param  {num} col 探测图形的中心纵坐标\r\n         */\r\n        setupPositionProbePattern: function (row, col) {\r\n            for (var r = -1; r <= 7; r++) {\r\n                if (row + r <= -1 || this.moduleCount <= row + r) continue;\r\n                for (var c = -1; c <= 7; c++) {\r\n                    if (col + c <= -1 || this.moduleCount <= col + c) continue;\r\n                    if ((0 <= r && r <= 6 && (c == 0 || c == 6)) || (0 <= c && c <= 6 && (r == 0 || r == 6)) || (2 <= r && r <= 4 && 2 <= c && c <= 4)) {\r\n                        this.modules[row + r][col + c] = true;\r\n                    } else {\r\n                        this.modules[row + r][col + c] = false;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * 创建二维码\r\n         * @return {[type]} [description]\r\n         */\r\n        createQrcode: function () {\r\n            var minLostPoint = 0;\r\n            var pattern = 0;\r\n            var bestModules = null;\r\n            for (var i = 0; i < 8; i++) {\r\n                this.makeImpl(i);\r\n                var lostPoint = QRUtil.getLostPoint(this);\r\n                if (i == 0 || minLostPoint > lostPoint) {\r\n                    minLostPoint = lostPoint;\r\n                    pattern = i;\r\n                    bestModules = this.modules;\r\n                }\r\n            }\r\n            this.modules = bestModules;\r\n            this.setupTypeInfo(false, pattern);\r\n            if (this.typeNumber >= 7) {\r\n                this.setupTypeNumber(false);\r\n            }\r\n        },\r\n        /**\r\n         * 设置定位图形\r\n         * @return {[type]} [description]\r\n         */\r\n        setupTimingPattern: function () {\r\n            for (var r = 8; r < this.moduleCount - 8; r++) {\r\n                if (this.modules[r][6] != null) {\r\n                    continue;\r\n                }\r\n                this.modules[r][6] = (r % 2 == 0);\r\n                if (this.modules[6][r] != null) {\r\n                    continue;\r\n                }\r\n                this.modules[6][r] = (r % 2 == 0);\r\n            }\r\n        },\r\n        /**\r\n         * 设置矫正图形\r\n         * @return {[type]} [description]\r\n         */\r\n        setupPositionAdjustPattern: function () {\r\n            var pos = QRUtil.getPatternPosition(this.typeNumber);\r\n            for (var i = 0; i < pos.length; i++) {\r\n                for (var j = 0; j < pos.length; j++) {\r\n                    var row = pos[i];\r\n                    var col = pos[j];\r\n                    if (this.modules[row][col] != null) {\r\n                        continue;\r\n                    }\r\n                    for (var r = -2; r <= 2; r++) {\r\n                        for (var c = -2; c <= 2; c++) {\r\n                            if (r == -2 || r == 2 || c == -2 || c == 2 || (r == 0 && c == 0)) {\r\n                                this.modules[row + r][col + c] = true;\r\n                            } else {\r\n                                this.modules[row + r][col + c] = false;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        /**\r\n         * 设置版本信息（7以上版本才有）\r\n         * @param  {bool} test 是否处于判断最佳掩膜阶段\r\n         * @return {[type]}      [description]\r\n         */\r\n        setupTypeNumber: function (test) {\r\n            var bits = QRUtil.getBCHTypeNumber(this.typeNumber);\r\n            for (var i = 0; i < 18; i++) {\r\n                var mod = (!test && ((bits >> i) & 1) == 1);\r\n                this.modules[Math.floor(i / 3)][i % 3 + this.moduleCount - 8 - 3] = mod;\r\n                this.modules[i % 3 + this.moduleCount - 8 - 3][Math.floor(i / 3)] = mod;\r\n            }\r\n        },\r\n        /**\r\n         * 设置格式信息（纠错等级和掩膜版本）\r\n         * @param  {bool} test\r\n         * @param  {num} maskPattern 掩膜版本\r\n         * @return {}\r\n         */\r\n        setupTypeInfo: function (test, maskPattern) {\r\n            var data = (QRErrorCorrectLevel[this.errorCorrectLevel] << 3) | maskPattern;\r\n            var bits = QRUtil.getBCHTypeInfo(data);\r\n            // vertical\r\n            for (var i = 0; i < 15; i++) {\r\n                var mod = (!test && ((bits >> i) & 1) == 1);\r\n                if (i < 6) {\r\n                    this.modules[i][8] = mod;\r\n                } else if (i < 8) {\r\n                    this.modules[i + 1][8] = mod;\r\n                } else {\r\n                    this.modules[this.moduleCount - 15 + i][8] = mod;\r\n                }\r\n                // horizontal\r\n                var mod = (!test && ((bits >> i) & 1) == 1);\r\n                if (i < 8) {\r\n                    this.modules[8][this.moduleCount - i - 1] = mod;\r\n                } else if (i < 9) {\r\n                    this.modules[8][15 - i - 1 + 1] = mod;\r\n                } else {\r\n                    this.modules[8][15 - i - 1] = mod;\r\n                }\r\n            }\r\n            // fixed module\r\n            this.modules[this.moduleCount - 8][8] = (!test);\r\n        },\r\n        /**\r\n         * 数据编码\r\n         * @return {[type]} [description]\r\n         */\r\n        createData: function () {\r\n            var buffer = new QRBitBuffer();\r\n            var lengthBits = this.typeNumber > 9 ? 16 : 8;\r\n            buffer.put(4, 4); //添加模式\r\n            buffer.put(this.utf8bytes.length, lengthBits);\r\n            for (var i = 0, l = this.utf8bytes.length; i < l; i++) {\r\n                buffer.put(this.utf8bytes[i], 8);\r\n            }\r\n            if (buffer.length + 4 <= this.totalDataCount * 8) {\r\n                buffer.put(0, 4);\r\n            }\r\n            // padding\r\n            while (buffer.length % 8 != 0) {\r\n                buffer.putBit(false);\r\n            }\r\n            // padding\r\n            while (true) {\r\n                if (buffer.length >= this.totalDataCount * 8) {\r\n                    break;\r\n                }\r\n                buffer.put(QRCodeAlg.PAD0, 8);\r\n                if (buffer.length >= this.totalDataCount * 8) {\r\n                    break;\r\n                }\r\n                buffer.put(QRCodeAlg.PAD1, 8);\r\n            }\r\n            return this.createBytes(buffer);\r\n        },\r\n        /**\r\n         * 纠错码编码\r\n         * @param  {buffer} buffer 数据编码\r\n         * @return {[type]}\r\n         */\r\n        createBytes: function (buffer) {\r\n            var offset = 0;\r\n            var maxDcCount = 0;\r\n            var maxEcCount = 0;\r\n            var length = this.rsBlock.length / 3;\r\n            var rsBlocks = new Array();\r\n            for (var i = 0; i < length; i++) {\r\n                var count = this.rsBlock[i * 3 + 0];\r\n                var totalCount = this.rsBlock[i * 3 + 1];\r\n                var dataCount = this.rsBlock[i * 3 + 2];\r\n                for (var j = 0; j < count; j++) {\r\n                    rsBlocks.push([dataCount, totalCount]);\r\n                }\r\n            }\r\n            var dcdata = new Array(rsBlocks.length);\r\n            var ecdata = new Array(rsBlocks.length);\r\n            for (var r = 0; r < rsBlocks.length; r++) {\r\n                var dcCount = rsBlocks[r][0];\r\n                var ecCount = rsBlocks[r][1] - dcCount;\r\n                maxDcCount = Math.max(maxDcCount, dcCount);\r\n                maxEcCount = Math.max(maxEcCount, ecCount);\r\n                dcdata[r] = new Array(dcCount);\r\n                for (var i = 0; i < dcdata[r].length; i++) {\r\n                    dcdata[r][i] = 0xff & buffer.buffer[i + offset];\r\n                }\r\n                offset += dcCount;\r\n                var rsPoly = QRUtil.getErrorCorrectPolynomial(ecCount);\r\n                var rawPoly = new QRPolynomial(dcdata[r], rsPoly.getLength() - 1);\r\n                var modPoly = rawPoly.mod(rsPoly);\r\n                ecdata[r] = new Array(rsPoly.getLength() - 1);\r\n                for (var i = 0; i < ecdata[r].length; i++) {\r\n                    var modIndex = i + modPoly.getLength() - ecdata[r].length;\r\n                    ecdata[r][i] = (modIndex >= 0) ? modPoly.get(modIndex) : 0;\r\n                }\r\n            }\r\n            var data = new Array(this.totalDataCount);\r\n            var index = 0;\r\n            for (var i = 0; i < maxDcCount; i++) {\r\n                for (var r = 0; r < rsBlocks.length; r++) {\r\n                    if (i < dcdata[r].length) {\r\n                        data[index++] = dcdata[r][i];\r\n                    }\r\n                }\r\n            }\r\n            for (var i = 0; i < maxEcCount; i++) {\r\n                for (var r = 0; r < rsBlocks.length; r++) {\r\n                    if (i < ecdata[r].length) {\r\n                        data[index++] = ecdata[r][i];\r\n                    }\r\n                }\r\n            }\r\n            return data;\r\n\r\n        },\r\n        /**\r\n         * 布置模块，构建最终信息\r\n         * @param  {} data\r\n         * @param  {} maskPattern\r\n         * @return {}\r\n         */\r\n        mapData: function (data, maskPattern) {\r\n            var inc = -1;\r\n            var row = this.moduleCount - 1;\r\n            var bitIndex = 7;\r\n            var byteIndex = 0;\r\n            for (var col = this.moduleCount - 1; col > 0; col -= 2) {\r\n                if (col == 6) col--;\r\n                while (true) {\r\n                    for (var c = 0; c < 2; c++) {\r\n                        if (this.modules[row][col - c] == null) {\r\n                            var dark = false;\r\n                            if (byteIndex < data.length) {\r\n                                dark = (((data[byteIndex] >>> bitIndex) & 1) == 1);\r\n                            }\r\n                            var mask = QRUtil.getMask(maskPattern, row, col - c);\r\n                            if (mask) {\r\n                                dark = !dark;\r\n                            }\r\n                            this.modules[row][col - c] = dark;\r\n                            bitIndex--;\r\n                            if (bitIndex == -1) {\r\n                                byteIndex++;\r\n                                bitIndex = 7;\r\n                            }\r\n                        }\r\n                    }\r\n                    row += inc;\r\n                    if (row < 0 || this.moduleCount <= row) {\r\n                        row -= inc;\r\n                        inc = -inc;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * 填充字段\r\n     */\r\n    QRCodeAlg.PAD0 = 0xEC;\r\n    QRCodeAlg.PAD1 = 0x11;\r\n    //---------------------------------------------------------------------\r\n    // 纠错等级对应的编码\r\n    //---------------------------------------------------------------------\r\n    var QRErrorCorrectLevel = [1, 0, 3, 2];\r\n    //---------------------------------------------------------------------\r\n    // 掩膜版本\r\n    //---------------------------------------------------------------------\r\n    var QRMaskPattern = {\r\n        PATTERN000: 0,\r\n        PATTERN001: 1,\r\n        PATTERN010: 2,\r\n        PATTERN011: 3,\r\n        PATTERN100: 4,\r\n        PATTERN101: 5,\r\n        PATTERN110: 6,\r\n        PATTERN111: 7\r\n    };\r\n    //---------------------------------------------------------------------\r\n    // 工具类\r\n    //---------------------------------------------------------------------\r\n    var QRUtil = {\r\n        /*\r\n        每个版本矫正图形的位置\r\n         */\r\n        PATTERN_POSITION_TABLE: [\r\n            [],\r\n            [6, 18],\r\n            [6, 22],\r\n            [6, 26],\r\n            [6, 30],\r\n            [6, 34],\r\n            [6, 22, 38],\r\n            [6, 24, 42],\r\n            [6, 26, 46],\r\n            [6, 28, 50],\r\n            [6, 30, 54],\r\n            [6, 32, 58],\r\n            [6, 34, 62],\r\n            [6, 26, 46, 66],\r\n            [6, 26, 48, 70],\r\n            [6, 26, 50, 74],\r\n            [6, 30, 54, 78],\r\n            [6, 30, 56, 82],\r\n            [6, 30, 58, 86],\r\n            [6, 34, 62, 90],\r\n            [6, 28, 50, 72, 94],\r\n            [6, 26, 50, 74, 98],\r\n            [6, 30, 54, 78, 102],\r\n            [6, 28, 54, 80, 106],\r\n            [6, 32, 58, 84, 110],\r\n            [6, 30, 58, 86, 114],\r\n            [6, 34, 62, 90, 118],\r\n            [6, 26, 50, 74, 98, 122],\r\n            [6, 30, 54, 78, 102, 126],\r\n            [6, 26, 52, 78, 104, 130],\r\n            [6, 30, 56, 82, 108, 134],\r\n            [6, 34, 60, 86, 112, 138],\r\n            [6, 30, 58, 86, 114, 142],\r\n            [6, 34, 62, 90, 118, 146],\r\n            [6, 30, 54, 78, 102, 126, 150],\r\n            [6, 24, 50, 76, 102, 128, 154],\r\n            [6, 28, 54, 80, 106, 132, 158],\r\n            [6, 32, 58, 84, 110, 136, 162],\r\n            [6, 26, 54, 82, 110, 138, 166],\r\n            [6, 30, 58, 86, 114, 142, 170]\r\n        ],\r\n        G15: (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0),\r\n        G18: (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0),\r\n        G15_MASK: (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1),\r\n        /*\r\n        BCH编码格式信息\r\n         */\r\n        getBCHTypeInfo: function (data) {\r\n            var d = data << 10;\r\n            while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) >= 0) {\r\n                d ^= (QRUtil.G15 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15)));\r\n            }\r\n            return ((data << 10) | d) ^ QRUtil.G15_MASK;\r\n        },\r\n        /*\r\n        BCH编码版本信息\r\n         */\r\n        getBCHTypeNumber: function (data) {\r\n            var d = data << 12;\r\n            while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18) >= 0) {\r\n                d ^= (QRUtil.G18 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18)));\r\n            }\r\n            return (data << 12) | d;\r\n        },\r\n        /*\r\n        获取BCH位信息\r\n         */\r\n        getBCHDigit: function (data) {\r\n            var digit = 0;\r\n            while (data != 0) {\r\n                digit++;\r\n                data >>>= 1;\r\n            }\r\n            return digit;\r\n        },\r\n        /*\r\n        获取版本对应的矫正图形位置\r\n         */\r\n        getPatternPosition: function (typeNumber) {\r\n            return QRUtil.PATTERN_POSITION_TABLE[typeNumber - 1];\r\n        },\r\n        /*\r\n        掩膜算法\r\n         */\r\n        getMask: function (maskPattern, i, j) {\r\n            switch (maskPattern) {\r\n                case QRMaskPattern.PATTERN000:\r\n                    return (i + j) % 2 == 0;\r\n                case QRMaskPattern.PATTERN001:\r\n                    return i % 2 == 0;\r\n                case QRMaskPattern.PATTERN010:\r\n                    return j % 3 == 0;\r\n                case QRMaskPattern.PATTERN011:\r\n                    return (i + j) % 3 == 0;\r\n                case QRMaskPattern.PATTERN100:\r\n                    return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 == 0;\r\n                case QRMaskPattern.PATTERN101:\r\n                    return (i * j) % 2 + (i * j) % 3 == 0;\r\n                case QRMaskPattern.PATTERN110:\r\n                    return ((i * j) % 2 + (i * j) % 3) % 2 == 0;\r\n                case QRMaskPattern.PATTERN111:\r\n                    return ((i * j) % 3 + (i + j) % 2) % 2 == 0;\r\n                default:\r\n                    throw new Error(\"bad maskPattern:\" + maskPattern);\r\n            }\r\n        },\r\n        /*\r\n        获取RS的纠错多项式\r\n         */\r\n        getErrorCorrectPolynomial: function (errorCorrectLength) {\r\n            var a = new QRPolynomial([1], 0);\r\n            for (var i = 0; i < errorCorrectLength; i++) {\r\n                a = a.multiply(new QRPolynomial([1, QRMath.gexp(i)], 0));\r\n            }\r\n            return a;\r\n        },\r\n        /*\r\n        获取评价\r\n         */\r\n        getLostPoint: function (qrCode) {\r\n            var moduleCount = qrCode.getModuleCount(),\r\n                lostPoint = 0,\r\n                darkCount = 0;\r\n            for (var row = 0; row < moduleCount; row++) {\r\n                var sameCount = 0;\r\n                var head = qrCode.modules[row][0];\r\n                for (var col = 0; col < moduleCount; col++) {\r\n                    var current = qrCode.modules[row][col];\r\n                    //level 3 评价\r\n                    if (col < moduleCount - 6) {\r\n                        if (current && !qrCode.modules[row][col + 1] && qrCode.modules[row][col + 2] && qrCode.modules[row][col + 3] && qrCode.modules[row][col + 4] && !qrCode.modules[row][col + 5] && qrCode.modules[row][col + 6]) {\r\n                            if (col < moduleCount - 10) {\r\n                                if (qrCode.modules[row][col + 7] && qrCode.modules[row][col + 8] && qrCode.modules[row][col + 9] && qrCode.modules[row][col + 10]) {\r\n                                    lostPoint += 40;\r\n                                }\r\n                            } else if (col > 3) {\r\n                                if (qrCode.modules[row][col - 1] && qrCode.modules[row][col - 2] && qrCode.modules[row][col - 3] && qrCode.modules[row][col - 4]) {\r\n                                    lostPoint += 40;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    //level 2 评价\r\n                    if ((row < moduleCount - 1) && (col < moduleCount - 1)) {\r\n                        var count = 0;\r\n                        if (current) count++;\r\n                        if (qrCode.modules[row + 1][col]) count++;\r\n                        if (qrCode.modules[row][col + 1]) count++;\r\n                        if (qrCode.modules[row + 1][col + 1]) count++;\r\n                        if (count == 0 || count == 4) {\r\n                            lostPoint += 3;\r\n                        }\r\n                    }\r\n                    //level 1 评价\r\n                    if (head ^ current) {\r\n                        sameCount++;\r\n                    } else {\r\n                        head = current;\r\n                        if (sameCount >= 5) {\r\n                            lostPoint += (3 + sameCount - 5);\r\n                        }\r\n                        sameCount = 1;\r\n                    }\r\n                    //level 4 评价\r\n                    if (current) {\r\n                        darkCount++;\r\n                    }\r\n                }\r\n            }\r\n            for (var col = 0; col < moduleCount; col++) {\r\n                var sameCount = 0;\r\n                var head = qrCode.modules[0][col];\r\n                for (var row = 0; row < moduleCount; row++) {\r\n                    var current = qrCode.modules[row][col];\r\n                    //level 3 评价\r\n                    if (row < moduleCount - 6) {\r\n                        if (current && !qrCode.modules[row + 1][col] && qrCode.modules[row + 2][col] && qrCode.modules[row + 3][col] && qrCode.modules[row + 4][col] && !qrCode.modules[row + 5][col] && qrCode.modules[row + 6][col]) {\r\n                            if (row < moduleCount - 10) {\r\n                                if (qrCode.modules[row + 7][col] && qrCode.modules[row + 8][col] && qrCode.modules[row + 9][col] && qrCode.modules[row + 10][col]) {\r\n                                    lostPoint += 40;\r\n                                }\r\n                            } else if (row > 3) {\r\n                                if (qrCode.modules[row - 1][col] && qrCode.modules[row - 2][col] && qrCode.modules[row - 3][col] && qrCode.modules[row - 4][col]) {\r\n                                    lostPoint += 40;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    //level 1 评价\r\n                    if (head ^ current) {\r\n                        sameCount++;\r\n                    } else {\r\n                        head = current;\r\n                        if (sameCount >= 5) {\r\n                            lostPoint += (3 + sameCount - 5);\r\n                        }\r\n                        sameCount = 1;\r\n                    }\r\n                }\r\n            }\r\n            // LEVEL4\r\n            var ratio = Math.abs(100 * darkCount / moduleCount / moduleCount - 50) / 5;\r\n            lostPoint += ratio * 10;\r\n            return lostPoint;\r\n        }\r\n\r\n    };\r\n    //---------------------------------------------------------------------\r\n    // QRMath使用的数学工具\r\n    //---------------------------------------------------------------------\r\n    var QRMath = {\r\n        /*\r\n        将n转化为a^m\r\n         */\r\n        glog: function (n) {\r\n            if (n < 1) {\r\n                throw new Error(\"glog(\" + n + \")\");\r\n            }\r\n            return QRMath.LOG_TABLE[n];\r\n        },\r\n        /*\r\n        将a^m转化为n\r\n         */\r\n        gexp: function (n) {\r\n            while (n < 0) {\r\n                n += 255;\r\n            }\r\n            while (n >= 256) {\r\n                n -= 255;\r\n            }\r\n            return QRMath.EXP_TABLE[n];\r\n        },\r\n        EXP_TABLE: new Array(256),\r\n        LOG_TABLE: new Array(256)\r\n\r\n    };\r\n    for (var i = 0; i < 8; i++) {\r\n        QRMath.EXP_TABLE[i] = 1 << i;\r\n    }\r\n    for (var i = 8; i < 256; i++) {\r\n        QRMath.EXP_TABLE[i] = QRMath.EXP_TABLE[i - 4] ^ QRMath.EXP_TABLE[i - 5] ^ QRMath.EXP_TABLE[i - 6] ^ QRMath.EXP_TABLE[i - 8];\r\n    }\r\n    for (var i = 0; i < 255; i++) {\r\n        QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]] = i;\r\n    }\r\n    //---------------------------------------------------------------------\r\n    // QRPolynomial 多项式\r\n    //---------------------------------------------------------------------\r\n    /**\r\n     * 多项式类\r\n     * @param {Array} num   系数\r\n     * @param {num} shift a^shift\r\n     */\r\n    function QRPolynomial(num, shift) {\r\n        if (num.length == undefined) {\r\n            throw new Error(num.length + \"/\" + shift);\r\n        }\r\n        var offset = 0;\r\n        while (offset < num.length && num[offset] == 0) {\r\n            offset++;\r\n        }\r\n        this.num = new Array(num.length - offset + shift);\r\n        for (var i = 0; i < num.length - offset; i++) {\r\n            this.num[i] = num[i + offset];\r\n        }\r\n    }\r\n    QRPolynomial.prototype = {\r\n        get: function (index) {\r\n            return this.num[index];\r\n        },\r\n        getLength: function () {\r\n            return this.num.length;\r\n        },\r\n        /**\r\n         * 多项式乘法\r\n         * @param  {QRPolynomial} e 被乘多项式\r\n         * @return {[type]}   [description]\r\n         */\r\n        multiply: function (e) {\r\n            var num = new Array(this.getLength() + e.getLength() - 1);\r\n            for (var i = 0; i < this.getLength(); i++) {\r\n                for (var j = 0; j < e.getLength(); j++) {\r\n                    num[i + j] ^= QRMath.gexp(QRMath.glog(this.get(i)) + QRMath.glog(e.get(j)));\r\n                }\r\n            }\r\n            return new QRPolynomial(num, 0);\r\n        },\r\n        /**\r\n         * 多项式模运算\r\n         * @param  {QRPolynomial} e 模多项式\r\n         * @return {}\r\n         */\r\n        mod: function (e) {\r\n            var tl = this.getLength(),\r\n                el = e.getLength();\r\n            if (tl - el < 0) {\r\n                return this;\r\n            }\r\n            var num = new Array(tl);\r\n            for (var i = 0; i < tl; i++) {\r\n                num[i] = this.get(i);\r\n            }\r\n            while (num.length >= el) {\r\n                var ratio = QRMath.glog(num[0]) - QRMath.glog(e.get(0));\r\n\r\n                for (var i = 0; i < e.getLength(); i++) {\r\n                    num[i] ^= QRMath.gexp(QRMath.glog(e.get(i)) + ratio);\r\n                }\r\n                while (num[0] == 0) {\r\n                    num.shift();\r\n                }\r\n            }\r\n            return new QRPolynomial(num, 0);\r\n        }\r\n    };\r\n\r\n    //---------------------------------------------------------------------\r\n    // RS_BLOCK_TABLE\r\n    //---------------------------------------------------------------------\r\n    /*\r\n    二维码各个版本信息[块数, 每块中的数据块数, 每块中的信息块数]\r\n     */\r\n    var RS_BLOCK_TABLE = [\r\n        // L\r\n        // M\r\n        // Q\r\n        // H\r\n        // 1\r\n        [1, 26, 19],\r\n        [1, 26, 16],\r\n        [1, 26, 13],\r\n        [1, 26, 9],\r\n\r\n        // 2\r\n        [1, 44, 34],\r\n        [1, 44, 28],\r\n        [1, 44, 22],\r\n        [1, 44, 16],\r\n\r\n        // 3\r\n        [1, 70, 55],\r\n        [1, 70, 44],\r\n        [2, 35, 17],\r\n        [2, 35, 13],\r\n\r\n        // 4\r\n        [1, 100, 80],\r\n        [2, 50, 32],\r\n        [2, 50, 24],\r\n        [4, 25, 9],\r\n\r\n        // 5\r\n        [1, 134, 108],\r\n        [2, 67, 43],\r\n        [2, 33, 15, 2, 34, 16],\r\n        [2, 33, 11, 2, 34, 12],\r\n\r\n        // 6\r\n        [2, 86, 68],\r\n        [4, 43, 27],\r\n        [4, 43, 19],\r\n        [4, 43, 15],\r\n\r\n        // 7\r\n        [2, 98, 78],\r\n        [4, 49, 31],\r\n        [2, 32, 14, 4, 33, 15],\r\n        [4, 39, 13, 1, 40, 14],\r\n\r\n        // 8\r\n        [2, 121, 97],\r\n        [2, 60, 38, 2, 61, 39],\r\n        [4, 40, 18, 2, 41, 19],\r\n        [4, 40, 14, 2, 41, 15],\r\n\r\n        // 9\r\n        [2, 146, 116],\r\n        [3, 58, 36, 2, 59, 37],\r\n        [4, 36, 16, 4, 37, 17],\r\n        [4, 36, 12, 4, 37, 13],\r\n\r\n        // 10\r\n        [2, 86, 68, 2, 87, 69],\r\n        [4, 69, 43, 1, 70, 44],\r\n        [6, 43, 19, 2, 44, 20],\r\n        [6, 43, 15, 2, 44, 16],\r\n\r\n        // 11\r\n        [4, 101, 81],\r\n        [1, 80, 50, 4, 81, 51],\r\n        [4, 50, 22, 4, 51, 23],\r\n        [3, 36, 12, 8, 37, 13],\r\n\r\n        // 12\r\n        [2, 116, 92, 2, 117, 93],\r\n        [6, 58, 36, 2, 59, 37],\r\n        [4, 46, 20, 6, 47, 21],\r\n        [7, 42, 14, 4, 43, 15],\r\n\r\n        // 13\r\n        [4, 133, 107],\r\n        [8, 59, 37, 1, 60, 38],\r\n        [8, 44, 20, 4, 45, 21],\r\n        [12, 33, 11, 4, 34, 12],\r\n\r\n        // 14\r\n        [3, 145, 115, 1, 146, 116],\r\n        [4, 64, 40, 5, 65, 41],\r\n        [11, 36, 16, 5, 37, 17],\r\n        [11, 36, 12, 5, 37, 13],\r\n\r\n        // 15\r\n        [5, 109, 87, 1, 110, 88],\r\n        [5, 65, 41, 5, 66, 42],\r\n        [5, 54, 24, 7, 55, 25],\r\n        [11, 36, 12],\r\n\r\n        // 16\r\n        [5, 122, 98, 1, 123, 99],\r\n        [7, 73, 45, 3, 74, 46],\r\n        [15, 43, 19, 2, 44, 20],\r\n        [3, 45, 15, 13, 46, 16],\r\n\r\n        // 17\r\n        [1, 135, 107, 5, 136, 108],\r\n        [10, 74, 46, 1, 75, 47],\r\n        [1, 50, 22, 15, 51, 23],\r\n        [2, 42, 14, 17, 43, 15],\r\n\r\n        // 18\r\n        [5, 150, 120, 1, 151, 121],\r\n        [9, 69, 43, 4, 70, 44],\r\n        [17, 50, 22, 1, 51, 23],\r\n        [2, 42, 14, 19, 43, 15],\r\n\r\n        // 19\r\n        [3, 141, 113, 4, 142, 114],\r\n        [3, 70, 44, 11, 71, 45],\r\n        [17, 47, 21, 4, 48, 22],\r\n        [9, 39, 13, 16, 40, 14],\r\n\r\n        // 20\r\n        [3, 135, 107, 5, 136, 108],\r\n        [3, 67, 41, 13, 68, 42],\r\n        [15, 54, 24, 5, 55, 25],\r\n        [15, 43, 15, 10, 44, 16],\r\n\r\n        // 21\r\n        [4, 144, 116, 4, 145, 117],\r\n        [17, 68, 42],\r\n        [17, 50, 22, 6, 51, 23],\r\n        [19, 46, 16, 6, 47, 17],\r\n\r\n        // 22\r\n        [2, 139, 111, 7, 140, 112],\r\n        [17, 74, 46],\r\n        [7, 54, 24, 16, 55, 25],\r\n        [34, 37, 13],\r\n\r\n        // 23\r\n        [4, 151, 121, 5, 152, 122],\r\n        [4, 75, 47, 14, 76, 48],\r\n        [11, 54, 24, 14, 55, 25],\r\n        [16, 45, 15, 14, 46, 16],\r\n\r\n        // 24\r\n        [6, 147, 117, 4, 148, 118],\r\n        [6, 73, 45, 14, 74, 46],\r\n        [11, 54, 24, 16, 55, 25],\r\n        [30, 46, 16, 2, 47, 17],\r\n\r\n        // 25\r\n        [8, 132, 106, 4, 133, 107],\r\n        [8, 75, 47, 13, 76, 48],\r\n        [7, 54, 24, 22, 55, 25],\r\n        [22, 45, 15, 13, 46, 16],\r\n\r\n        // 26\r\n        [10, 142, 114, 2, 143, 115],\r\n        [19, 74, 46, 4, 75, 47],\r\n        [28, 50, 22, 6, 51, 23],\r\n        [33, 46, 16, 4, 47, 17],\r\n\r\n        // 27\r\n        [8, 152, 122, 4, 153, 123],\r\n        [22, 73, 45, 3, 74, 46],\r\n        [8, 53, 23, 26, 54, 24],\r\n        [12, 45, 15, 28, 46, 16],\r\n\r\n        // 28\r\n        [3, 147, 117, 10, 148, 118],\r\n        [3, 73, 45, 23, 74, 46],\r\n        [4, 54, 24, 31, 55, 25],\r\n        [11, 45, 15, 31, 46, 16],\r\n\r\n        // 29\r\n        [7, 146, 116, 7, 147, 117],\r\n        [21, 73, 45, 7, 74, 46],\r\n        [1, 53, 23, 37, 54, 24],\r\n        [19, 45, 15, 26, 46, 16],\r\n\r\n        // 30\r\n        [5, 145, 115, 10, 146, 116],\r\n        [19, 75, 47, 10, 76, 48],\r\n        [15, 54, 24, 25, 55, 25],\r\n        [23, 45, 15, 25, 46, 16],\r\n\r\n        // 31\r\n        [13, 145, 115, 3, 146, 116],\r\n        [2, 74, 46, 29, 75, 47],\r\n        [42, 54, 24, 1, 55, 25],\r\n        [23, 45, 15, 28, 46, 16],\r\n\r\n        // 32\r\n        [17, 145, 115],\r\n        [10, 74, 46, 23, 75, 47],\r\n        [10, 54, 24, 35, 55, 25],\r\n        [19, 45, 15, 35, 46, 16],\r\n\r\n        // 33\r\n        [17, 145, 115, 1, 146, 116],\r\n        [14, 74, 46, 21, 75, 47],\r\n        [29, 54, 24, 19, 55, 25],\r\n        [11, 45, 15, 46, 46, 16],\r\n\r\n        // 34\r\n        [13, 145, 115, 6, 146, 116],\r\n        [14, 74, 46, 23, 75, 47],\r\n        [44, 54, 24, 7, 55, 25],\r\n        [59, 46, 16, 1, 47, 17],\r\n\r\n        // 35\r\n        [12, 151, 121, 7, 152, 122],\r\n        [12, 75, 47, 26, 76, 48],\r\n        [39, 54, 24, 14, 55, 25],\r\n        [22, 45, 15, 41, 46, 16],\r\n\r\n        // 36\r\n        [6, 151, 121, 14, 152, 122],\r\n        [6, 75, 47, 34, 76, 48],\r\n        [46, 54, 24, 10, 55, 25],\r\n        [2, 45, 15, 64, 46, 16],\r\n\r\n        // 37\r\n        [17, 152, 122, 4, 153, 123],\r\n        [29, 74, 46, 14, 75, 47],\r\n        [49, 54, 24, 10, 55, 25],\r\n        [24, 45, 15, 46, 46, 16],\r\n\r\n        // 38\r\n        [4, 152, 122, 18, 153, 123],\r\n        [13, 74, 46, 32, 75, 47],\r\n        [48, 54, 24, 14, 55, 25],\r\n        [42, 45, 15, 32, 46, 16],\r\n\r\n        // 39\r\n        [20, 147, 117, 4, 148, 118],\r\n        [40, 75, 47, 7, 76, 48],\r\n        [43, 54, 24, 22, 55, 25],\r\n        [10, 45, 15, 67, 46, 16],\r\n\r\n        // 40\r\n        [19, 148, 118, 6, 149, 119],\r\n        [18, 75, 47, 31, 76, 48],\r\n        [34, 54, 24, 34, 55, 25],\r\n        [20, 45, 15, 61, 46, 16]\r\n    ];\r\n\r\n    /**\r\n     * 根据数据获取对应版本\r\n     * @return {[type]} [description]\r\n     */\r\n    QRCodeAlg.prototype.getRightType = function () {\r\n        for (var typeNumber = 1; typeNumber < 41; typeNumber++) {\r\n            var rsBlock = RS_BLOCK_TABLE[(typeNumber - 1) * 4 + this.errorCorrectLevel];\r\n            if (rsBlock == undefined) {\r\n                throw new Error(\"bad rs block @ typeNumber:\" + typeNumber + \"/errorCorrectLevel:\" + this.errorCorrectLevel);\r\n            }\r\n            var length = rsBlock.length / 3;\r\n            var totalDataCount = 0;\r\n            for (var i = 0; i < length; i++) {\r\n                var count = rsBlock[i * 3 + 0];\r\n                var dataCount = rsBlock[i * 3 + 2];\r\n                totalDataCount += dataCount * count;\r\n            }\r\n            var lengthBytes = typeNumber > 9 ? 2 : 1;\r\n            if (this.utf8bytes.length + lengthBytes < totalDataCount || typeNumber == 40) {\r\n                this.typeNumber = typeNumber;\r\n                this.rsBlock = rsBlock;\r\n                this.totalDataCount = totalDataCount;\r\n                break;\r\n            }\r\n        }\r\n    };\r\n\r\n    //---------------------------------------------------------------------\r\n    // QRBitBuffer\r\n    //---------------------------------------------------------------------\r\n    function QRBitBuffer() {\r\n        this.buffer = new Array();\r\n        this.length = 0;\r\n    }\r\n    QRBitBuffer.prototype = {\r\n        get: function (index) {\r\n            var bufIndex = Math.floor(index / 8);\r\n            return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1);\r\n        },\r\n        put: function (num, length) {\r\n            for (var i = 0; i < length; i++) {\r\n                this.putBit(((num >>> (length - i - 1)) & 1));\r\n            }\r\n        },\r\n        putBit: function (bit) {\r\n            var bufIndex = Math.floor(this.length / 8);\r\n            if (this.buffer.length <= bufIndex) {\r\n                this.buffer.push(0);\r\n            }\r\n            if (bit) {\r\n                this.buffer[bufIndex] |= (0x80 >>> (this.length % 8));\r\n            }\r\n            this.length++;\r\n        }\r\n    };","function getLocalFilePath(path) {\n    if (path.indexOf('_www') === 0 || path.indexOf('_doc') === 0 || path.indexOf('_documents') === 0 || path.indexOf('_downloads') === 0) {\n        return path\n    }\n    if (path.indexOf('file://') === 0) {\n        return path\n    }\n    if (path.indexOf('/storage/emulated/0/') === 0) {\n        return path\n    }\n    if (path.indexOf('/') === 0) {\n        var localFilePath = plus.io.convertAbsoluteFileSystem(path)\n        if (localFilePath !== path) {\n            return localFilePath\n        } else {\n            path = path.substr(1)\n        }\n    }\n    return '_www/' + path\n}\n\nexport function pathToBase64(path) {\n    return new Promise(function(resolve, reject) {\n        if (typeof window === 'object' && 'document' in window) {\n            if (typeof FileReader === 'function') {\n                var xhr = new XMLHttpRequest()\n                xhr.open('GET', path, true)\n                xhr.responseType = 'blob'\n                xhr.onload = function() {\n                    if (this.status === 200) {\n                        let fileReader = new FileReader()\n                        fileReader.onload = function(e) {\n                            resolve(e.target.result)\n                        }\n                        fileReader.onerror = reject\n                        fileReader.readAsDataURL(this.response)\n                    }\n                }\n                xhr.onerror = reject\n                xhr.send()\n                return\n            }\n            var canvas = document.createElement('canvas')\n            var c2x = canvas.getContext('2d')\n            var img = new Image\n            img.onload = function() {\n                canvas.width = img.width\n                canvas.height = img.height\n                c2x.drawImage(img, 0, 0)\n                resolve(canvas.toDataURL())\n                canvas.height = canvas.width = 0\n            }\n            img.onerror = reject\n            img.src = path\n            return\n        }\n        if (typeof plus === 'object') {\n            plus.io.resolveLocalFileSystemURL(getLocalFilePath(path), function(entry) {\n                entry.file(function(file) {\n                    var fileReader = new plus.io.FileReader()\n                    fileReader.onload = function(data) {\n                        resolve(data.target.result)\n                    }\n                    fileReader.onerror = function(error) {\n                        reject(error)\n                    }\n                    fileReader.readAsDataURL(file)\n                }, function(error) {\n                    reject(error)\n                })\n            }, function(error) {\n                reject(error)\n            })\n            return\n        }\n        if (typeof wx === 'object' && wx.canIUse('getFileSystemManager')) {\n            wx.getFileSystemManager().readFile({\n                filePath: path,\n                encoding: 'base64',\n                success: function(res) {\n                    resolve('data:image/png;base64,' + res.data)\n                },\n                fail: function(error) {\n                    reject(error)\n                }\n            })\n            return\n        }\n        reject(new Error('not support'))\n    })\n}\n\nexport function base64ToPath(base64) {\n    return new Promise(function(resolve, reject) {\n        if (typeof window === 'object' && 'document' in window) {\n            base64 = base64.split(',')\n            var type = base64[0].match(/:(.*?);/)[1]\n            var str = atob(base64[1])\n            var n = str.length\n            var array = new Uint8Array(n)\n            while (n--) {\n                array[n] = str.charCodeAt(n)\n            }\n            return resolve((window.URL || window.webkitURL).createObjectURL(new Blob([array], { type: type })))\n        }\n        var extName = base64.match(/data\\:\\S+\\/(\\S+);/)\n        if (extName) {\n            extName = extName[1]\n        } else {\n            reject(new Error('base64 error'))\n        }\n        var fileName = Date.now() + '.' + extName\n        if (typeof plus === 'object') {\n            var bitmap = new plus.nativeObj.Bitmap('bitmap' + Date.now())\n            bitmap.loadBase64Data(base64, function() {\n                var filePath = '_doc/uniapp_temp/' + fileName\n                bitmap.save(filePath, {}, function() {\n                    bitmap.clear()\n                    resolve(filePath)\n                }, function(error) {\n                    bitmap.clear()\n                    reject(error)\n                })\n            }, function(error) {\n                bitmap.clear()\n                reject(error)\n            })\n            return\n        }\n        if (typeof wx === 'object' && wx.canIUse('getFileSystemManager')) {\n            var filePath = wx.env.USER_DATA_PATH + '/' + fileName\n            wx.getFileSystemManager().writeFile({\n                filePath: filePath,\n                data: base64.replace(/^data:\\S+\\/\\S+;base64,/, ''),\n                encoding: 'base64',\n                success: function() {\n                    resolve(filePath)\n                },\n                fail: function(error) {\n                    reject(error)\n                }\n            })\n            return\n        }\n        reject(new Error('not support'))\n    })\n}"],"sourceRoot":""}